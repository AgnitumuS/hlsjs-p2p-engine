(function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports.Hls=t():e.Hls=t()})('undefined'==typeof self?this:self,function(){var e=Math.max,t=Math.round,a=Math.abs,r=Math.ceil,o=Math.floor,n=Math.pow,d=String.fromCharCode,s=Math.min;return function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='/dist/',t(t.s=18)}([function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return'function'==typeof e}function r(e){return'number'==typeof e}function n(e){return'object'==typeof e&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError('n must be a positive number');return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,d,s,l,i;if(this._events||(this._events={}),'error'===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length))if(t=arguments[1],t instanceof Error)throw t;else{var u=new Error('Uncaught, unspecified "error" event. ('+t+')');throw u.context=t,u}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s);}else if(n(r))for(s=Array.prototype.slice.call(arguments,1),i=r.slice(),d=i.length,l=0;l<d;l++)i[l].apply(this,s);return!0},t.prototype.addListener=function(e,r){var i;if(!a(r))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',e,a(r.listener)?r.listener:r),this._events[e]?n(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,n(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,i&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[e].length),'function'==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!a(t))throw TypeError('listener must be a function');var n=!1;return r.listener=t,this.on(e,r),this},t.prototype.removeListener=function(e,t){var r,o,d,s;if(!a(t))throw TypeError('listener must be a function');if(!this._events||!this._events[e])return this;if(r=this._events[e],d=r.length,o=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit('removeListener',e,t);else if(n(r)){for(s=d;0<s--;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=s;break}if(0>o)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit('removeListener',e,t)}return this},t.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)'removeListener'!==t&&this.removeAllListeners(t);return this.removeAllListeners('removeListener'),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(e){var t=function(){return this}();try{t=t||Function('return this')()||(1,eval)('this')}catch(a){'object'==typeof window&&(t=window)}e.exports=t},function(e){function t(){throw new Error('setTimeout has not been defined')}function a(){throw new Error('clearTimeout has not been defined')}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===t||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function n(e){if(p===clearTimeout)return clearTimeout(e);if((p===a||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function o(){f&&m&&(f=!1,m.length?c=m.concat(c):g=-1,c.length&&d())}function d(){if(!f){var e=r(o);f=!0;for(var t=c.length;t;){for(m=c,c=[];++g<t;)m&&m[g].run();g=-1,t=c.length}m=null,f=!1,n(e)}}function s(e,t){this.fun=e,this.array=t}function i(){}var l=e.exports={},u,p;(function(){try{u='function'==typeof setTimeout?setTimeout:t}catch(a){u=t}try{p='function'==typeof clearTimeout?clearTimeout:a}catch(t){p=a}})();var c=[],f=!1,g=-1,m;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];c.push(new s(e,t)),1!==c.length||f||r(d)},s.prototype.run=function(){this.fun.apply(null,this.array)},l.title='browser',l.browser=!0,l.env={},l.argv=[],l.version='',l.versions={},l.on=i,l.addListener=i,l.once=i,l.off=i,l.removeListener=i,l.removeAllListeners=i,l.emit=i,l.prependListener=i,l.prependOnceListener=i,l.listeners=function(){return[]},l.binding=function(){throw new Error('process.binding is not supported')},l.cwd=function(){return'/'},l.chdir=function(){throw new Error('process.chdir is not supported')},l.umask=function(){return 0}},function(e){e.exports='function'==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var a=function(){};a.prototype=t.prototype,e.prototype=new a,e.prototype.constructor=e}},function(e,t,a){'use strict';function r(e){return this instanceof r?void(l.call(this,e),u.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once('end',n)):new r(e)}function n(){this.allowHalfOpen||this._writableState.ended||i(o,this)}function o(e){e.end()}var i=a(9),d=Object.keys||function(e){var t=[];for(var a in e)t.push(a);return t};e.exports=r;var s=a(6);s.inherits=a(3);var l=a(12),u=a(15);s.inherits(r,l);for(var p=d(u.prototype),c=0,f;c<p.length;c++)f=p[c],r.prototype[f]||(r.prototype[f]=u.prototype[f]);Object.defineProperty(r.prototype,'destroyed',{get:function(){return void 0===this._readableState||void 0===this._writableState?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),r.prototype._destroy=function(e,t){this.push(null),this.end(),i(t,e)}},function(e,t,a){function r(e,t){for(var a in e)t[a]=e[a]}function n(e,t,a){return i(e,t,a)}var o=a(8),i=o.Buffer;i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=o:(r(o,t),t.Buffer=n),r(i,n),n.from=function(e,t,a){if('number'==typeof e)throw new TypeError('Argument must not be a number');return i(e,t,a)},n.alloc=function(e,t,a){if('number'!=typeof e)throw new TypeError('Argument must be a number');var r=i(e);return void 0===t?r.fill(0):'string'==typeof a?r.fill(t,a):r.fill(t),r},n.allocUnsafe=function(e){if('number'!=typeof e)throw new TypeError('Argument must be a number');return i(e)},n.allocUnsafeSlow=function(e){if('number'!=typeof e)throw new TypeError('Argument must be a number');return o.SlowBuffer(e)}},function(e,t,a){(function(e){function a(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):'[object Array]'===a(e)},t.isBoolean=function(e){return'boolean'==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSymbol=function(e){return'symbol'==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return'[object RegExp]'===a(e)},t.isObject=function(e){return'object'==typeof e&&null!==e},t.isDate=function(e){return'[object Date]'===a(e)},t.isError=function(t){return'[object Error]'===a(t)||t instanceof Error},t.isFunction=function(e){return'function'==typeof e},t.isPrimitive=function(e){return null===e||'boolean'==typeof e||'number'==typeof e||'string'==typeof e||'symbol'==typeof e||'undefined'==typeof e},t.isBuffer=e.isBuffer}).call(t,a(8).Buffer)},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});t.recommendedHlsjsConfig={maxBufferSize:0,maxBufferLength:30,liveSyncDuration:30},t.defaultP2PConfig={websocketAddr:'ws://localhost:12034',websocketRetryDelay:5,dcKeepAliveInterval:10,dcKeepAliveAckTimeout:2,dcRequestTimeout:2,maxCacheSize:104857600}},function(e,t,a){'use strict';(function(e){function r(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function l(e,t){if(r()<t)throw new RangeError('Invalid typed array length');return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=u.prototype):(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,a){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,a);if('number'==typeof e){if('string'==typeof t)throw new Error('If encoding is specified then the first argument must be a string');return f(this,e)}return i(this,e,t,a)}function i(e,t,a,r){if('number'==typeof t)throw new TypeError('"value" argument must not be a number');return'undefined'!=typeof ArrayBuffer&&t instanceof ArrayBuffer?y(e,t,a,r):'string'==typeof t?g(e,t,a):h(e,t)}function p(e){if('number'!=typeof e)throw new TypeError('"size" argument must be a number');else if(0>e)throw new RangeError('"size" argument must not be negative')}function c(e,t,a,r){return p(t),0>=t?l(e,t):void 0===a?l(e,t):'string'==typeof r?l(e,t).fill(a,r):l(e,t).fill(a)}function f(e,t){if(p(t),e=l(e,0>t?0:0|b(t)),!u.TYPED_ARRAY_SUPPORT)for(var a=0;a<t;++a)e[a]=0;return e}function g(e,t,a){if(('string'!=typeof a||''===a)&&(a='utf8'),!u.isEncoding(a))throw new TypeError('"encoding" must be a valid string encoding');var r=0|_(t,a);e=l(e,r);var n=e.write(t,a);return n!==r&&(e=e.slice(0,n)),e}function m(e,t){var a=0>t.length?0:0|b(t.length);e=l(e,a);for(var r=0;r<a;r+=1)e[r]=255&t[r];return e}function y(e,t,a,r){if(t.byteLength,0>a||t.byteLength<a)throw new RangeError('\'offset\' is out of bounds');if(t.byteLength<a+(r||0))throw new RangeError('\'length\' is out of bounds');return t=void 0===a&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,a):new Uint8Array(t,a,r),u.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=u.prototype):e=m(e,t),e}function h(e,t){if(u.isBuffer(t)){var a=0|b(t.length);return(e=l(e,a),0===e.length)?e:(t.copy(e,0,0,a),e)}if(t){if('undefined'!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||'length'in t)return'number'!=typeof t.length||$(t.length)?l(e,0):m(e,t);if('Buffer'===t.type&&te(t.data))return m(e,t.data)}throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')}function b(e){if(e>=r())throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x'+r().toString(16)+' bytes');return 0|e}function _(e,t){if(u.isBuffer(e))return e.length;if('undefined'!=typeof ArrayBuffer&&'function'==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;'string'!=typeof e&&(e=''+e);var a=e.length;if(0===a)return 0;for(var r=!1;;)switch(t){case'ascii':case'latin1':case'binary':return a;case'utf8':case'utf-8':case void 0:return z(e).length;case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return 2*a;case'hex':return a>>>1;case'base64':return Q(e).length;default:if(r)return z(e).length;t=(''+t).toLowerCase(),r=!0;}}function T(e,t,a){var r=!1;if((void 0===t||0>t)&&(t=0),t>this.length)return'';if((void 0===a||a>this.length)&&(a=this.length),0>=a)return'';if(a>>>=0,t>>>=0,a<=t)return'';for(e||(e='utf8');;)switch(e){case'hex':return F(this,t,a);case'utf8':case'utf-8':return P(this,t,a);case'ascii':return x(this,t,a);case'latin1':case'binary':return O(this,t,a);case'base64':return I(this,t,a);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return N(this,t,a);default:if(r)throw new TypeError('Unknown encoding: '+e);e=(e+'').toLowerCase(),r=!0;}}function E(e,t,a){var r=e[t];e[t]=e[a],e[a]=r}function R(e,t,a,r,n){if(0===e.length)return-1;if('string'==typeof a?(r=a,a=0):2147483647<a?a=2147483647:-2147483648>a&&(a=-2147483648),a=+a,isNaN(a)&&(a=n?0:e.length-1),0>a&&(a=e.length+a),a>=e.length){if(n)return-1;a=e.length-1}else if(0>a)if(n)a=0;else return-1;if('string'==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:S(e,t,a,r,n);if('number'==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&'function'==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,a):Uint8Array.prototype.lastIndexOf.call(e,t,a):S(e,[t],a,r,n);throw new TypeError('val must be string, number or Buffer')}function S(e,t,a,r,n){function o(e,t){return 1==d?e[t]:e.readUInt16BE(t*d)}var d=1,s=e.length,l=t.length;if(void 0!==r&&(r=(r+'').toLowerCase(),'ucs2'===r||'ucs-2'===r||'utf16le'===r||'utf-16le'===r)){if(2>e.length||2>t.length)return-1;d=2,s/=2,l/=2,a/=2}var u;if(n){var i=-1;for(u=a;u<s;u++)if(o(e,u)!==o(t,-1==i?0:u-i))-1!=i&&(u-=u-i),i=-1;else if(-1==i&&(i=u),u-i+1===l)return i*d}else for(a+l>s&&(a=s-l),u=a;0<=u;u--){for(var p=!0,c=0;c<l;c++)if(o(e,u+c)!==o(t,c)){p=!1;break}if(p)return u}return-1}function v(e,t,a,r){a=+a||0;var n=e.length-a;r?(r=+r,r>n&&(r=n)):r=n;var o=t.length;if(0!=o%2)throw new TypeError('Invalid hex string');r>o/2&&(r=o/2);for(var d=0,i;d<r;++d){if(i=parseInt(t.substr(2*d,2),16),isNaN(i))return d;e[a+d]=i}return d}function A(e,t,a,r){return Z(z(t,e.length-a),e,a,r)}function L(e,t,a,r){return Z(q(t),e,a,r)}function D(e,t,a,r){return L(e,t,a,r)}function C(e,t,a,r){return Z(Q(t),e,a,r)}function k(e,t,a,r){return Z(X(t,e.length-a),e,a,r)}function I(e,t,a){return 0===t&&a===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,a))}function P(e,t,a){a=s(e.length,a);for(var r=[],n=t;n<a;){var o=e[n],i=null,d=239<o?4:223<o?3:191<o?2:1;if(n+d<=a){var l,u,p,c;1==d?128>o&&(i=o):2==d?(l=e[n+1],128==(192&l)&&(c=(31&o)<<6|63&l,127<c&&(i=c))):3==d?(l=e[n+1],u=e[n+2],128==(192&l)&&128==(192&u)&&(c=(15&o)<<12|(63&l)<<6|63&u,2047<c&&(55296>c||57343<c)&&(i=c))):4==d?(l=e[n+1],u=e[n+2],p=e[n+3],128==(192&l)&&128==(192&u)&&128==(192&p)&&(c=(15&o)<<18|(63&l)<<12|(63&u)<<6|63&p,65535<c&&1114112>c&&(i=c))):void 0}null===i?(i=65533,d=1):65535<i&&(i-=65536,r.push(55296|1023&i>>>10),i=56320|1023&i),r.push(i),n+=d}return w(r)}function w(e){var t=e.length;if(t<=ae)return d.apply(String,e);for(var a='',r=0;r<t;)a+=d.apply(String,e.slice(r,r+=ae));return a}function x(e,t,a){var r='';a=s(e.length,a);for(var n=t;n<a;++n)r+=d(127&e[n]);return r}function O(e,t,a){var r='';a=s(e.length,a);for(var n=t;n<a;++n)r+=d(e[n]);return r}function F(e,t,a){var r=e.length;(!t||0>t)&&(t=0),(!a||0>a||a>r)&&(a=r);for(var n='',o=t;o<a;++o)n+=Y(e[o]);return n}function N(e,t,a){for(var r=e.slice(t,a),n='',o=0;o<r.length;o+=2)n+=d(r[o]+256*r[o+1]);return n}function B(e,t,a){if(0!=e%1||0>e)throw new RangeError('offset is not uint');if(e+t>a)throw new RangeError('Trying to access beyond buffer length')}function M(e,t,a,r,n,o){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(a+r>e.length)throw new RangeError('Index out of range')}function U(e,t,a,r){0>t&&(t=65535+t+1);for(var n=0,o=s(e.length-a,2);n<o;++n)e[a+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function G(e,t,a,r){0>t&&(t=4294967295+t+1);for(var n=0,o=s(e.length-a,4);n<o;++n)e[a+n]=255&t>>>8*(r?n:3-n)}function W(e,t,a,r){if(a+r>e.length)throw new RangeError('Index out of range');if(0>a)throw new RangeError('Index out of range')}function K(e,t,a,r,n){return n||W(e,t,a,4,3.4028234663852886e38,-3.4028234663852886e38),ee.write(e,t,a,r,23,4),a+4}function H(e,t,a,r,n){return n||W(e,t,a,8,1.7976931348623157e308,-1.7976931348623157e308),ee.write(e,t,a,r,52,8),a+8}function V(e){if(e=j(e).replace(re,''),2>e.length)return'';for(;0!=e.length%4;)e+='=';return e}function j(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,'')}function Y(e){return 16>e?'0'+e.toString(16):e.toString(16)}function z(e,t){t=t||Infinity;for(var a=e.length,r=null,n=[],o=0,i;o<a;++o){if(i=e.charCodeAt(o),55295<i&&57344>i){if(!r){if(56319<i){-1<(t-=3)&&n.push(239,191,189);continue}else if(o+1===a){-1<(t-=3)&&n.push(239,191,189);continue}r=i;continue}if(56320>i){-1<(t-=3)&&n.push(239,191,189),r=i;continue}i=(r-55296<<10|i-56320)+65536}else r&&-1<(t-=3)&&n.push(239,191,189);if(r=null,128>i){if(0>(t-=1))break;n.push(i)}else if(2048>i){if(0>(t-=2))break;n.push(192|i>>6,128|63&i)}else if(65536>i){if(0>(t-=3))break;n.push(224|i>>12,128|63&i>>6,128|63&i)}else if(1114112>i){if(0>(t-=4))break;n.push(240|i>>18,128|63&i>>12,128|63&i>>6,128|63&i)}else throw new Error('Invalid code point')}return n}function q(e){for(var t=[],a=0;a<e.length;++a)t.push(255&e.charCodeAt(a));return t}function X(e,t){for(var a=[],r=0,n,o,i;r<e.length&&!(0>(t-=2));++r)n=e.charCodeAt(r),o=n>>8,i=n%256,a.push(i),a.push(o);return a}function Q(e){return J.toByteArray(V(e))}function Z(e,t,a,r){for(var n=0;n<r&&!(n+a>=t.length||n>=e.length);++n)t[n+a]=e[n];return n}function $(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var J=a(21),ee=a(22),te=a(11);t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=e.TYPED_ARRAY_SUPPORT===void 0?function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&'function'==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}():e.TYPED_ARRAY_SUPPORT,t.kMaxLength=r(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,a){return i(null,e,t,a)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,'undefined'!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,a){return c(null,e,t,a)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!!(null!=e&&e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('Arguments must be Buffers');if(e===t)return 0;for(var a=e.length,r=t.length,n=0,o=s(a,r);n<o;++n)if(e[n]!==t[n]){a=e[n],r=t[n];break}return a<r?-1:r<a?1:0},u.isEncoding=function(e){switch((e+'').toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'latin1':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return!0;default:return!1;}},u.concat=function(e,t){if(!te(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var a;if(t===void 0)for(t=0,a=0;a<e.length;++a)t+=e[a].length;var r=u.allocUnsafe(t),n=0;for(a=0;a<e.length;++a){var o=e[a];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},u.byteLength=_,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(0!=e%2)throw new RangeError('Buffer size must be a multiple of 16-bits');for(var t=0;t<e;t+=2)E(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(0!=e%4)throw new RangeError('Buffer size must be a multiple of 32-bits');for(var t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(0!=e%8)throw new RangeError('Buffer size must be a multiple of 64-bits');for(var t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0==e?'':0===arguments.length?P(this,0,e):T.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError('Argument must be a Buffer');return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e='',a=t.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString('hex',0,a).match(/.{2}/g).join(' '),this.length>a&&(e+=' ... ')),'<Buffer '+e+'>'},u.prototype.compare=function(e,t,a,r,n){if(!u.isBuffer(e))throw new TypeError('Argument must be a Buffer');if(void 0===t&&(t=0),void 0===a&&(a=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),0>t||a>e.length||0>r||n>this.length)throw new RangeError('out of range index');if(r>=n&&t>=a)return 0;if(r>=n)return-1;if(t>=a)return 1;if(t>>>=0,a>>>=0,r>>>=0,n>>>=0,this===e)return 0;for(var o=n-r,d=a-t,l=s(o,d),p=this.slice(r,n),c=e.slice(t,a),f=0;f<l;++f)if(p[f]!==c[f]){o=p[f],d=c[f];break}return o<d?-1:d<o?1:0},u.prototype.includes=function(e,t,a){return-1!==this.indexOf(e,t,a)},u.prototype.indexOf=function(e,t,a){return R(this,e,t,a,!0)},u.prototype.lastIndexOf=function(e,t,a){return R(this,e,t,a,!1)},u.prototype.write=function(e,t,a,r){if(void 0===t)r='utf8',a=this.length,t=0;else if(void 0===a&&'string'==typeof t)r=t,a=this.length,t=0;else if(isFinite(t))t|=0,isFinite(a)?(a|=0,void 0===r&&(r='utf8')):(r=a,a=void 0);else throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');var n=this.length-t;if((void 0===a||a>n)&&(a=n),0<e.length&&(0>a||0>t)||t>this.length)throw new RangeError('Attempt to write outside buffer bounds');r||(r='utf8');for(var o=!1;;)switch(r){case'hex':return v(this,e,t,a);case'utf8':case'utf-8':return A(this,e,t,a);case'ascii':return L(this,e,t,a);case'latin1':case'binary':return D(this,e,t,a);case'base64':return C(this,e,t,a);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return k(this,e,t,a);default:if(o)throw new TypeError('Unknown encoding: '+r);r=(''+r).toLowerCase(),o=!0;}},u.prototype.toJSON=function(){return{type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0)}};var ae=4096;u.prototype.slice=function(e,t){var a=this.length;e=~~e,t=t===void 0?a:~~t,0>e?(e+=a,0>e&&(e=0)):e>a&&(e=a),0>t?(t+=a,0>t&&(t=0)):t>a&&(t=a),t<e&&(t=e);var r;if(u.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=u.prototype;else{var n=t-e;r=new u(n,void 0);for(var o=0;o<n;++o)r[o]=this[o+e]}return r},u.prototype.readUIntLE=function(e,t,a){e|=0,t|=0,a||B(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},u.prototype.readUIntBE=function(e,t,a){e|=0,t|=0,a||B(e,t,this.length);for(var r=this[e+--t],n=1;0<t&&(n*=256);)r+=this[e+--t]*n;return r},u.prototype.readUInt8=function(e,t){return t||B(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||B(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||B(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||B(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,a){e|=0,t|=0,a||B(e,t,this.length);for(var r=this[e],o=1,d=0;++d<t&&(o*=256);)r+=this[e+d]*o;return o*=128,r>=o&&(r-=n(2,8*t)),r},u.prototype.readIntBE=function(e,t,a){e|=0,t|=0,a||B(e,t,this.length);for(var r=t,o=1,i=this[e+--r];0<r&&(o*=256);)i+=this[e+--r]*o;return o*=128,i>=o&&(i-=n(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||B(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||B(e,2,this.length);var a=this[e]|this[e+1]<<8;return 32768&a?4294901760|a:a},u.prototype.readInt16BE=function(e,t){t||B(e,2,this.length);var a=this[e+1]|this[e]<<8;return 32768&a?4294901760|a:a},u.prototype.readInt32LE=function(e,t){return t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||B(e,4,this.length),ee.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||B(e,4,this.length),ee.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||B(e,8,this.length),ee.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||B(e,8,this.length),ee.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,a,r){if(e=+e,t|=0,a|=0,!r){var o=n(2,8*a)-1;M(this,e,t,a,o,0)}var d=1,s=0;for(this[t]=255&e;++s<a&&(d*=256);)this[t+s]=255&e/d;return t+a},u.prototype.writeUIntBE=function(e,t,a,r){if(e=+e,t|=0,a|=0,!r){var o=n(2,8*a)-1;M(this,e,t,a,o,0)}var d=a-1,i=1;for(this[t+d]=255&e;0<=--d&&(i*=256);)this[t+d]=255&e/i;return t+a},u.prototype.writeUInt8=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=o(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):G(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):G(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,a,r){if(e=+e,t|=0,!r){var o=n(2,8*a-1);M(this,e,t,a,o-1,-o)}var d=0,i=1,s=0;for(this[t]=255&e;++d<a&&(i*=256);)0>e&&0==s&&0!==this[t+d-1]&&(s=1),this[t+d]=255&(e/i>>0)-s;return t+a},u.prototype.writeIntBE=function(e,t,a,r){if(e=+e,t|=0,!r){var o=n(2,8*a-1);M(this,e,t,a,o-1,-o)}var d=a-1,i=1,s=0;for(this[t+d]=255&e;0<=--d&&(i*=256);)0>e&&0==s&&0!==this[t+d+1]&&(s=1),this[t+d]=255&(e/i>>0)-s;return t+a},u.prototype.writeInt8=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=o(e)),0>e&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):G(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,a){return e=+e,t|=0,a||M(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):G(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,a){return K(this,e,t,!0,a)},u.prototype.writeFloatBE=function(e,t,a){return K(this,e,t,!1,a)},u.prototype.writeDoubleLE=function(e,t,a){return H(this,e,t,!0,a)},u.prototype.writeDoubleBE=function(e,t,a){return H(this,e,t,!1,a)},u.prototype.copy=function(e,t,a,r){if(a||(a=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<a&&(r=a),r===a)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError('targetStart out of bounds');if(0>a||a>=this.length)throw new RangeError('sourceStart out of bounds');if(0>r)throw new RangeError('sourceEnd out of bounds');r>this.length&&(r=this.length),e.length-t<r-a&&(r=e.length-t+a);var n=r-a,o;if(this===e&&a<t&&t<r)for(o=n-1;0<=o;--o)e[o+t]=this[o+a];else if(1e3>n||!u.TYPED_ARRAY_SUPPORT)for(o=0;o<n;++o)e[o+t]=this[o+a];else Uint8Array.prototype.set.call(e,this.subarray(a,a+n),t);return n},u.prototype.fill=function(e,t,a,r){if('string'==typeof e){if('string'==typeof t?(r=t,t=0,a=this.length):'string'==typeof a&&(r=a,a=this.length),1===e.length){var n=e.charCodeAt(0);256>n&&(e=n)}if(void 0!==r&&'string'!=typeof r)throw new TypeError('encoding must be a string');if('string'==typeof r&&!u.isEncoding(r))throw new TypeError('Unknown encoding: '+r)}else'number'==typeof e&&(e&=255);if(0>t||this.length<t||this.length<a)throw new RangeError('Out of range index');if(a<=t)return this;t>>>=0,a=a===void 0?this.length:a>>>0,e||(e=0);var o;if('number'==typeof e)for(o=t;o<a;++o)this[o]=e;else{var i=u.isBuffer(e)?e:z(new u(e,r).toString()),d=i.length;for(o=0;o<a-t;++o)this[o+t]=i[o%d]}return this};var re=/[^+\/0-9A-Za-z-_]/g}).call(t,a(1))},function(e,t,a){'use strict';(function(t){e.exports=t.version&&0!==t.version.indexOf('v0.')&&(0!==t.version.indexOf('v1.')||0===t.version.indexOf('v1.8.'))?t.nextTick:function(e,a,r,n){if('function'!=typeof e)throw new TypeError('"callback" argument must be a function');var o=arguments.length,d,s;switch(o){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,a)});case 3:return t.nextTick(function(){e.call(null,a,r)});case 4:return t.nextTick(function(){e.call(null,a,r,n)});default:for(d=Array(o-1),s=0;s<d.length;)d[s++]=arguments[s];return t.nextTick(function(){e.apply(null,d)});}}}).call(t,a(2))},function(e,t,a){(function(t){function r(e){var t=this;if(!(t instanceof r))return new r(e);if(t._id=s(4).toString('hex').slice(0,7),t._debug('new peer %o',e),e=Object.assign({allowHalfOpen:!1},e),l.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||s(20).toString('hex'):null,t._isChromium='undefined'!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||r.channelConfig,t.config=e.config||r.config,t.constraints=t._transformConstraints(e.constraints||r.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.reconnectTimer=e.reconnectTimer||!1,t.sdpTransform=e.sdpTransform||function(e){return e},t.stream=e.stream||!1,t.trickle=void 0===e.trickle||e.trickle,t._earlyMessage=null,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&'object'==typeof e.wrtc?e.wrtc:i(),!t._wrtc)if('undefined'==typeof window)throw new Error('No WebRTC support: Specify `opts.wrtc` option in this environment');else throw new Error('No WebRTC support: Not a supported browser');if(t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._previousStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._reconnectTimeout=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isWrtc=Array.isArray(t._pc.RTCIceConnectionStates),t._isReactNativeWebrtc='number'==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator){var a=!1;t._pc.onnegotiationneeded=function(){a||t._createOffer(),a=!0},t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)})}else t._pc.ondatachannel=function(e){t._setupData(e)};'addTrack'in t._pc?(t.stream&&t.stream.getTracks().forEach(function(e){t._pc.addTrack(e,t.stream)}),t._pc.ontrack=function(e){t._onTrack(e)}):(t.stream&&t._pc.addStream(t.stream),t._pc.onaddstream=function(e){t._onAddStream(e)}),t.initiator&&t._isWrtc&&t._pc.onnegotiationneeded(),t._onFinishBound=function(){t._onFinish()},t.once('finish',t._onFinishBound)}function n(){}e.exports=r;var o=a(23)('simple-peer'),i=a(26),d=a(3),s=a(27),l=a(28),u=65536;d(r,l.Duplex),r.WEBRTC_SUPPORT=!!i(),r.config={iceServers:[{urls:'stun:stun.l.google.com:19302'},{urls:'stun:global.stun.twilio.com:3478?transport=udp'}]},r.constraints={},r.channelConfig={},Object.defineProperty(r.prototype,'bufferSize',{get:function(){var e=this;return e._channel&&e._channel.bufferedAmount||0}}),r.prototype.address=function(){var e=this;return{port:e.localPort,family:'IPv4',address:e.localAddress}},r.prototype.signal=function(e){var t=this;if(t.destroyed)throw new Error('cannot signal after peer is destroyed');if('string'==typeof e)try{e=JSON.parse(e)}catch(t){e={}}t._debug('signal()'),e.candidate&&(t._pc.remoteDescription?t._addIceCandidate(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),function(){t.destroyed||(t._pendingCandidates.forEach(function(e){t._addIceCandidate(e)}),t._pendingCandidates=[],'offer'===t._pc.remoteDescription.type&&t._createAnswer())},function(e){t._destroy(e)}),e.sdp||e.candidate||t._destroy(new Error('signal() called with invalid signal data'))},r.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),n,function(e){t._destroy(e)})}catch(e){t._destroy(new Error('error adding candidate: '+e.message))}},r.prototype.send=function(e){var a=this;a._isWrtc&&t.isBuffer(e)&&(e=new Uint8Array(e)),a._channel.send(e)},r.prototype.destroy=function(e){var t=this;t._destroy(null,e)},r.prototype._destroy=function(e,t){var a=this;if(!a.destroyed){if(t&&a.once('close',t),a._debug('destroy (error: %s)',e&&(e.message||e)),a.readable=a.writable=!1,a._readableState.ended||a.push(null),a._writableState.finished||a.end(),a.destroyed=!0,a.connected=!1,a._pcReady=!1,a._channelReady=!1,a._previousStreams=null,a._earlyMessage=null,clearInterval(a._interval),clearTimeout(a._reconnectTimeout),a._interval=null,a._reconnectTimeout=null,a._chunk=null,a._cb=null,a._onFinishBound&&a.removeListener('finish',a._onFinishBound),a._onFinishBound=null,a._pc){try{a._pc.close()}catch(e){}a._pc.oniceconnectionstatechange=null,a._pc.onicegatheringstatechange=null,a._pc.onsignalingstatechange=null,a._pc.onicecandidate=null,'addTrack'in a._pc?a._pc.ontrack=null:a._pc.onaddstream=null,a._pc.onnegotiationneeded=null,a._pc.ondatachannel=null}if(a._channel){try{a._channel.close()}catch(e){}a._channel.onmessage=null,a._channel.onopen=null,a._channel.onclose=null,a._channel.onerror=null}a._pc=null,a._channel=null,e&&a.emit('error',e),a.emit('close')}},r.prototype._setupData=function(e){var t=this;return e.channel?void(t._channel=e.channel,t._channel.binaryType='arraybuffer','number'==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=u),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._channelReady?t._onChannelMessage(e):(t._earlyMessage=e,t._onChannelOpen())},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._channelReady||t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t._destroy(e)}):t._destroy(new Error('Data channel event is missing `channel` property'))},r.prototype._read=function(){},r.prototype._write=function(e,t,a){var r=this;if(r.destroyed)return a(new Error('cannot write after peer is destroyed'));if(r.connected){try{r.send(e)}catch(e){return r._destroy(e)}r._channel.bufferedAmount>u?(r._debug('start backpressure: bufferedAmount %d',r._channel.bufferedAmount),r._cb=a):a(null)}else r._debug('write before connect'),r._chunk=e,r._cb=a},r.prototype._onFinish=function(){function e(){setTimeout(function(){t._destroy()},1e3)}var t=this;t.destroyed||(t.connected?e():t.once('connect',e))},r.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer(function(t){function a(){var a=e._pc.localDescription||t;e._debug('signal'),e.emit('signal',{type:a.type,sdp:a.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){e.destroyed||(e.trickle||e._iceComplete?a():e.once('_iceComplete',a))},function(t){e._destroy(t)}))},function(t){e._destroy(t)},e.offerConstraints)},r.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer(function(t){function a(){var a=e._pc.localDescription||t;e._debug('signal'),e.emit('signal',{type:a.type,sdp:a.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){e.destroyed||(e.trickle||e._iceComplete?a():e.once('_iceComplete',a))},function(t){e._destroy(t)}))},function(t){e._destroy(t)},e.answerConstraints)},r.prototype._onIceStateChange=function(){var e=this;if(!e.destroyed){var t=e._pc.iceConnectionState,a=e._pc.iceGatheringState;e._debug('iceStateChange (connection: %s) (gathering: %s)',t,a),e.emit('iceStateChange',t,a),('connected'===t||'completed'===t)&&(clearTimeout(e._reconnectTimeout),e._pcReady=!0,e._maybeReady()),'disconnected'===t&&(e.reconnectTimer?(clearTimeout(e._reconnectTimeout),e._reconnectTimeout=setTimeout(function(){e._destroy()},e.reconnectTimer)):e._destroy()),'failed'===t&&e._destroy(new Error('Ice connection failed.')),'closed'===t&&e._destroy()}},r.prototype.getStats=function(e){var t=this;0===t._pc.getStats.length?t._pc.getStats().then(function(t){var a=[];t.forEach(function(e){a.push(e)}),e(null,a)},function(t){e(t)}):t._isReactNativeWebrtc?t._pc.getStats(null,function(t){var a=[];t.forEach(function(e){a.push(e)}),e(null,a)},function(t){e(t)}):0<t._pc.getStats.length?t._pc.getStats(function(a){if(!t.destroyed){var r=[];a.result().forEach(function(e){var t={};e.names().forEach(function(a){t[a]=e.stat(a)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),e(null,r)}},function(t){e(t)}):e(null,[])},r.prototype._maybeReady=function(){function e(){t.destroyed||t.getStats(function(a,r){function n(e){s=!0;var a=i[e.localCandidateId];a&&a.ip?(t.localAddress=a.ip,t.localPort=+a.port):a&&a.ipAddress?(t.localAddress=a.ipAddress,t.localPort=+a.portNumber):'string'==typeof e.googLocalAddress&&(a=e.googLocalAddress.split(':'),t.localAddress=a[0],t.localPort=+a[1]);var r=o[e.remoteCandidateId];r&&r.ip?(t.remoteAddress=r.ip,t.remotePort=+r.port):r&&r.ipAddress?(t.remoteAddress=r.ipAddress,t.remotePort=+r.portNumber):'string'==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(':'),t.remoteAddress=r[0],t.remotePort=+r[1]),t.remoteFamily='IPv4',t._debug('connect local: %s:%s remote: %s:%s',t.localAddress,t.localPort,t.remoteAddress,t.remotePort)}if(!t.destroyed){a&&(r=[]);var o={},i={},d={},s=!1;if(r.forEach(function(e){('remotecandidate'===e.type||'remote-candidate'===e.type)&&(o[e.id]=e),('localcandidate'===e.type||'local-candidate'===e.type)&&(i[e.id]=e),('candidatepair'===e.type||'candidate-pair'===e.type)&&(d[e.id]=e)}),r.forEach(function(e){'transport'===e.type&&n(d[e.selectedCandidatePairId]),('googCandidatePair'===e.type&&'true'===e.googActiveConnection||('candidatepair'===e.type||'candidate-pair'===e.type)&&e.selected)&&n(e)}),!s&&r.length)return void setTimeout(e,100);if(t._connecting=!1,t.connected=!0,t._chunk){try{t.send(t._chunk)}catch(e){return t._destroy(e)}t._chunk=null,t._debug('sent chunk from "write before connect"');var l=t._cb;t._cb=null,l(null)}'number'!=typeof t._channel.bufferedAmountLowThreshold&&(t._interval=setInterval(function(){t._onInterval()},150),t._interval.unref&&t._interval.unref()),t._debug('connect'),t.emit('connect'),t._earlyMessage&&(t._onChannelMessage(t._earlyMessage),t._earlyMessage=null)}})}var t=this;t._debug('maybeReady pc %s channel %s',t._pcReady,t._channelReady);t.connected||t._connecting||!t._pcReady||!t._channelReady||(t._connecting=!0,e())},r.prototype._onInterval=function(){this._cb&&this._channel&&!(this._channel.bufferedAmount>u)&&this._onChannelBufferedAmountLow()},r.prototype._onSignalingStateChange=function(){var e=this;e.destroyed||(e._debug('signalingStateChange %s',e._pc.signalingState),e.emit('signalingStateChange',e._pc.signalingState))},r.prototype._onIceCandidate=function(e){var t=this;t.destroyed||(e.candidate&&t.trickle?t.emit('signal',{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&(t._iceComplete=!0,t.emit('_iceComplete')))},r.prototype._onChannelMessage=function(e){var a=this;if(!a.destroyed){var r=e.data;r instanceof ArrayBuffer&&(r=t.from(r)),a.push(r)}},r.prototype._onChannelBufferedAmountLow=function(){var e=this;if(!e.destroyed&&e._cb){e._debug('ending backpressure: bufferedAmount %d',e._channel.bufferedAmount);var t=e._cb;e._cb=null,t(null)}},r.prototype._onChannelOpen=function(){var e=this;e.connected||e.destroyed||(e._debug('on channel open'),e._channelReady=!0,e._maybeReady())},r.prototype._onChannelClose=function(){var e=this;e.destroyed||(e._debug('on channel close'),e._destroy())},r.prototype._onAddStream=function(e){var t=this;t.destroyed||(t._debug('on add stream'),t.emit('stream',e.stream))},r.prototype._onTrack=function(e){var t=this;if(!t.destroyed){t._debug('on track');var a=e.streams[0].id;-1!==t._previousStreams.indexOf(a)||(t._previousStreams.push(a),t.emit('stream',e.streams[0]))}},r.prototype._debug=function(){var e=this,t=[].slice.call(arguments);t[0]='['+e._id+'] '+t[0],o.apply(null,t)},r.prototype._transformConstraints=function(e){var t=this;if(0===Object.keys(e).length)return e;if((e.mandatory||e.optional)&&!t._isChromium){var a=Object.assign({},e.optional,e.mandatory);return void 0!==a.OfferToReceiveVideo&&(a.offerToReceiveVideo=a.OfferToReceiveVideo,delete a.OfferToReceiveVideo),void 0!==a.OfferToReceiveAudio&&(a.offerToReceiveAudio=a.OfferToReceiveAudio,delete a.OfferToReceiveAudio),a}return e.mandatory||e.optional||!t._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e})}}).call(t,a(8).Buffer)},function(e){var t={}.toString;e.exports=Array.isArray||function(e){return'[object Array]'==t.call(e)}},function(e,t,a){'use strict';(function(t,r){function n(e){return U.from(e)}function i(e){return U.isBuffer(e)||e instanceof G}function d(e,t,a){return'function'==typeof e.prependListener?e.prependListener(t,a):void(e._events&&e._events[t]?O(e._events[t])?e._events[t].unshift(a):e._events[t]=[a,e._events[t]]:e.on(t,a))}function s(e,t){F=F||a(4),e=e||{},this.objectMode=!!e.objectMode,t instanceof F&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=o(this.highWaterMark),this.buffer=new V,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||'utf8',this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(!Y&&(Y=a(16).StringDecoder),this.decoder=new Y(e.encoding),this.encoding=e.encoding)}function l(e){return F=F||a(4),this instanceof l?void(this._readableState=new s(e,this),this.readable=!0,e&&('function'==typeof e.read&&(this._read=e.read),'function'==typeof e.destroy&&(this._destroy=e.destroy)),M.call(this)):new l(e)}function u(e,t,a,r,o){var i=e._readableState;if(null===t)i.reading=!1,y(e,i);else{var d;o||(d=c(i,t)),d?e.emit('error',d):i.objectMode||t&&0<t.length?('string'!=typeof t&&!i.objectMode&&Object.getPrototypeOf(t)!==U.prototype&&(t=n(t)),r?i.endEmitted?e.emit('error',new Error('stream.unshift() after end event')):p(e,i,t,!0):i.ended?e.emit('error',new Error('stream.push() after EOF')):(i.reading=!1,i.decoder&&!a?(t=i.decoder.write(t),i.objectMode||0!==t.length?p(e,i,t,!1):_(e,i)):p(e,i,t,!1))):!r&&(i.reading=!1)}return f(i)}function p(e,t,a,r){t.flowing&&0===t.length&&!t.sync?(e.emit('data',a),e.read(0)):(t.length+=t.objectMode?1:a.length,r?t.buffer.unshift(a):t.buffer.push(a),t.needReadable&&h(e)),_(e,t)}function c(e,t){var a;return i(t)||'string'==typeof t||void 0===t||e.objectMode||(a=new TypeError('Invalid non-string/buffer chunk')),a}function f(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function g(e){return e>=q?e=q:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function m(e,t){return 0>=e||0===t.length&&t.ended?0:t.objectMode?1:e===e?(e>t.highWaterMark&&(t.highWaterMark=g(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0)):t.flowing&&t.length?t.buffer.head.data.length:t.length}function y(e,t){if(!t.ended){if(t.decoder){var a=t.decoder.end();a&&a.length&&(t.buffer.push(a),t.length+=t.objectMode?1:a.length)}t.ended=!0,h(e)}}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(H('emitReadable',t.flowing),t.emittedReadable=!0,t.sync?x(b,e):b(e))}function b(e){H('emit readable'),e.emit('readable'),A(e)}function _(e,t){t.readingMore||(t.readingMore=!0,x(T,e,t))}function T(e,t){for(var a=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(H('maybeReadMore read 0'),e.read(0),a!==t.length);)a=t.length;t.readingMore=!1}function E(e){return function(){var t=e._readableState;H('pipeOnDrain',t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&B(e,'data')&&(t.flowing=!0,A(e))}}function R(e){H('readable nexttick read 0'),e.read(0)}function S(e,t){t.resumeScheduled||(t.resumeScheduled=!0,x(v,e,t))}function v(e,t){t.reading||(H('resume read 0'),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit('resume'),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(H('flow',t.flowing);t.flowing&&null!==e.read(););}function L(e,t){if(0===t.length)return null;var a;return t.objectMode?a=t.buffer.shift():!e||e>=t.length?(a=t.decoder?t.buffer.join(''):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):a=D(e,t.buffer,t.decoder),a}function D(e,t,a){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):e===t.head.data.length?r=t.shift():r=a?C(e,t):k(e,t),r}function C(e,t){var a=t.head,r=1,n=a.data;for(e-=n.length;a=a.next;){var o=a.data,i=e>o.length?o.length:e;if(n+=i===o.length?o:o.slice(0,e),e-=i,0===e){i===o.length?(++r,t.head=a.next?a.next:t.tail=null):(t.head=a,a.data=o.slice(i));break}++r}return t.length-=r,n}function k(e,t){var a=U.allocUnsafe(e),r=t.head,n=1;for(r.data.copy(a),e-=r.data.length;r=r.next;){var o=r.data,i=e>o.length?o.length:e;if(o.copy(a,a.length-e,0,i),e-=i,0===e){i===o.length?(++n,t.head=r.next?r.next:t.tail=null):(t.head=r,r.data=o.slice(i));break}++n}return t.length-=n,a}function I(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,x(P,t,e))}function P(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit('end'))}function w(e,t){for(var a=0,r=e.length;a<r;a++)if(e[a]===t)return a;return-1}var x=a(9);e.exports=l;var O=a(11),F;l.ReadableState=s;var N=a(0).EventEmitter,B=function(e,t){return e.listeners(t).length},M=a(13),U=a(5).Buffer,G=t.Uint8Array||function(){},W=a(6);W.inherits=a(3);var K=a(29),H;H=K&&K.debuglog?K.debuglog('stream'):function(){};var V=a(30),j=a(14),Y;W.inherits(l,M);var z=['error','close','destroy','pause','resume'];Object.defineProperty(l.prototype,'destroyed',{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),l.prototype.destroy=j.destroy,l.prototype._undestroy=j.undestroy,l.prototype._destroy=function(e,t){this.push(null),t(e)},l.prototype.push=function(e,t){var a=this._readableState,r;return a.objectMode?r=!0:'string'==typeof e&&(t=t||a.defaultEncoding,t!==a.encoding&&(e=U.from(e,t),t=''),r=!0),u(this,e,t,!1,r)},l.prototype.unshift=function(e){return u(this,e,null,!0,!1)},l.prototype.isPaused=function(){return!1===this._readableState.flowing},l.prototype.setEncoding=function(e){return Y||(Y=a(16).StringDecoder),this._readableState.decoder=new Y(e),this._readableState.encoding=e,this};var q=8388608;l.prototype.read=function(e){H('read',e),e=parseInt(e,10);var t=this._readableState,a=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return H('read: emitReadable',t.length,t.ended),0===t.length&&t.ended?I(this):h(this),null;if(e=m(e,t),0===e&&t.ended)return 0===t.length&&I(this),null;var r=t.needReadable;H('need readable',r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,H('length less than watermark',r)),t.ended||t.reading?(r=!1,H('reading or ended',r)):r&&(H('do read'),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,!t.reading&&(e=m(a,t)));var n;return n=0<e?L(e,t):null,null===n?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(!t.ended&&(t.needReadable=!0),a!==e&&t.ended&&I(this)),null!==n&&this.emit('data',n),n},l.prototype._read=function(){this.emit('error',new Error('_read() is not implemented'))},l.prototype.pipe=function(e,t){function a(e,t){H('onunpipe'),e===c&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,o())}function n(){H('onend'),e.end()}function o(){H('cleanup'),e.removeListener('close',l),e.removeListener('finish',u),e.removeListener('drain',y),e.removeListener('error',s),e.removeListener('unpipe',a),c.removeListener('end',n),c.removeListener('end',p),c.removeListener('data',i),h=!0,f.awaitDrain&&(!e._writableState||e._writableState.needDrain)&&y()}function i(t){H('ondata'),b=!1;var a=e.write(t);!1!==a||b||((1===f.pipesCount&&f.pipes===e||1<f.pipesCount&&-1!==w(f.pipes,e))&&!h&&(H('false write response, pause',c._readableState.awaitDrain),c._readableState.awaitDrain++,b=!0),c.pause())}function s(t){H('onerror',t),p(),e.removeListener('error',s),0===B(e,'error')&&e.emit('error',t)}function l(){e.removeListener('finish',u),p()}function u(){H('onfinish'),e.removeListener('close',l),p()}function p(){H('unpipe'),c.unpipe(e)}var c=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=e;break;case 1:f.pipes=[f.pipes,e];break;default:f.pipes.push(e);}f.pipesCount+=1,H('pipe count=%d opts=%j',f.pipesCount,t);var g=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr,m=g?n:p;f.endEmitted?x(m):c.once('end',m),e.on('unpipe',a);var y=E(c);e.on('drain',y);var h=!1,b=!1;return c.on('data',i),d(e,'error',s),e.once('close',l),e.once('finish',u),e.emit('pipe',c),f.flowing||(H('pipe resume'),c.resume()),e},l.prototype.unpipe=function(e){var t=this._readableState,a={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit('unpipe',this,a),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<n;o++)r[o].emit('unpipe',this,a);return this}var i=w(t.pipes,e);return-1===i?this:(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit('unpipe',this,a),this)},l.prototype.on=function(e,t){var a=M.prototype.on.call(this,e,t);if('data'===e)!1!==this._readableState.flowing&&this.resume();else if('readable'===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&h(this):x(R,this))}return a},l.prototype.addListener=l.prototype.on,l.prototype.resume=function(){var e=this._readableState;return e.flowing||(H('resume'),e.flowing=!0,S(this,e)),this},l.prototype.pause=function(){return H('call pause flowing=%j',this._readableState.flowing),!1!==this._readableState.flowing&&(H('pause'),this._readableState.flowing=!1,this.emit('pause')),this},l.prototype.wrap=function(e){var t=this._readableState,a=!1,r=this;for(var o in e.on('end',function(){if(H('wrapped end'),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on('data',function(n){if((H('wrapped data'),t.decoder&&(n=t.decoder.write(n)),!(t.objectMode&&(null===n||void 0===n)))&&(t.objectMode||n&&n.length)){var o=r.push(n);o||(a=!0,e.pause())}}),e)void 0===this[o]&&'function'==typeof e[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));for(var i=0;i<z.length;i++)e.on(z[i],r.emit.bind(r,z[i]));return r._read=function(t){H('wrapped _read',t),a&&(a=!1,e.resume())},r},l._fromList=L}).call(t,a(1),a(2))},function(e,t,a){e.exports=a(0).EventEmitter},function(e,t,a){'use strict';function r(e,t){e.emit('error',t)}var n=a(9);e.exports={destroy:function(e,t){var a=this,o=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return o||i?void(t?t(e):e&&(!this._writableState||!this._writableState.errorEmitted)&&n(r,this,e)):void(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n(r,a,e),a._writableState&&(a._writableState.errorEmitted=!0)):t&&t(e)}))},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,a){'use strict';(function(t,r,n){function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){C(t,e)}}function d(e){return F.from(e)}function s(e){return F.isBuffer(e)||e instanceof N}function l(){}function u(e,t){P=P||a(4),e=e||{},this.objectMode=!!e.objectMode,t instanceof P&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=o(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===e.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=e.defaultEncoding||'utf8',this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){_(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function p(e){return P=P||a(4),M.call(p,this)||this instanceof P?void(this._writableState=new u(e,this),this.writable=!0,e&&('function'==typeof e.write&&(this._write=e.write),'function'==typeof e.writev&&(this._writev=e.writev),'function'==typeof e.destroy&&(this._destroy=e.destroy),'function'==typeof e.final&&(this._final=e.final)),O.call(this)):new p(e)}function c(e,t){var a=new Error('write after end');e.emit('error',a),k(t,a)}function f(e,t,a,r){var n=!0,o=!1;return null===a?o=new TypeError('May not write null values to stream'):'string'!=typeof a&&void 0!==a&&!t.objectMode&&(o=new TypeError('Invalid non-string/buffer chunk')),o&&(e.emit('error',o),k(r,o),n=!1),n}function g(e,t,a){return e.objectMode||!1===e.decodeStrings||'string'!=typeof t||(t=F.from(t,a)),t}function m(e,t,a,r,n,o){if(!a){var i=g(t,r,n);r!==i&&(a=!0,n='buffer',r=i)}var d=t.objectMode?1:r.length;t.length+=d;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:n,isBuf:a,callback:o,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,d,r,n,o);return s}function y(e,t,a,r,n,o,i){t.writelen=r,t.writecb=i,t.writing=!0,t.sync=!0,a?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function h(e,t,a,r,n){--t.pendingcb,a?(k(n,r),k(L,e,t),e._writableState.errorEmitted=!0,e.emit('error',r)):(n(r),e._writableState.errorEmitted=!0,e.emit('error',r),L(e,t))}function b(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function _(e,t){var a=e._writableState,r=a.sync,n=a.writecb;if(b(a),t)h(e,a,r,t,n);else{var o=S(a);o||a.corked||a.bufferProcessing||!a.bufferedRequest||R(e,a),r?I(T,e,a,o,n):T(e,a,o,n)}}function T(e,t,a,r){a||E(e,t),t.pendingcb--,r(),L(e,t)}function E(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit('drain'))}function R(e,t){t.bufferProcessing=!0;var a=t.bufferedRequest;if(e._writev&&a&&a.next){var r=t.bufferedRequestCount,n=Array(r),o=t.corkedRequestsFree;o.entry=a;for(var d=0,s=!0;a;)n[d]=a,a.isBuf||(s=!1),a=a.next,d+=1;n.allBuffers=s,y(e,t,!0,t.length,n,'',o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new i(t)}else{for(;a;){var l=a.chunk,u=a.encoding,p=a.callback,c=t.objectMode?1:l.length;if(y(e,t,!1,c,l,u,p),a=a.next,t.writing)break}null===a&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=a,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function v(e,t){e._final(function(a){t.pendingcb--,a&&e.emit('error',a),t.prefinished=!0,e.emit('prefinish'),L(e,t)})}function A(e,t){t.prefinished||t.finalCalled||('function'==typeof e._final?(t.pendingcb++,t.finalCalled=!0,k(v,e,t)):(t.prefinished=!0,e.emit('prefinish')))}function L(e,t){var a=S(t);return a&&(A(e,t),0===t.pendingcb&&(t.finished=!0,e.emit('finish'))),a}function D(e,t,a){t.ending=!0,L(e,t),a&&(t.finished?k(a):e.once('finish',a)),t.ended=!0,e.writable=!1}function C(e,t,a){var r=e.entry;for(e.entry=null;r;){var n=r.callback;t.pendingcb--,n(a),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}var k=a(9);e.exports=p;var I=!t.browser&&-1<['v0.10','v0.9.'].indexOf(t.version.slice(0,5))?r:k,P;p.WritableState=u;var w=a(6);w.inherits=a(3);var x={deprecate:a(33)},O=a(13),F=a(5).Buffer,N=n.Uint8Array||function(){},B=a(14);w.inherits(p,O),u.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(u.prototype,'buffer',{get:x.deprecate(function(){return this.getBuffer()},'_writableState.buffer is deprecated. Use _writableState.getBuffer instead.','DEP0003')})}catch(e){}}();var M;'function'==typeof Symbol&&Symbol.hasInstance&&'function'==typeof Function.prototype[Symbol.hasInstance]?(M=Function.prototype[Symbol.hasInstance],Object.defineProperty(p,Symbol.hasInstance,{value:function(e){return!!M.call(this,e)||e&&e._writableState instanceof u}})):M=function(e){return e instanceof this},p.prototype.pipe=function(){this.emit('error',new Error('Cannot pipe, not readable'))},p.prototype.write=function(e,t,a){var r=this._writableState,n=!1,o=s(e)&&!r.objectMode;return o&&!F.isBuffer(e)&&(e=d(e)),'function'==typeof t&&(a=t,t=null),o?t='buffer':!t&&(t=r.defaultEncoding),'function'!=typeof a&&(a=l),r.ended?c(this,a):(o||f(this,r,e,a))&&(r.pendingcb++,n=m(this,r,o,e,t,a)),n},p.prototype.cork=function(){var e=this._writableState;e.corked++},p.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,!e.writing&&!e.corked&&!e.finished&&!e.bufferProcessing&&e.bufferedRequest&&R(this,e))},p.prototype.setDefaultEncoding=function(e){if('string'==typeof e&&(e=e.toLowerCase()),!(-1<['hex','utf8','utf-8','ascii','binary','base64','ucs2','ucs-2','utf16le','utf-16le','raw'].indexOf((e+'').toLowerCase())))throw new TypeError('Unknown encoding: '+e);return this._writableState.defaultEncoding=e,this},p.prototype._write=function(e,t,a){a(new Error('_write() is not implemented'))},p.prototype._writev=null,p.prototype.end=function(e,t,a){var r=this._writableState;'function'==typeof e?(a=e,e=null,t=null):'function'==typeof t&&(a=t,t=null),null!==e&&e!==void 0&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||D(this,r,a)},Object.defineProperty(p.prototype,'destroyed',{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),p.prototype.destroy=B.destroy,p.prototype._undestroy=B.undestroy,p.prototype._destroy=function(e,t){this.end(),t(e)}}).call(t,a(2),a(31).setImmediate,a(1))},function(e,t,a){'use strict';function r(e){if(!e)return'utf8';for(var t;;)switch(e){case'utf8':case'utf-8':return'utf8';case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return'utf16le';case'latin1':case'binary':return'latin1';case'base64':case'ascii':case'hex':return e;default:if(t)return;e=(''+e).toLowerCase(),t=!0;}}function n(e){var t=r(e);if('string'!=typeof t&&(y.isEncoding===h||!h(e)))throw new Error('Unknown encoding: '+e);return t||e}function o(e){this.encoding=n(e);var t;switch(this.encoding){case'utf16le':this.text=u,this.end=p,t=4;break;case'utf8':this.fillLast=l,t=4;break;case'base64':this.text=c,this.end=f,t=3;break;default:return this.write=g,void(this.end=m);}this.lastNeed=0,this.lastTotal=0,this.lastChar=y.allocUnsafe(t)}function d(e){if(127>=e)return 0;return 6==e>>5?2:14==e>>4?3:30==e>>3?4:-1}function s(e,t,a){var r=t.length-1;if(r<a)return 0;var n=d(t[r]);return 0<=n?(0<n&&(e.lastNeed=n-1),n):--r<a?0:(n=d(t[r]),0<=n)?(0<n&&(e.lastNeed=n-2),n):--r<a?0:(n=d(t[r]),0<=n?(0<n&&(2===n?n=0:e.lastNeed=n-3),n):0)}function i(e,t,a){if(128!=(192&t[0]))return e.lastNeed=0,'\uFFFD'.repeat(a);if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,'\uFFFD'.repeat(a+1);if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,'\uFFFD'.repeat(a+2)}}function l(e){var t=this.lastTotal-this.lastNeed,a=i(this,e,t);return void 0===a?this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,t,0,e.length),this.lastNeed-=e.length):a}function u(e,t){if(0==(e.length-t)%2){var a=e.toString('utf16le',t);if(a){var r=a.charCodeAt(a.length-1);if(55296<=r&&56319>=r)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],a.slice(0,-1)}return a}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString('utf16le',t,e.length-1)}function p(e){var t=e&&e.length?this.write(e):'';if(this.lastNeed){var a=this.lastTotal-this.lastNeed;return t+this.lastChar.toString('utf16le',0,a)}return t}function c(e,t){var a=(e.length-t)%3;return 0==a?e.toString('base64',t):(this.lastNeed=3-a,this.lastTotal=3,1==a?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString('base64',t,e.length-a))}function f(e){var t=e&&e.length?this.write(e):'';return this.lastNeed?t+this.lastChar.toString('base64',0,3-this.lastNeed):t}function g(e){return e.toString(this.encoding)}function m(e){return e&&e.length?this.write(e):''}var y=a(5).Buffer,h=y.isEncoding||function(e){switch(e=''+e,e&&e.toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':case'raw':return!0;default:return!1;}};t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return'';var t,a;if(this.lastNeed){if(t=this.fillLast(e),void 0===t)return'';a=this.lastNeed,this.lastNeed=0}else a=0;return a<e.length?t?t+this.text(e,a):this.text(e,a):t||''},o.prototype.end=function(e){var t=e&&e.length?this.write(e):'';return this.lastNeed?t+'\uFFFD'.repeat(this.lastTotal-this.lastNeed):t},o.prototype.text=function(e,t){var a=s(this,e,t);if(!this.lastNeed)return e.toString('utf8',t);this.lastTotal=a;var r=e.length-(a-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString('utf8',t,r)},o.prototype.fillLast=function(e){return this.lastNeed<=e.length?(e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):void(e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length)}},function(e,t,a){'use strict';function r(e){this.afterTransform=function(t,a){return n(e,t,a)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function n(e,t,a){var r=e._transformState;r.transforming=!1;var n=r.writecb;if(!n)return e.emit('error',new Error('write callback called multiple times'));r.writechunk=null,r.writecb=null,null!==a&&a!==void 0&&e.push(a),n(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);d.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&('function'==typeof e.transform&&(this._transform=e.transform),'function'==typeof e.flush&&(this._flush=e.flush)),this.once('prefinish',function(){'function'==typeof this._flush?this._flush(function(e,a){i(t,e,a)}):i(t)})}function i(e,t,a){if(t)return e.emit('error',t);null!==a&&a!==void 0&&e.push(a);var r=e._writableState,n=e._transformState;if(r.length)throw new Error('Calling transform done when ws.length != 0');if(n.transforming)throw new Error('Calling transform done when still transforming');return e.push(null)}e.exports=o;var d=a(4),s=a(6);s.inherits=a(3),s.inherits(o,d),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,d.prototype.push.call(this,e,t)},o.prototype._transform=function(){throw new Error('_transform() is not implemented')},o.prototype._write=function(e,t,a){var r=this._transformState;if(r.writecb=a,r.writechunk=e,r.writeencoding=t,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},o.prototype._read=function(){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(e,t){var a=this;d.prototype._destroy.call(this,e,function(e){t(e),a.emit('close')})}},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function i(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,'__esModule',{value:!0});var d=a(19),s=r(d),l=a(39),u=r(l),p=a(40),c=r(p),f=a(7),g=new c.default().getResult(),m=function(e){function t(e){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n(this,t);var r=Object.assign({},f.recommendedHlsjsConfig,a),i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return s.default.WEBRTC_SUPPORT&&(i.p2pPlugin=new s.default(i,e)),i}return i(t,e),t}(u.default);m.pluginVersion=s.default.version,t.default=m,e.exports=t['default']},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function i(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,'__esModule',{value:!0});var d=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),s=a(0),l=r(s),u=a(7),p=a(20),c=r(p),f=a(10),g=r(f),m=a(35),y=r(m),h=function(e){function t(e,a){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r.peerId=(0,c.default)(),console.log('peerId: '+r.peerId),r.hlsjs=e,r.config=Object.assign({},u.defaultP2PConfig,a),e.url){var i=e.url.split('?')[0];r._init(i)}else e.on(e.constructor.Events.MANIFEST_PARSED,function(){var t=e.url.split('?')[0];r._init(t)});return r}return i(t,e),d(t,[{key:'_init',value:function(e){this.signaler=new y.default(e,this.peerId),this.hlsjs.on(hlsjs.constructor.Events.FRAG_CHANGED,function(e,t){console.log('FRAG_CHANGED: '+JSON.stringify(t))}),this.hlsjs.on(hlsjs.constructor.Events.DESTROYING,function(e,t){console.log('FRAG_CHANGED: '+JSON.stringify(t)),this.signaler.destroy(),this.signaler=null})}},{key:'stop',value:function(){}}]),t}(l.default);h.WEBRTC_SUPPORT=g.default.WEBRTC_SUPPORT,h.version='0.0.1',t.default=h,e.exports=t['default']},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(){for(var e=parseInt(new Date().valueOf()/1e3),t='0123456789qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM',a='',n=0;n<9;n++)a+=t.charAt(r(1e8*Math.random())%t.length);return e+'-'+a},e.exports=t['default']},function(e,t){'use strict';function a(e){var t=e.length;if(0<t%4)throw new Error('Invalid string. Length must be a multiple of 4');return'='===e[t-2]?2:'='===e[t-1]?1:0}function r(e){return o[63&e>>18]+o[63&e>>12]+o[63&e>>6]+o[63&e]}function n(e,t,a){for(var n=[],o=t,i;o<a;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],n.push(r(i));return n.join('')}t.byteLength=function(e){return 3*e.length/4-a(e)},t.toByteArray=function(e){var t=e.length,r,n,o,i,l;i=a(e),l=new s(3*t/4-i),n=0<i?t-4:t;var u=0;for(r=0;r<n;r+=4)o=d[e.charCodeAt(r)]<<18|d[e.charCodeAt(r+1)]<<12|d[e.charCodeAt(r+2)]<<6|d[e.charCodeAt(r+3)],l[u++]=255&o>>16,l[u++]=255&o>>8,l[u++]=255&o;return 2===i?(o=d[e.charCodeAt(r)]<<2|d[e.charCodeAt(r+1)]>>4,l[u++]=255&o):1===i&&(o=d[e.charCodeAt(r)]<<10|d[e.charCodeAt(r+1)]<<4|d[e.charCodeAt(r+2)]>>2,l[u++]=255&o>>8,l[u++]=255&o),l},t.fromByteArray=function(e){for(var t=e.length,a=t%3,r='',d=[],s=16383,l=0,i=t-a,u;l<i;l+=s)d.push(n(e,l,l+s>i?i:l+s));return 1==a?(u=e[t-1],r+=o[u>>2],r+=o[63&u<<4],r+='=='):2==a&&(u=(e[t-2]<<8)+e[t-1],r+=o[u>>10],r+=o[63&u>>4],r+=o[63&u<<2],r+='='),d.push(r),d.join('')};for(var o=[],d=[],s='undefined'==typeof Uint8Array?Array:Uint8Array,l='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',u=0,i=l.length;u<i;++u)o[u]=l[u],d[l.charCodeAt(u)]=u;d[45]=62,d[95]=63},function(e,t){t.read=function(t,a,r,o,l){var u=8*l-o-1,p=(1<<u)-1,c=p>>1,f=-7,g=r?l-1:0,i=r?-1:1,d=t[a+g],s,e;for(g+=i,s=d&(1<<-f)-1,d>>=-f,f+=u;0<f;s=256*s+t[a+g],g+=i,f-=8);for(e=s&(1<<-f)-1,s>>=-f,f+=o;0<f;e=256*e+t[a+g],g+=i,f-=8);if(0===s)s=1-c;else{if(s===p)return e?NaN:(d?-1:1)*Infinity;e+=n(2,o),s-=c}return(d?-1:1)*e*n(2,s-o)},t.write=function(t,r,l,u,p,f){var g=8*f-p-1,y=(1<<g)-1,h=y>>1,b=23===p?5.960464477539063e-8-6.617444900424222e-24:0,_=u?0:f-1,i=u?1:-1,d=0>r||0===r&&0>1/r?1:0,s,T,m;for(r=a(r),isNaN(r)||r===Infinity?(T=isNaN(r)?1:0,s=y):(s=o(Math.log(r)/Math.LN2),1>r*(m=n(2,-s))&&(s--,m*=2),r+=1<=s+h?b/m:b*n(2,1-h),2<=r*m&&(s++,m/=2),s+h>=y?(T=0,s=y):1<=s+h?(T=(r*m-1)*n(2,p),s+=h):(T=r*n(2,h-1)*n(2,p),s=0));8<=p;t[l+_]=255&T,_+=i,T/=256,p-=8);for(s=s<<p|T,g+=p;0<g;t[l+_]=255&s,_+=i,s/=256,g-=8);t[l+_-i]|=128*d}},function(e,t,a){(function(n){function r(){var e;try{e=t.storage.debug}catch(t){}return!e&&'undefined'!=typeof n&&'env'in n&&(e=n.env.DEBUG),e}t=e.exports=a(24),t.log=function(){return'object'==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var a=this.useColors;if(e[0]=(a?'%c':'')+this.namespace+(a?' %c':' ')+e[0]+(a?'%c ':' ')+'+'+t.humanize(this.diff),!!a){var r='color: '+this.color;e.splice(1,0,r,'color: inherit');var n=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){'%%'===e||(n++,'%c'===e&&(o=n))}),e.splice(o,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem('debug'):t.storage.debug=e}catch(t){}},t.load=r,t.useColors=function(){return'undefined'!=typeof window&&window.process&&'renderer'===window.process.type||'undefined'!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||'undefined'!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||'undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||'undefined'!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage='undefined'!=typeof chrome&&'undefined'!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),t.colors=['lightseagreen','forestgreen','goldenrod','dodgerblue','darkorchid','crimson'],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return'[UnexpectedJSONParseError]: '+e.message}},t.enable(r())}).call(t,a(2))},function(e,t,r){function n(e){var r=0,n;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[a(r)%t.colors.length]}function o(e){function a(){if(a.enabled){var e=a,r=+new Date,n=r-(d||r);e.diff=n,e.prev=d,e.curr=r,d=r;for(var o=Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),'string'!=typeof o[0]&&o.unshift('%O');var i=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(a,r){if('%%'===a)return a;i++;var n=t.formatters[r];if('function'==typeof n){var d=o[i];a=n.call(e,d),o.splice(i,1),i--}return a}),t.formatArgs.call(e,o);var l=a.log||t.log||console.log.bind(console);l.apply(e,o)}}return a.namespace=e,a.enabled=t.enabled(e),a.useColors=t.useColors(),a.color=n(e),'function'==typeof t.init&&t.init(a),a}t=e.exports=o.debug=o['default']=o,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable('')},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var a=('string'==typeof e?e:'').split(/[\s,]+/),r=a.length,n=0;n<r;n++)a[n]&&(e=a[n].replace(/\*/g,'.*?'),'-'===e[0]?t.skips.push(new RegExp('^'+e.substr(1)+'$')):t.names.push(new RegExp('^'+e+'$')))},t.enabled=function(e){var a,r;for(a=0,r=t.skips.length;a<r;a++)if(t.skips[a].test(e))return!1;for(a=0,r=t.names.length;a<r;a++)if(t.names[a].test(e))return!0;return!1},t.humanize=r(25),t.names=[],t.skips=[],t.formatters={};var d},function(e){function a(e){if(e+='',!(100<e.length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var a=parseFloat(t[1]),r=(t[2]||'ms').toLowerCase();return'years'===r||'year'===r||'yrs'===r||'yr'===r||'y'===r?a*d:'days'===r||'day'===r||'d'===r?a*c:'hours'===r||'hour'===r||'hrs'===r||'hr'===r||'h'===r?a*p:'minutes'===r||'minute'===r||'mins'===r||'min'===r||'m'===r?a*s:'seconds'===r||'second'===r||'secs'===r||'sec'===r||'s'===r?a*u:'milliseconds'===r||'millisecond'===r||'msecs'===r||'msec'===r||'ms'===r?a:void 0}}}function n(e){return e>=c?t(e/c)+'d':e>=p?t(e/p)+'h':e>=s?t(e/s)+'m':e>=u?t(e/u)+'s':e+'ms'}function i(e){return l(e,c,'day')||l(e,p,'hour')||l(e,s,'minute')||l(e,u,'second')||e+' ms'}function l(e,t,a){return e<t?void 0:e<1.5*t?o(e/t)+' '+a:r(e/t)+' '+a+'s'}var u=1e3,s=60*u,p=60*s,c=24*p,d=365.25*c;e.exports=function(e,t){t=t||{};var r=typeof e;if('string'==r&&0<e.length)return a(e);if('number'==r&&!1===isNaN(e))return t.long?i(e):n(e);throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(e))}},function(e){e.exports=function(){if('undefined'==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},function(e,t,a){'use strict';(function(t,r){var n=a(5).Buffer,o=t.crypto||t.msCrypto;e.exports=o&&o.getRandomValues?function(e,a){if(65536<e)throw new Error('requested too many random bytes');var i=new t.Uint8Array(e);0<e&&o.getRandomValues(i);var d=n.from(i.buffer);return'function'==typeof a?r.nextTick(function(){a(null,d)}):d}:function(){throw new Error('secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11')}}).call(t,a(1),a(2))},function(e,t,a){t=e.exports=a(12),t.Stream=t,t.Readable=t,t.Writable=a(15),t.Duplex=a(4),t.Transform=a(17),t.PassThrough=a(34)},function(){},function(e,t,a){'use strict';function r(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t,a){e.copy(t,a)}var d=a(5).Buffer;e.exports=function(){function e(){r(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return'';for(var t=this.head,a=''+t.data;t=t.next;)a+=e+t.data;return a},e.prototype.concat=function(e){if(0===this.length)return d.alloc(0);if(1===this.length)return this.head.data;for(var t=d.allocUnsafe(e>>>0),a=this.head,r=0;a;)o(a.data,t,r),r+=a.data.length,a=a.next;return t},e}()},function(e,t,a){function r(e,t){this._id=e,this._clearFn=t}var n=Function.prototype.apply;t.setTimeout=function(){return new r(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},a(32),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,a){(function(e,t){(function(e){'use strict';function a(e){'function'!=typeof e&&(e=new Function(''+e));for(var t=Array(arguments.length-1),a=0;a<t.length;a++)t[a]=arguments[a+1];var r={callback:e,args:t};return f[c]=r,h(c),c++}function r(e){delete f[e]}function n(e){var t=e.callback,a=e.args;switch(a.length){case 0:t();break;case 1:t(a[0]);break;case 2:t(a[0],a[1]);break;case 3:t(a[0],a[1],a[2]);break;default:t.apply(void 0,a);}}function o(e){if(g)setTimeout(o,0,e);else{var t=f[e];if(t){g=!0;try{n(t)}finally{r(e),g=!1}}}}function i(){h=function(e){t.nextTick(function(){o(e)})}}function d(){if(e.postMessage&&!e.importScripts){var t=!0,a=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage('','*'),e.onmessage=a,t}}function s(){var t='setImmediate$'+Math.random()+'$',a=function(a){a.source===e&&'string'==typeof a.data&&0===a.data.indexOf(t)&&o(+a.data.slice(t.length))};e.addEventListener?e.addEventListener('message',a,!1):e.attachEvent('onmessage',a),h=function(a){e.postMessage(t+a,'*')}}function l(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;o(t)},h=function(t){e.port2.postMessage(t)}}function u(){var e=m.documentElement;h=function(t){var a=m.createElement('script');a.onreadystatechange=function(){o(t),a.onreadystatechange=null,e.removeChild(a),a=null},e.appendChild(a)}}function p(){h=function(e){setTimeout(o,0,e)}}if(!e.setImmediate){var c=1,f={},g=!1,m=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e),h;y=y&&y.setTimeout?y:e,'[object process]'==={}.toString.call(e.process)?i():d()?s():e.MessageChannel?l():m&&'onreadystatechange'in m.createElement('script')?u():p(),y.setImmediate=a,y.clearImmediate=r}})('undefined'==typeof self?'undefined'==typeof e?this:e:self)}).call(t,a(1),a(2))},function(e,t,a){(function(t){function a(e){try{if(!t.localStorage)return!1}catch(e){return!1}var a=t.localStorage[e];return null!=a&&'true'===(a+'').toLowerCase()}e.exports=function(e,t){if(a('noDeprecation'))return e;var r=!1;return function(){if(!r){if(a('throwDeprecation'))throw new Error(t);else a('traceDeprecation')?console.trace(t):console.warn(t);r=!0}return e.apply(this,arguments)}}}).call(t,a(1))},function(e,t,a){'use strict';function r(e){return this instanceof r?void n.call(this,e):new r(e)}e.exports=r;var n=a(17),o=a(6);o.inherits=a(3),o.inherits(r,n),r.prototype._transform=function(e,t,a){a(null,e)}},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function i(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,'__esModule',{value:!0});var d=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),s=a(0),l=r(s),u=a(7),p=a(36),c=r(p),f=a(37),g=r(f),m=function(e){function t(e,a){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.connected=!1,r.channel=e,r.peerId=a,console.log('connecting to :'+u.defaultP2PConfig.websocketAddr),r.websocket=new WebSocket(u.defaultP2PConfig.websocketAddr),r._init(r.websocket),r.scheduler=new g.default,r}return i(t,e),d(t,[{key:'_init',value:function(e){var t=this;e.onopen=function(){console.log('websocket connection opened with channel: '+t.channel),t.connected=!0;var a={action:'enter',peer_id:t.peerId,channel:t.channel};e.push(JSON.stringify(a))},e.push=e.send,e.send=function(a){if(1!=e.readyState)return console.warn('websocket connection is not opened yet.'),setTimeout(function(){e.send(data)},1e3);var r=JSON.stringify(Object.assign({channel:t.channel},a));console.log('send to signal is '+r),e.push(r)},e.onmessage=function(a){console.log('websocket on msg: '+a.data);var e=JSON.parse(a.data),r=e.action;switch(r){case'signal':console.log('start _handleSignal'),t._handleSignal(e.data);break;case'connect':console.log('start _handleConnect'),t._handleConnect(e.to_peer_id,e.initiator);break;case'disconnect':break;case'accept':break;case'reject':break;default:console.log('websocket unknown action '+r);}}}},{key:'_handleSignal',value:function(e){this.datachannel.receiveSignal(e)}},{key:'_handleConnect',value:function(e,t){var a=new c.default(e,t);this.datachannel=a,this._setupDC(a)}},{key:'_setupDC',value:function(e){var t=this;e.on('signal',function(a){var r={action:'signal',peer_id:t.peerId,to_peer_id:e.channelId,data:a};t.websocket.send(r)}).on('error',function(){e.destroy();var a={action:'dc_failed',peer_id:t.peerId,to_peer_id:e.channelId};t.websocket.send(a)}).on('close',function(){e.destroy()}).on('open',function(){t.scheduler.addDataChannel(e);var a={action:'dc_opened',peer_id:t.peerId,to_peer_id:e.channelId};t.websocket.send(a)})}},{key:'destroy',value:function(){this.websocket.close(),this.websocket=null}}]),t}(l.default);t.default=m,e.exports=t['default']},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function i(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,'__esModule',{value:!0});var d=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),s=a(10),l=r(s),u=a(0),p=r(u),c=a(7),f=a(8),g=r(f),m=function(e){function t(e,a){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.channelId=e,r.connected=!1,r._datachannel=new l.default({initiator:a,objectMode:!0}),r.isReceiver=a,r._init(r._datachannel),r}return i(t,e),d(t,[{key:'_init',value:function(e){var t=this;e.on('error',function(e){console.log('datachannel error',e)}),e.on('signal',function(e){t.emit('signal',e)}),e.once('connect',function(){console.log('datachannel CONNECTED to '+t.channelId),t.emit('open'),t.isReceiver&&(t.keepAliveInterval=window.setInterval(function(){e.send(JSON.stringify({event:'KEEPALIVE'})),t.keepAliveAckTimeout=window.setTimeout(t._handleKeepAliveAckTimeout.bind(t),1e3*c.defaultP2PConfig.dcKeepAliveAckTimeout)},1e3*c.defaultP2PConfig.dcKeepAliveInterval))}),e.on('data',function(e){if('string'==typeof e){console.log('datachannel receive string: '+e);var a=JSON.parse(e),r=a.event;switch(r){case'KEEPALIVE':t._handleKeepAlive();break;case'KEEPALIVE-ACK':t._handleKeepAliveAck();break;case'BINARY':t._prepareForBinary(a.attachments,a.url,a.size);break;case'REQUEST':t.emit('request',a);break;case'LACK':t.emit('datanotfound',a);break;case'CLOSE':t.emit('close');break;default:}}else e instanceof g.default&&(t.bufArr.push(e),t.remainAttachments--,0===t.incomingAttachments&&t._handleBanaryData())}),e.once('close',function(){})}},{key:'send',value:function(e){this._datachannel.connected&&this._datachannel.send(e)}},{key:'receiveSignal',value:function(e){console.log('datachannel receive siganl '+JSON.stringify(e)),this._datachannel.signal(e)}},{key:'destroy',value:function(){window.clearInterval(this.keepAliveInterval),this.keepAliveInterval=null,window.clearTimeout(this.keepAliveAckTimeout),this.keepAliveAckTimeout=null,this._datachannel.removeAllListeners(),this.removeAllListeners(),this._datachannel.destroy()}},{key:'_prepareForBinary',value:function(e,t,a){this.bufArr=[],this.remainAttachments=e,this.bufUrl=t,this.expectedSize=a}},{key:'_handleBanaryData',value:function(){var e=g.default.concat(this.bufArr);e.byteLength==this.expectedSize&&this.emit('response',{url:this.bufUrl,payload:e}),this.bufUrl='',this.bufArr=[],this.expectedSize=-1}},{key:'_handleKeepAlive',value:function(){this._datachannel.send(JSON.stringify({event:'KEEPALIVE-ACK'}))}},{key:'_handleKeepAliveAck',value:function(){window.clearTimeout(this.keepAliveAckTimeout)}},{key:'_handleKeepAliveAckTimeout',value:function(){console.warn('KeepAliveAckTimeout'),this.emit('error')}}]),t}(p.default);t.default=m,e.exports=t['default']},function(e,t,a){'use strict';function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function i(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,'__esModule',{value:!0});var d=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),s=a(0),l=r(s),u=a(38),p=r(u),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.upstreamers=[],e.downstreamers=[],e}return i(t,e),d(t,[{key:'_addUpStreamer',value:function(e){this.upstreamers.push(e)}},{key:'_addDownStreamer',value:function(e){this.downstreamers.push(e)}},{key:'addDataChannel',value:function(e){e.isReceiver?this._addUpStreamer(e):this._addDownStreamer(e)}},{key:'deleteDataChannel',value:function(e){for(var t=0;t<this.downstreamers.length;++t)if(this.downstreamers[t]===e)return void this.downstreamers.splice(t,1);for(var a=0;a<this.upstreamers.length;++a)if(this.upstreamers[a]===e)return void this.upstreamers.splice(a,1)}}]),t}(l.default);t.default=c,e.exports=t['default']},function(t,a){'use strict';function r(){}function n(e,t){return t='['+e+'] > '+t,t}function o(e){const t=self.console[e];return t?function(...a){a[0]&&(a[0]=n(e,a[0])),t.apply(self.console,a)}:r}function i(e,...t){t.forEach(function(t){l[t]=e[t]?e[t].bind(e):o(t)})}Object.defineProperty(a,'__esModule',{value:!0});const d={trace:r,debug:r,log:r,warn:r,info:r,error:r};let l=d;var u=l;a['default']=class{constructor(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}destroy(){this.abort(),this.loader=null}abort(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}load(e,t,a){this.context=e,this.config=t,this.callbacks=a,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}loadInternal(){var t=this.context,a;a=this.loader=new XMLHttpRequest;let e=this.stats;e.tfirst=0,e.loaded=0;const r=this.xhrSetup;try{if(r)try{r(a,t.url)}catch(n){a.open('GET',t.url,!0),r(a,t.url)}a.readyState||a.open('GET',t.url,!0)}catch(r){return void this.callbacks.onError({code:a.status,text:r.message},t,a)}t.rangeEnd&&a.setRequestHeader('Range','bytes='+t.rangeStart+'-'+(t.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}readystatechange(t){var a=t.currentTarget,r=a.readyState,n=this.stats,o=this.context,i=this.config;if(!n.aborted&&2<=r)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=e(performance.now(),n.trequest)),4===r){let t=a.status;if(200<=t&&300>t){n.tload=e(n.tfirst,performance.now());let t,r;'arraybuffer'===o.responseType?(t=a.response,r=t.byteLength):(t=a.responseText,r=t.length),n.loaded=n.total=r;let i={url:a.responseURL,data:t};this.callbacks.onSuccess(i,n,o,a)}else n.retry>=i.maxRetry||400<=t&&499>t?(u.error(`${t} while loading ${o.url}`),this.callbacks.onError({code:t,text:a.statusText},o,a)):(u.warn(`${t} while loading ${o.url}, retrying in ${this.retryDelay}...`),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=s(2*this.retryDelay,i.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),i.timeout)}loadtimeout(){u.warn(`timeout while loading ${this.context.url}`),this.callbacks.onTimeout(this.stats,this.context,null)}loadprogress(e){var t=e.currentTarget,a=this.stats;a.loaded=e.loaded,e.lengthComputable&&(a.total=e.total);let r=this.callbacks.onProgress;r&&r(a,this.context,null,t)}}},function(i,l){(function(e,t){i.exports=t()})(this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='/dist/',t(t.s=8)}([function(e,t,a){'use strict';function r(){}function n(e,t){return t='['+e+'] > '+t,t}function o(e){var t=self.console[e];return t?function(){for(var a=arguments.length,r=Array(a),o=0;o<a;o++)r[o]=arguments[o];r[0]&&(r[0]=n(e,r[0])),t.apply(self.console,r)}:r}function i(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];a.forEach(function(t){l[t]=e[t]?e[t].bind(e):o(t)})}a.d(t,'a',function(){return u}),a.d(t,'b',function(){return p});var d='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},s={trace:r,debug:r,log:r,warn:r,info:r,error:r},l=s,u=function(e){if(!0===e||'object'===('undefined'==typeof e?'undefined':d(e))){i(e,'debug','log','info','warn','error');try{l.log()}catch(t){l=s}}else l=s},p=l},function(e,t){'use strict';t.a={MEDIA_ATTACHING:'hlsMediaAttaching',MEDIA_ATTACHED:'hlsMediaAttached',MEDIA_DETACHING:'hlsMediaDetaching',MEDIA_DETACHED:'hlsMediaDetached',BUFFER_RESET:'hlsBufferReset',BUFFER_CODECS:'hlsBufferCodecs',BUFFER_CREATED:'hlsBufferCreated',BUFFER_APPENDING:'hlsBufferAppending',BUFFER_APPENDED:'hlsBufferAppended',BUFFER_EOS:'hlsBufferEos',BUFFER_FLUSHING:'hlsBufferFlushing',BUFFER_FLUSHED:'hlsBufferFlushed',MANIFEST_LOADING:'hlsManifestLoading',MANIFEST_LOADED:'hlsManifestLoaded',MANIFEST_PARSED:'hlsManifestParsed',LEVEL_SWITCH:'hlsLevelSwitch',LEVEL_SWITCHING:'hlsLevelSwitching',LEVEL_SWITCHED:'hlsLevelSwitched',LEVEL_LOADING:'hlsLevelLoading',LEVEL_LOADED:'hlsLevelLoaded',LEVEL_UPDATED:'hlsLevelUpdated',LEVEL_PTS_UPDATED:'hlsLevelPtsUpdated',AUDIO_TRACKS_UPDATED:'hlsAudioTracksUpdated',AUDIO_TRACK_SWITCH:'hlsAudioTrackSwitch',AUDIO_TRACK_SWITCHING:'hlsAudioTrackSwitching',AUDIO_TRACK_SWITCHED:'hlsAudioTrackSwitched',AUDIO_TRACK_LOADING:'hlsAudioTrackLoading',AUDIO_TRACK_LOADED:'hlsAudioTrackLoaded',SUBTITLE_TRACKS_UPDATED:'hlsSubtitleTracksUpdated',SUBTITLE_TRACK_SWITCH:'hlsSubtitleTrackSwitch',SUBTITLE_TRACK_LOADING:'hlsSubtitleTrackLoading',SUBTITLE_TRACK_LOADED:'hlsSubtitleTrackLoaded',SUBTITLE_FRAG_PROCESSED:'hlsSubtitleFragProcessed',INIT_PTS_FOUND:'hlsInitPtsFound',FRAG_LOADING:'hlsFragLoading',FRAG_LOAD_PROGRESS:'hlsFragLoadProgress',FRAG_LOAD_EMERGENCY_ABORTED:'hlsFragLoadEmergencyAborted',FRAG_LOADED:'hlsFragLoaded',FRAG_DECRYPTED:'hlsFragDecrypted',FRAG_PARSING_INIT_SEGMENT:'hlsFragParsingInitSegment',FRAG_PARSING_USERDATA:'hlsFragParsingUserdata',FRAG_PARSING_METADATA:'hlsFragParsingMetadata',FRAG_PARSING_DATA:'hlsFragParsingData',FRAG_PARSED:'hlsFragParsed',FRAG_BUFFERED:'hlsFragBuffered',FRAG_CHANGED:'hlsFragChanged',FPS_DROP:'hlsFpsDrop',FPS_DROP_LEVEL_CAPPING:'hlsFpsDropLevelCapping',ERROR:'hlsError',DESTROYING:'hlsDestroying',KEY_LOADING:'hlsKeyLoading',KEY_LOADED:'hlsKeyLoaded',STREAM_STATE_TRANSITION:'hlsStreamStateTransition'}},function(e,t,a){'use strict';a.d(t,'b',function(){return r}),a.d(t,'a',function(){return n});var r={NETWORK_ERROR:'networkError',MEDIA_ERROR:'mediaError',MUX_ERROR:'muxError',OTHER_ERROR:'otherError'},n={MANIFEST_LOAD_ERROR:'manifestLoadError',MANIFEST_LOAD_TIMEOUT:'manifestLoadTimeOut',MANIFEST_PARSING_ERROR:'manifestParsingError',MANIFEST_INCOMPATIBLE_CODECS_ERROR:'manifestIncompatibleCodecsError',LEVEL_LOAD_ERROR:'levelLoadError',LEVEL_LOAD_TIMEOUT:'levelLoadTimeOut',LEVEL_SWITCH_ERROR:'levelSwitchError',AUDIO_TRACK_LOAD_ERROR:'audioTrackLoadError',AUDIO_TRACK_LOAD_TIMEOUT:'audioTrackLoadTimeOut',FRAG_LOAD_ERROR:'fragLoadError',FRAG_LOOP_LOADING_ERROR:'fragLoopLoadingError',FRAG_LOAD_TIMEOUT:'fragLoadTimeOut',FRAG_DECRYPT_ERROR:'fragDecryptError',FRAG_PARSING_ERROR:'fragParsingError',REMUX_ALLOC_ERROR:'remuxAllocError',KEY_LOAD_ERROR:'keyLoadError',KEY_LOAD_TIMEOUT:'keyLoadTimeOut',BUFFER_ADD_CODEC_ERROR:'bufferAddCodecError',BUFFER_APPEND_ERROR:'bufferAppendError',BUFFER_APPENDING_ERROR:'bufferAppendingError',BUFFER_STALLED_ERROR:'bufferStalledError',BUFFER_FULL_ERROR:'bufferFullError',BUFFER_SEEK_OVER_HOLE:'bufferSeekOverHole',BUFFER_NUDGE_ON_STALL:'bufferNudgeOnStall',INTERNAL_EXCEPTION:'internalException'}},function(e,a,r){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}r.d(a,'b',function(){return i});var o=function(){function e(){n(this,e)}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9]},e.getID3Data=function(t,a){for(var r=a,n=0;e.isHeader(t,a);){n+=10;var o=e._readSize(t,a+6);n+=o,e.isFooter(t,a+10)&&(n+=10),a+=n}return 0<n?t.subarray(r,r+n):void 0},e._readSize=function(e,t){var a=0;return a=(127&e[t])<<21,a|=(127&e[t+1])<<14,a|=(127&e[t+2])<<7,a|=127&e[t+3],a},e.getTimeStamp=function(t){for(var a=e.getID3Frames(t),r=0,n;r<a.length;r++)if(n=a[r],e.isTimeStampFrame(n))return e._readTimeStamp(n)},e.isTimeStampFrame=function(e){return e&&'PRIV'===e.key&&'com.apple.streaming.transportStreamTimestamp'===e.info},e._getFrameData=function(t){var a=d(t[0],t[1],t[2],t[3]),r=e._readSize(t,4),n=10;return{type:a,size:r,data:t.subarray(n,n+r)}},e.getID3Frames=function(t){for(var a=0,r=[],n;e.isHeader(t,a);){n=e._readSize(t,a+6),a+=10;for(var o=a+n;a+8<o;){var i=e._getFrameData(t.subarray(a)),d=e._decodeFrame(i);d&&r.push(d),a+=i.size+10}e.isFooter(t,a)&&(a+=10)}return r},e._decodeFrame=function(t){return'PRIV'===t.type?e._decodePrivFrame(t):'T'===t.type[0]?e._decodeTextFrame(t):'W'===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var a=new Uint8Array(e.data),r=1&a[3],n=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return n/=45,r&&(n+=47721858.84),t(n)}},e._decodePrivFrame=function(t){if(!(2>t.size)){var a=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(a.length+1));return{key:t.type,info:a,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(2>t.size)){if('TXXX'===t.type){var a=1,r=e._utf8ArrayToStr(t.data.subarray(a));a+=r.length+1;var n=e._utf8ArrayToStr(t.data.subarray(a));return{key:t.type,info:r,data:n}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if('WXXX'===t.type){if(2>t.size)return;var a=1,r=e._utf8ArrayToStr(t.data.subarray(a));a+=r.length+1;var n=e._utf8ArrayToStr(t.data.subarray(a));return{key:t.type,info:r,data:n}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e){for(var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=e.length,r='',n=0,o,i,s;n<a;){if(o=e[n++],0===o&&t)return r;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=d(o);break;case 12:case 13:i=e[n++],r+=d((31&o)<<6|63&i);break;case 14:i=e[n++],s=e[n++],r+=d((15&o)<<12|(63&i)<<6|(63&s)<<0);break;default:}}return r},e}(),i=o._utf8ArrayToStr;a.a=o},function(e,t,a){'use strict';function r(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function o(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var d=function(){function e(t,a){r(this,e),this.subtle=t,this.aesIV=a}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:'AES-CBC',iv:this.aesIV},t,e)},e}(),s=function(){function e(t,a){n(this,e),this.subtle=t,this.key=a}return e.prototype.expandKey=function(){return this.subtle.importKey('raw',this.key,{name:'AES-CBC'},!1,['encrypt','decrypt'])},e}(),l=function(){function e(){o(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e.prototype.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),a=new Uint32Array(4),r=0;4>r;r++)a[r]=t.getUint32(4*r);return a},e.prototype.initTable=function(){var e=this.sBox,a=this.invSBox,r=this.subMix,n=r[0],o=r[1],s=r[2],l=r[3],u=this.invSubMix,p=u[0],c=u[1],f=u[2],g=u[3],m=new Uint32Array(256),d=0,y=0,h=0;for(h=0;256>h;h++)m[h]=128>h?h<<1:283^h<<1;for(h=0;256>h;h++){var i=y^y<<1^y<<2^y<<3^y<<4;i=99^(i>>>8^255&i),e[d]=i,a[i]=d;var b=m[d],_=m[b],T=m[_],E=257*m[i]^16843008*i;n[d]=E<<24|E>>>8,o[d]=E<<16|E>>>16,s[d]=E<<8|E>>>24,l[d]=E,E=16843009*T^65537*_^257*b^16843008*d,p[i]=E<<24|E>>>8,c[i]=E<<16|E>>>16,f[i]=E<<8|E>>>24,g[i]=E,d?(d=b^m[m[m[T^b]]],y^=m[m[y]]):d=y=1}},e.prototype.expandKey=function(e){for(var a=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<a.length&&r;)r=a[n]===this.key[n],n++;if(!r){this.key=a;var o=this.keySize=a.length;if(4!==o&&6!==o&&8!==o)throw new Error('Invalid aes key size='+o);var i=this.ksRows=4*(o+6+1),d=this.keySchedule=new Uint32Array(i),s=this.invKeySchedule=new Uint32Array(i),l=this.sBox,u=this.rcon,p=this.invSubMix,c=p[0],f=p[1],g=p[2],m=p[3],y,h,b,_;for(y=0;y<i;y++){if(y<o){b=d[y]=a[y];continue}_=b,0==y%o?(_=_<<8|_>>>24,_=l[_>>>24]<<24|l[255&_>>>16]<<16|l[255&_>>>8]<<8|l[255&_],_^=u[0|y/o]<<24):6<o&&4==y%o&&(_=l[_>>>24]<<24|l[255&_>>>16]<<16|l[255&_>>>8]<<8|l[255&_]),d[y]=b=(d[y-o]^_)>>>0}for(h=0;h<i;h++)y=i-h,_=3&h?d[y]:d[y-4],s[h]=4>h||4>=y?_:c[l[_>>>24]]^f[l[255&_>>>16]]^g[l[255&_>>>8]]^m[l[255&_]],s[h]>>>=0}},e.prototype.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},e.prototype.decrypt=function(e,t,a){for(var r=this.keySize+6,n=this.invKeySchedule,o=this.invSBox,d=this.invSubMix,s=d[0],l=d[1],u=d[2],p=d[3],c=this.uint8ArrayToUint32Array_(a),f=c[0],g=c[1],m=c[2],y=c[3],h=new Int32Array(e),b=new Int32Array(h.length),_=this.networkToHostOrderSwap,T,E,R,S,v,A,L,D,C,k,I,P,w,x;t<h.length;){for(C=_(h[t]),k=_(h[t+1]),I=_(h[t+2]),P=_(h[t+3]),v=C^n[0],A=P^n[1],L=I^n[2],D=k^n[3],w=4,x=1;x<r;x++)T=s[v>>>24]^l[255&A>>16]^u[255&L>>8]^p[255&D]^n[w],E=s[A>>>24]^l[255&L>>16]^u[255&D>>8]^p[255&v]^n[w+1],R=s[L>>>24]^l[255&D>>16]^u[255&v>>8]^p[255&A]^n[w+2],S=s[D>>>24]^l[255&v>>16]^u[255&A>>8]^p[255&L]^n[w+3],v=T,A=E,L=R,D=S,w+=4;T=o[v>>>24]<<24^o[255&A>>16]<<16^o[255&L>>8]<<8^o[255&D]^n[w],E=o[A>>>24]<<24^o[255&L>>16]<<16^o[255&D>>8]<<8^o[255&v]^n[w+1],R=o[L>>>24]<<24^o[255&D>>16]<<16^o[255&v>>8]<<8^o[255&A]^n[w+2],S=o[D>>>24]<<24^o[255&v>>16]<<16^o[255&A>>8]<<8^o[255&L]^n[w+3],w+=3,b[t]=_(T^f),b[t+1]=_(S^g),b[t+2]=_(R^m),b[t+3]=_(E^y),f=C,g=k,m=I,y=P,t+=4}return b.buffer},e.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),u=a(2),p=a(0),c=function(){function e(t,a){i(this,e),this.observer=t,this.config=a,this.logEnabled=!0;try{var r=crypto?crypto:self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}return e.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.prototype.decrypt=function(e,t,a,r){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(p.b.log('JS AES decrypt'),this.logEnabled=!1);var o=this.decryptor;o||(this.decryptor=o=new l),o.expandKey(t),r(o.decrypt(e,0,a))}else{this.logEnabled&&(p.b.log('WebCrypto AES decrypt'),this.logEnabled=!1);var i=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new s(i,t)),this.fastAesKey.expandKey().then(function(o){var s=new d(i,a);s.decrypt(e,o).catch(function(o){n.onWebCryptoError(o,e,t,a,r)}).then(function(e){r(e)})}).catch(function(o){n.onWebCryptoError(o,e,t,a,r)})}},e.prototype.onWebCryptoError=function(e,t,a,r,n){this.config.enableSoftwareAES?(p.b.log('WebCrypto Error, disable WebCrypto API'),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,a,r,n)):(p.b.error('decrypting error : '+e.message),this.observer.trigger(Event.ERROR,{type:u.b.MEDIA_ERROR,details:u.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},e.prototype.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}(),f=t.a=c},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return'function'==typeof e}function r(e){return'number'==typeof e}function n(e){return'object'==typeof e&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError('n must be a positive number');return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,d,s,l,i;if(this._events||(this._events={}),'error'===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length))if(t=arguments[1],t instanceof Error)throw t;else{var u=new Error('Uncaught, unspecified "error" event. ('+t+')');throw u.context=t,u}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s);}else if(n(r))for(s=Array.prototype.slice.call(arguments,1),i=r.slice(),d=i.length,l=0;l<d;l++)i[l].apply(this,s);return!0},t.prototype.addListener=function(e,r){var i;if(!a(r))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',e,a(r.listener)?r.listener:r),this._events[e]?n(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,n(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,i&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[e].length),'function'==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!a(t))throw TypeError('listener must be a function');var n=!1;return r.listener=t,this.on(e,r),this},t.prototype.removeListener=function(e,t){var r,o,d,s;if(!a(t))throw TypeError('listener must be a function');if(!this._events||!this._events[e])return this;if(r=this._events[e],d=r.length,o=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit('removeListener',e,t);else if(n(r)){for(s=d;0<s--;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=s;break}if(0>o)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit('removeListener',e,t)}return this},t.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)'removeListener'!==t&&this.removeAllListeners(t);return this.removeAllListeners('removeListener'),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){(function(t){var a=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,r=/^([^\/;?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,i={buildAbsoluteURL:function(e,t,a){if(a=a||{},e=e.trim(),t=t.trim(),!t){if(!a.alwaysNormalize)return e;var n=this.parseURL(e);if(!d)throw new Error('Error trying to parse base URL.');return n.path=i.normalizePath(n.path),i.buildURLFromParts(n)}var o=this.parseURL(t);if(!o)throw new Error('Error trying to parse relative URL.');if(o.scheme)return a.alwaysNormalize?(o.path=i.normalizePath(o.path),i.buildURLFromParts(o)):t;var d=this.parseURL(e);if(!d)throw new Error('Error trying to parse base URL.');if(!d.netLoc&&d.path&&'/'!==d.path[0]){var s=r.exec(d.path);d.netLoc=s[1],d.path=s[2]}d.netLoc&&!d.path&&(d.path='/');var l={scheme:d.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(l.netLoc=d.netLoc,'/'!==o.path[0]))if(!o.path)l.path=d.path,o.params||(l.params=d.params,!o.query&&(l.query=d.query));else{var u=d.path,p=u.substring(0,u.lastIndexOf('/')+1)+o.path;l.path=i.normalizePath(p)}return null===l.path&&(l.path=a.alwaysNormalize?i.normalizePath(o.path):o.path),i.buildURLFromParts(l)},parseURL:function(e){var t=a.exec(e);return t?{scheme:t[1]||'',netLoc:t[2]||'',path:t[3]||'',params:t[4]||'',query:t[5]||'',fragment:t[6]||''}:null},normalizePath:function(e){for(e=e.split('').reverse().join('').replace(n,'');e.length!==(e=e.replace(o,'')).length;);return e.split('').reverse().join('')},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=i})(this)},function(n,i,l){'use strict';function u(e,t,a,r){var n=navigator.userAgent.toLowerCase(),o=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350],i,d,s,l,u;return(i=((192&t[a+2])>>>6)+1,d=(60&t[a+2])>>>2,d>o.length-1)?void e.trigger(Event.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!0,reason:'invalid ADTS sampling index:'+d}):(l=(1&t[a+2])<<2,l|=(192&t[a+3])>>>6,O.b.log('manifest codec:'+r+',ADTS data:type:'+i+',sampleingIndex:'+d+'['+o[d]+'Hz],channelConfig:'+l),/firefox/i.test(n)?6<=d?(i=5,u=[,,,,],s=d-3):(i=2,u=[,,],s=d):-1===n.indexOf('android')?(i=5,u=[,,,,],r&&(-1!==r.indexOf('mp4a.40.29')||-1!==r.indexOf('mp4a.40.5'))||!r&&6<=d?s=d-3:((r&&-1!==r.indexOf('mp4a.40.2')&&(6<=d&&1===l||/vivaldi/i.test(n))||!r&&1===l)&&(i=2,u=[,,]),s=d)):(i=2,u=[,,],s=d),u[0]=i<<3,u[0]|=(14&d)>>1,u[1]|=(1&d)<<7,u[1]|=l<<3,5===i&&(u[1]|=(14&s)>>1,u[2]=(1&s)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:o[d],channelCount:l,codec:'mp4a.40.'+i,manifestCodec:r})}function p(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return!(1&e[t+1])?9:7}function f(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function g(e,t){return t+1<e.length&&p(e,t)}function m(e,t){if(t+1<e.length&&p(e,t)){var a=c(e,t),r=a;t+5<e.length&&(r=f(e,t));var n=t+r;if(n===e.length||n+1<e.length&&p(e,n))return!0}return!1}function y(e,t,a,r,n){if(!e.samplerate){var o=u(t,a,r,n);e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,O.b.log('parsed codec:'+e.codec+',rate:'+o.samplerate+',nb channel:'+o.channelCount)}}function h(e){return 92160000/e}function b(e,t,a,r,n){var o=e.length,i,d,s;return i=c(e,t),d=f(e,t),d-=i,0<d&&t+i+d<=o?(s=a+r*n,{headerLength:i,frameLength:d,stamp:s}):void 0}function _(e,t,a,r,n){var o=h(e.samplerate),i=b(t,a,r,n,o);if(i){var d=i.stamp,s=i.headerLength,l=i.frameLength,u={unit:t.subarray(a+s,a+s+l),pts:d,dts:d};return e.samples.push(u),e.len+=l,{sample:u,length:l+s}}}function T(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function E(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function R(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function S(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function v(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function A(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function L(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function D(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function C(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function k(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function I(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var P=l(1),w=l(2),x=l(4),O=l(0),F=l(3),N=function(){function e(t,a,r){T(this,e),this.observer=t,this.config=r,this.remuxer=a}return e.prototype.resetInitSegment=function(e,t,a,r){this._audioTrack={container:'audio/adts',type:'audio',id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=F.a.getID3Data(e,0)||[],a=t.length,r=e.length;a<r;a++)if(m(e,a))return O.b.log('ADTS sync word found !'),!0;return!1},e.prototype.append=function(e,t,a,r){for(var n=this._audioTrack,o=F.a.getID3Data(e,0)||[],i=F.a.getTimeStamp(o),d=i?90*i:9e4*t,s=0,l=d,u=e.length,p=o.length,c=[{pts:l,dts:l,data:o}];p<u-1;)if(g(e,p)&&p+5<u){y(n,this.observer,e,p,n.manifestCodec);var f=_(n,e,p,d,s);if(f)p+=f.length,l=f.sample.pts,s++;else{O.b.log('Unable to parse AAC frame');break}}else F.a.isHeader(e,p)?(o=F.a.getID3Data(e,p),c.push({pts:l,dts:l,data:o}),p+=o.length):p++;this.remuxer.remux(n,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,a,r)},e.prototype.destroy=function(){},e}(),B=4294967295,M=function(){function t(e,a){E(this,t),this.observer=e,this.remuxer=a}return t.prototype.resetTimeStamp=function(e){this.initPTS=e},t.prototype.resetInitSegment=function(e,a,r,n){if(e&&e.byteLength){var o=this.initData=t.parseInitSegment(e);null==a&&(a='mp4a.40.5'),null==r&&(r='avc1.42e01e');var i={};o.audio&&o.video?i.audiovideo={container:'video/mp4',codec:a+','+r,initSegment:n?e:null}:(o.audio&&(i.audio={container:'audio/mp4',codec:a,initSegment:n?e:null}),o.video&&(i.video={container:'video/mp4',codec:r,initSegment:n?e:null})),this.observer.trigger(P.a.FRAG_PARSING_INIT_SEGMENT,{tracks:i})}else a&&(this.audioCodec=a),r&&(this.videoCodec=r)},t.probe=function(e){return 0<t.findBox({data:e,start:0,end:s(e.length,16384)},['moof']).length},t.bin2str=function(e){return d.apply(null,e)},t.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var a=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return 0>a?4294967296+a:a},t.writeUint32=function(e,t,a){e.data&&(t+=e.start,e=e.data),e[t]=a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a},t.findBox=function(e,a){var r=[],n,o,i,d,s,l,u;if(e.data?(l=e.start,d=e.end,e=e.data):(l=0,d=e.byteLength),!a.length)return null;for(n=l;n<d;)o=t.readUint32(e,n),i=t.bin2str(e.subarray(n+4,n+8)),u=1<o?n+o:d,i===a[0]&&(1===a.length?r.push({data:e,start:n+8,end:u}):(s=t.findBox({data:e,start:n+8,end:u},a.slice(1)),s.length&&(r=r.concat(s)))),n=u;return r},t.parseInitSegment=function(e){var a=[],r=t.findBox(e,['moov','trak']);return r.forEach(function(e){var r=t.findBox(e,['tkhd'])[0];if(r){var n=r.data[r.start],o=0===n?12:20,i=t.readUint32(r,o),d=t.findBox(e,['mdia','mdhd'])[0];if(d){n=d.data[d.start],o=0===n?12:20;var s=t.readUint32(d,o),l=t.findBox(e,['mdia','hdlr'])[0];if(l){var u=t.bin2str(l.data.subarray(l.start+8,l.start+12)),p={soun:'audio',vide:'video'}[u];if(p){var c=t.findBox(e,['mdia','minf','stbl','stsd']);if(c.length){c=c[0];var f=t.bin2str(c.data.subarray(c.start+12,c.start+16));O.b.log('MP4Demuxer:'+p+':'+f+' found')}a[i]={timescale:s,type:p},a[p]={timescale:s,id:i}}}}}}),a},t.getStartDTS=function(e,a){var r,n,o;return r=t.findBox(a,['moof','traf']),n=[].concat.apply([],r.map(function(a){return t.findBox(a,['tfhd']).map(function(r){var n,o,i;return n=t.readUint32(r,4),o=e[n].timescale||9e4,i=t.findBox(a,['tfdt']).map(function(e){var a,r;return a=e.data[e.start],r=t.readUint32(e,4),1===a&&(r*=4294967296,r+=t.readUint32(e,8)),r})[0],i/o})})),o=s.apply(null,n),isFinite(o)?o:0},t.offsetStartDTS=function(a,r,n){t.findBox(r,['moof','traf']).map(function(r){return t.findBox(r,['tfhd']).map(function(i){var d=t.readUint32(i,4),s=a[d].timescale||9e4;t.findBox(r,['tfdt']).map(function(a){var r=a.data[a.start],i=t.readUint32(a,4);if(0===r)t.writeUint32(a,4,i-n*s);else{i*=4294967296,i+=t.readUint32(a,8),i-=n*s,i=e(i,0);var d=o(i/(B+1)),l=o(i%(B+1));t.writeUint32(a,4,d),t.writeUint32(a,8,l)}})})})},t.prototype.append=function(e,a,r,n){var o=this.initData;o||(this.resetInitSegment(e,this.audioCodec,this.videoCodec),o=this.initData);var i=this.initPTS,d;if(void 0===i){var s=t.getStartDTS(o,e);this.initPTS=i=s-a,this.observer.trigger(P.a.INIT_PTS_FOUND,{initPTS:i})}t.offsetStartDTS(o,e,i),d=t.getStartDTS(o,e),this.remuxer.remux(o.audio,o.video,null,null,d,r,n,e)},t.prototype.destroy=function(){},t}(),U={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48000,32000,22050,24000,16000,11025,12000,8000],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,a,r,n){if(!(a+24>t.length)){var o=this.parseHeader(t,a);if(o&&a+o.frameLength<=t.length){var i=9e4*o.samplesPerFrame/o.sampleRate,d=r+n*i,s={unit:t.subarray(a,a+o.frameLength),pts:d,dts:d};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(s),e.len+=o.frameLength,{sample:s,length:o.frameLength}}}},parseHeader:function(e,t){var a=3&e[t+1]>>3,r=3&e[t+1]>>1,n=15&e[t+2]>>4,o=3&e[t+2]>>2,i=1&e[t+2]>>1;if(1!=a&&0!=n&&15!=n&&3!=o){var d=3==a?3-r:3==r?3:4,s=1e3*U.BitratesMap[14*d+n-1],l=3==a?0:2==a?1:2,u=U.SamplingRateMap[3*l+o],p=3==e[t+3]>>6?1:2,c=U.SamplesCoefficients[a][r],f=U.BytesInSlot[r],g=parseInt(c*s/u+i,10)*f;return{sampleRate:u,channelCount:p,frameLength:g,samplesPerFrame:8*c*f}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return t+1<e.length&&this.isHeaderPattern(e,t)},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var a=this.parseHeader(e,t),r=4;a&&a.frameLength&&(r=a.frameLength);var n=t+r;if(n===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},G=U,W=function(){function e(t){R(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return e.prototype.loadWord=function(){var e=this.data,t=this.bytesAvailable,a=e.byteLength-t,r=new Uint8Array(4),n=s(4,t);if(0===n)throw new Error('no bytes available');r.set(e.subarray(a,a+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.prototype.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},e.prototype.readBits=function(e){var t=s(this.bitsAvailable,e),a=this.word>>>32-t;return 32<e&&O.b.error('Cannot read more than 32 bits at a time'),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),t=e-t,0<t&&this.bitsAvailable?a<<t|this.readBits(t):a},e.prototype.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},e.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},e.prototype.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},e.prototype.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},e.prototype.readBoolean=function(){return 1===this.readBits(1)},e.prototype.readUByte=function(){return this.readBits(8)},e.prototype.readUShort=function(){return this.readBits(16)},e.prototype.readUInt=function(){return this.readBits(32)},e.prototype.skipScalingList=function(e){var t=8,a=8,r,n;for(r=0;r<e;r++)0!=a&&(n=this.readEG(),a=(t+n+256)%256),t=0==a?t:a},e.prototype.readSPS=function(){var e=0,t=0,a=0,n=0,o=this.readUByte.bind(this),d=this.readBits.bind(this),s=this.readUEG.bind(this),l=this.readBoolean.bind(this),u=this.skipBits.bind(this),p=this.skipEG.bind(this),c=this.skipUEG.bind(this),f=this.skipScalingList.bind(this),g,m,y,h,b,_,T,E,R;if(o(),g=o(),m=d(5),u(3),y=o(),c(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){var i=s();if(3===i&&u(1),c(),c(),u(1),l())for(E=3===i?12:8,R=0;R<E;R++)l()&&(6>R?f(16):f(64))}c();var S=s();if(0===S)s();else if(1===S)for(u(1),p(),p(),h=s(),R=0;R<h;R++)p();c(),u(1),b=s(),_=s(),T=d(1),0===T&&u(1),u(1),l()&&(e=s(),t=s(),a=s(),n=s());var v=[1,1];if(l()&&l()){var A=o();switch(A){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[o()<<8|o(),o()<<8|o()];break}}}return{width:r(16*(b+1)-2*e-2*t),height:16*((2-T)*(_+1))-(T?2:4)*(a+n),pixelRatio:v}},e.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),K=W,H=function(){function e(t,a,r,n){S(this,e),this.decryptdata=r,this.discardEPB=n,this.decrypter=new x.a(t,a)}return e.prototype.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},e.prototype.decryptAacSample=function(e,t,a,r){var n=e[t].unit,o=n.subarray(16,n.length-n.length%16),i=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),d=this;this.decryptBuffer(i,function(o){o=new Uint8Array(o),n.set(o,16),r||d.decryptAacSamples(e,t+1,a)})},e.prototype.decryptAacSamples=function(e,t,a){for(;;t++){if(t>=e.length)return void a();if(!(32>e[t].unit.length)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,a,r),!r)return}}},e.prototype.getAvcEncryptedData=function(e){for(var t=16*o((e.length-48)/160)+16,a=new Int8Array(t),r=0,n=32;n<=e.length-16;n+=160,r+=16)a.set(e.subarray(n,n+16),r);return a},e.prototype.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var a=0,r=32;r<=e.length-16;r+=160,a+=16)e.set(t.subarray(a,a+16),r);return e},e.prototype.decryptAvcSample=function(e,t,a,r,n,o){var i=this.discardEPB(n.data),d=this.getAvcEncryptedData(i),s=this;this.decryptBuffer(d.buffer,function(d){n.data=s.getAvcDecryptedUnit(i,d),o||s.decryptAvcSamples(e,t,a+1,r)})},e.prototype.decryptAvcSamples=function(e,t,a,r){for(;;t++,a=0){if(t>=e.length)return void r();for(var n=e[t].units;;a++){if(a>=n.length)break;var o=n[a];if(!(48>=o.length||1!==o.type&&5!==o.type)){var i=this.decrypter.isSync();if(this.decryptAvcSample(e,t,a,r,o,i),!i)return}}}},e}(),V={video:0,audio:1,id3:2,text:3},j=function(){function e(t,a,r,n){v(this,e),this.observer=t,this.config=r,this.typeSupported=n,this.remuxer=a,this.sampleAes=null}return e.prototype.setDecryptData=function(e){this.sampleAes=null!=e&&null!=e.key&&'SAMPLE-AES'===e.method?new H(this.observer,this.config,e,this.discardEPB):null},e.probe=function(t){var a=e._syncOffset(t);return!(0>a)&&(a&&O.b.warn('MPEG2-TS detected but first sync word found @ offset '+a+', junk ahead ?'),!0)},e._syncOffset=function(e){for(var t=s(1e3,e.length-564),a=0;a<t;){if(71===e[a]&&71===e[a+188]&&71===e[a+376])return a;a++}return-1},e.createTrack=function(e,t){return{container:'video'===e||'audio'===e?'video/mp2t':void 0,type:e,id:V[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:'video'===e?0:void 0,isAAC:'audio'===e||void 0,duration:'audio'===e?t:void 0}},e.prototype.resetInitSegment=function(t,a,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack('video',n),this._audioTrack=e.createTrack('audio',n),this._id3Track=e.createTrack('id3',n),this._txtTrack=e.createTrack('text',n),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=a,this.videoCodec=r,this._duration=n},e.prototype.resetTimeStamp=function(){},e.prototype.append=function(t,a,r,n){var o=t.length,i=!1,d,s,l,u,p,c;this.contiguous=r;var f=this.pmtParsed,g=this._avcTrack,m=this._audioTrack,y=this._id3Track,h=g.pid,b=m.pid,_=y.pid,T=this._pmtId,E=g.pesData,R=m.pesData,S=y.pesData,v=this._parsePAT,A=this._parsePMT,L=this._parsePES,D=this._parseAVCPES.bind(this),C=this._parseAACPES.bind(this),k=this._parseMPEGPES.bind(this),I=this._parseID3PES.bind(this),x=e._syncOffset(t);for(o-=(o+x)%188,d=x;d<o;d+=188)if(71===t[d]){if(s=!!(64&t[d+1]),l=((31&t[d+1])<<8)+t[d+2],u=(48&t[d+3])>>4,!(1<u))p=d+4;else if(p=d+5+t[d+4],p===d+188)continue;switch(l){case h:s&&(E&&(c=L(E))&&D(c,!1),E={data:[],size:0}),E&&(E.data.push(t.subarray(p,d+188)),E.size+=d+188-p);break;case b:s&&(R&&(c=L(R))&&(m.isAAC?C(c):k(c)),R={data:[],size:0}),R&&(R.data.push(t.subarray(p,d+188)),R.size+=d+188-p);break;case _:s&&(S&&(c=L(S))&&I(c),S={data:[],size:0}),S&&(S.data.push(t.subarray(p,d+188)),S.size+=d+188-p);break;case 0:s&&(p+=t[p]+1),T=this._pmtId=v(t,p);break;case T:s&&(p+=t[p]+1);var F=A(t,p,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);h=F.avc,0<h&&(g.pid=h),b=F.audio,0<b&&(m.pid=b,m.isAAC=F.isAAC),_=F.id3,0<_&&(y.pid=_),i&&!f&&(O.b.log('reparse from beginning'),i=!1,d=x-188),f=this.pmtParsed=!0;break;case 17:case 8191:break;default:i=!0;}}else this.observer.trigger(P.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!1,reason:'TS packet did not start with 0x47'});E&&(c=L(E))?(D(c,!0),g.pesData=null):g.pesData=E,R&&(c=L(R))?(m.isAAC?C(c):k(c),m.pesData=null):(R&&R.size&&O.b.log('last AAC PES packet truncated,might overlap between fragments'),m.pesData=R),S&&(c=L(S))?(I(c),y.pesData=null):y.pesData=S,null==this.sampleAes?this.remuxer.remux(m,g,y,this._txtTrack,a,r,n):this.decryptAndRemux(m,g,y,this._txtTrack,a,r,n)},e.prototype.decryptAndRemux=function(e,t,a,r,n,o,i){if(e.samples&&e.isAAC){var d=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){d.decryptAndRemuxAvc(e,t,a,r,n,o,i)})}else this.decryptAndRemuxAvc(e,t,a,r,n,o,i)},e.prototype.decryptAndRemuxAvc=function(e,t,a,r,n,o,i){if(t.samples){var d=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){d.remuxer.remux(e,t,a,r,n,o,i)})}else this.remuxer.remux(e,t,a,r,n,o,i)},e.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e.prototype._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},e.prototype._parsePMT=function(e,t,a,r){var n={audio:-1,avc:-1,id3:-1,isAAC:!0},o,i,d,s;for(o=(15&e[t+1])<<8|e[t+2],i=t+3+o-4,d=(15&e[t+10])<<8|e[t+11],t+=12+d;t<i;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){O.b.log('unkown stream type:'+e[t]);break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!r){O.b.log('unkown stream type:'+e[t]);break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:a?-1===n.audio&&(n.audio=s,n.isAAC=!1):O.b.log('MPEG audio found, not supported in this browser for now');break;case 36:O.b.warn('HEVC stream type found, not supported for now');break;default:O.b.log('unkown stream type:'+e[t]);}t+=((15&e[t+3])<<8|e[t+4])+5}return n},e.prototype._parsePES=function(e){var a=0,r=e.data,n,o,i,d,s,l,u,p,c;if(!e||0===e.size)return null;for(;19>r[0].length&&1<r.length;){var f=new Uint8Array(r[0].length+r[1].length);f.set(r[0]),f.set(r[1],r[0].length),r[0]=f,r.splice(1,1)}if(n=r[0],i=(n[0]<<16)+(n[1]<<8)+n[2],1===i){if(d=(n[4]<<8)+n[5],d&&d>e.size-6)return null;o=n[7],192&o&&(u=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,4294967295<u&&(u-=8589934592),64&o?(p=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2,4294967295<p&&(p-=8589934592),5400000<u-p&&(O.b.warn(t((u-p)/9e4)+'s delta between PTS and DTS, align them'),u=p)):p=u),s=n[8],c=s+9,e.size-=c,l=new Uint8Array(e.size);for(var g=0,m=r.length;g<m;g++){n=r[g];var y=n.byteLength;if(c)if(c>y){c-=y;continue}else n=n.subarray(c),y-=c,c=0;l.set(n,a),a+=y}return d&&(d-=s+3),{data:l,pts:u,dts:p,len:d}}return null},e.prototype.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var a=t.samples,r=a.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,a.push(e)):t.dropped++}e.debug.length&&O.b.log(e.pts+'/'+e.dts+':'+e.debug)},e.prototype._parseAVCPES=function(e,t){var a=this,r=this._avcTrack,n=this._parseAVCNALu(e.data),o=!1,d=this.avcSample,s=!1,l=this.pushAccesUnit.bind(this),u=function(e,t,a,r){return{key:e,pts:t,dts:a,units:[],debug:r}},p,c,f;e.data=null,d&&n.length&&!r.audFound&&(l(d,r),d=this.avcSample=u(!1,e.pts,e.dts,'')),n.forEach(function(t){switch(t.type){case 1:c=!0,d||(d=a.avcSample=u(!0,e.pts,e.dts,'')),o,d.frame=!0;var n=t.data;if(s&&4<n.length){var i=new K(n).readSliceType();(2===i||4===i||7===i||9===i)&&(d.key=!0)}break;case 5:c=!0,d||(d=a.avcSample=u(!0,e.pts,e.dts,'')),o,d.key=!0,d.frame=!0;break;case 6:c=!0,o,p=new K(a.discardEPB(t.data)),p.readUByte();for(var g=0,m=0,y=!1,_=0;!y&&1<p.bytesAvailable;){g=0;do _=p.readUByte(),g+=_;while(255==_);m=0;do _=p.readUByte(),m+=_;while(255===_);if(4===g&&0!==p.bytesAvailable){y=!0;var b=p.readUByte();if(181===b){var T=p.readUShort();if(49===T){var E=p.readUInt();if(1195456820===E){var R=p.readUByte();if(3===R){var S=p.readUByte(),v=p.readUByte(),A=[S,v];for(f=0;f<(31&S);f++)A.push(p.readUByte()),A.push(p.readUByte()),A.push(p.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:A})}}}}}else if(m<p.bytesAvailable)for(f=0;f<m;f++)p.readUByte()}break;case 7:if(c=!0,s=!0,o,!r.sps){p=new K(t.data);var L=p.readSPS();r.width=L.width,r.height=L.height,r.pixelRatio=L.pixelRatio,r.sps=[t.data],r.duration=a._duration;var D=t.data.subarray(1,4),C='avc1.';for(f=0;3>f;f++){var k=D[f].toString(16);2>k.length&&(k='0'+k),C+=k}r.codec=C}break;case 8:c=!0,o,r.pps||(r.pps=[t.data]);break;case 9:c=!1,r.audFound=!0,d&&l(d,r),d=a.avcSample=u(!1,e.pts,e.dts,'');break;case 12:c=!1;break;default:c=!1,d&&(d.debug+='unknown NAL '+t.type+' ');}if(d&&c){var h=d.units;h.push(t)}}),t&&d&&(l(d,r),this.avcSample=null)},e.prototype._insertSampleInOrder=function(e,t){var a=e.length;if(!(0<a))e.push(t);else if(t.pts>=e[a-1].pts)e.push(t);else for(var r=a-1;0<=r;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}},e.prototype._getLastNalUnit=function(){var e=this.avcSample,t;if(!e||0===e.units.length){var a=this._avcTrack,r=a.samples;e=r[r.length-1]}if(e){var n=e.units;t=n[n.length-1]}return t},e.prototype._parseAVCNALu=function(e){var t=0,a=e.byteLength,r=this._avcTrack,n=r.naluState||0,o=n,i=[],d=-1,s,l,u,p,c;for(-1===n&&(d=0,c=31&e[0],n=0,t=1);t<a;){if(s=e[t++],!n){n=s?0:1;continue}if(1===n){n=s?0:2;continue}if(!s)n=3;else if(1===s){if(0<=d)u={data:e.subarray(d,t-n-1),type:c},i.push(u);else{var f=this._getLastNalUnit();if(f&&(o&&t<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),l=t-n-1,0<l)){var g=new Uint8Array(f.data.byteLength+l);g.set(f.data,0),g.set(e.subarray(0,l),f.data.byteLength),f.data=g}}t<a?(p=31&e[t],d=t,c=p,n=0):n=-1}else n=0}if(0<=d&&0<=n&&(u={data:e.subarray(d,a),type:c,state:n},i.push(u)),0===i.length){var m=this._getLastNalUnit();if(m){var y=new Uint8Array(m.data.byteLength+e.byteLength);y.set(m.data,0),y.set(e,m.data.byteLength),m.data=y}}return r.naluState=n,i},e.prototype.discardEPB=function(e){for(var t=e.byteLength,a=[],r=1,n,o;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return e;n=t-a.length,o=new Uint8Array(n);var i=0;for(r=0;r<n;i++,r++)i===a[0]&&(i++,a.shift()),o[r]=e[i];return o},e.prototype._parseAACPES=function(e){var r=this._audioTrack,n=e.data,o=e.pts,i=this.aacOverFlow,d=this.aacLastPTS,s,l,u,p,c;if(i){var f=new Uint8Array(i.byteLength+n.byteLength);f.set(i,0),f.set(n,i.byteLength),n=f}for(u=0,c=n.length;u<c-1&&!g(n,u);u++);if(u){var m,b;if(u<c-1?(m='AAC PES did not start with ADTS header,offset:'+u,b=!1):(m='no ADTS header found in AAC PES',b=!0),O.b.warn('parsing error:'+m),this.observer.trigger(P.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:b,reason:m}),b)return}if(y(r,this.observer,n,u,this.audioCodec),l=0,s=h(r.samplerate),i&&d){var T=d+s;1<a(T-o)&&(O.b.log('AAC: align PTS for overlapping frames by '+t((T-o)/90)),o=T)}for(;u<c;)if(g(n,u)&&u+5<c){var E=_(r,n,u,o,l);if(E)u+=E.length,p=E.sample.pts,l++;else break}else u++;i=u<c?n.subarray(u,c):null,this.aacOverFlow=i,this.aacLastPTS=p},e.prototype._parseMPEGPES=function(e){for(var t=e.data,a=t.length,r=0,n=0,o=e.pts;n<a;)if(G.isHeader(t,n)){var i=G.appendFrame(this._audioTrack,t,n,o,r);if(i)n+=i.length,r++;else break}else n++},e.prototype._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),Y=function(){function e(t,a,r){A(this,e),this.observer=t,this.config=r,this.remuxer=a}return e.prototype.resetInitSegment=function(e,t,a,r){this._audioTrack={container:'audio/mpeg',type:'audio',id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},e.prototype.resetTimeStamp=function(){},e.probe=function(e){var t=F.a.getID3Data(e,0),a,r;if(t&&void 0!==F.a.getTimeStamp(t))for(a=t.length,r=s(e.length-1,a+100);a<r;a++)if(G.probe(e,a))return O.b.log('MPEG Audio sync word found !'),!0;return!1},e.prototype.append=function(e,t,a,r){for(var n=F.a.getID3Data(e,0),o=F.a.getTimeStamp(n),i=o?90*o:9e4*t,d=n.length,s=e.length,l=0,u=0,p=this._audioTrack,c=[{pts:i,dts:i,data:n}];d<s;)if(G.isHeader(e,d)){var f=G.appendFrame(p,e,d,i,l);if(f)d+=f.length,u=f.sample.pts,l++;else break}else F.a.isHeader(e,d)?(n=F.a.getID3Data(e,d),c.push({pts:u,dts:u,data:n}),d+=n.length):d++;this.remuxer.remux(p,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},t,a,r)},e.prototype.destroy=function(){},e}(),z=function(){function e(){L(this,e)}return e.getSilentFrame=function(e,t){switch(e){case'mp4a.40.2':if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);}return null},e}(),q=z,X=4294967295,Q=function(){function e(){D(this,e)}return e.init=function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var a=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:a,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var i=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,i,s,i,d),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=Array.prototype.slice.call(arguments,1),a=8,r=t.length,n=r,o;r--;)a+=t[r].byteLength;for(o=new Uint8Array(a),o[0]=255&a>>24,o[1]=255&a>>16,o[2]=255&a>>8,o[3]=255&a,o.set(e,4),(r=0,a=8);r<n;r++)o.set(t[r],a),a+=t[r].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,a){a*=t;var r=o(a/(X+1)),n=o(a%(X+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,n>>24,255&n>>16,255&n>>8,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,255&t>>16,255&t>>8,255&t]))},e.minf=function(t){return'audio'===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,a,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,a))},e.moov=function(t){for(var a=t.length,r=[];a--;)r[a]=e.trak(t[a]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var a=t.length,r=[];a--;)r[a]=e.trex(t[a]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,a){a*=t;var r=o(a/(X+1)),n=o(a%(X+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,r>>24,255&r>>16,255&r>>8,255&r,n>>24,255&n>>16,255&n>>8,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)},e.sdtp=function(t){var a=t.samples||[],r=new Uint8Array(4+a.length),n,o;for(o=0;o<a.length;o++)n=a[o].flags,r[o+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,r)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var a=[],r=[],n,o,i;for(n=0;n<t.sps.length;n++)o=t.sps[n],i=o.byteLength,a.push(255&i>>>8),a.push(255&i),a=a.concat(Array.prototype.slice.call(o));for(n=0;n<t.pps.length;n++)o=t.pps[n],i=o.byteLength,r.push(255&i>>>8),r.push(255&i),r=r.concat(Array.prototype.slice.call(o));var d=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(r))),s=t.width,l=t.height,u=t.pixelRatio[0],p=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&s>>8,255&s,255&l>>8,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([u>>24,255&u>>16,255&u>>8,255&u,p>>24,255&p>>16,255&p>>8,255&p])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var a=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&a>>8,255&a,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var a=t.samplerate;return e.box(e.types['.mp3'],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&a>>8,255&a,0,0]))},e.stsd=function(t){return'audio'===t.type?t.isAAC||'mp3'!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var a=t.id,r=t.duration*t.timescale,n=t.width,i=t.height,d=o(r/(X+1)),s=o(r%(X+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&a>>24,255&a>>16,255&a>>8,255&a,0,0,0,0,d>>24,255&d>>16,255&d>>8,255&d,s>>24,255&s>>16,255&s>>8,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&n>>8,255&n,0,0,255&i>>8,255&i,0,0]))},e.traf=function(t,a){var r=e.sdtp(t),n=t.id,i=o(a/(X+1)),d=o(a%(X+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,255&n>>16,255&n>>8,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,i>>24,255&i>>16,255&i>>8,255&i,d>>24,255&d>>16,255&d>>8,255&d])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var a=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,a>>24,255&a>>16,255&a>>8,255&a,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,a){var r=t.samples||[],n=r.length,o=12+16*n,d=new Uint8Array(o),s,i,l,u,p,c;for(a+=8+o,d.set([0,0,15,1,255&n>>>24,255&n>>>16,255&n>>>8,255&n,255&a>>>24,255&a>>>16,255&a>>>8,255&a],0),s=0;s<n;s++)i=r[s],l=i.duration,u=i.size,p=i.flags,c=i.cts,d.set([255&l>>>24,255&l>>>16,255&l>>>8,255&l,255&u>>>24,255&u>>>16,255&u>>>8,255&u,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,61440&p.degradPrio,15&p.degradPrio,255&c>>>24,255&c>>>16,255&c>>>8,255&c],12+16*s);return e.box(e.types.trun,d)},e.initSegment=function(t){e.types||e.init();var a=e.moov(t),r;return r=new Uint8Array(e.FTYP.byteLength+a.byteLength),r.set(e.FTYP),r.set(a,e.FTYP.byteLength),r},e}(),Z=Q,$=10000,J=function(){function n(e,t,a,r){C(this,n),this.observer=e,this.config=t,this.typeSupported=a;var o=navigator.userAgent;this.isSafari=r&&-1<r.indexOf('Apple')&&o&&!o.match('CriOS'),this.ISGenerated=!1}return n.prototype.destroy=function(){},n.prototype.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},n.prototype.resetInitSegment=function(){this.ISGenerated=!1},n.prototype.remux=function(t,a,r,n,o,i,d){if(this.ISGenerated||this.generateIS(t,a,o),this.ISGenerated){var s=t.samples.length,l=a.samples.length,u=o,p=o;if(s&&l){var c=(t.samples[0].dts-a.samples[0].dts)/a.inputTimeScale;u+=e(0,c),p+=e(0,-c)}if(s){t.timescale||(O.b.warn('regenerate InitSegment as audio detected'),this.generateIS(t,a,o));var f=this.remuxAudio(t,u,i,d);if(l){var g;f&&(g=f.endPTS-f.startPTS),a.timescale||(O.b.warn('regenerate InitSegment as video detected'),this.generateIS(t,a,o)),this.remuxVideo(a,p,i,g,d)}}else{var m;l&&(m=this.remuxVideo(a,p,i,d)),m&&t.codec&&this.remuxEmptyAudio(t,u,i,m)}}r.samples.length&&this.remuxID3(r,o),n.samples.length&&this.remuxText(n,o),this.observer.trigger(P.a.FRAG_PARSED)},n.prototype.generateIS=function(e,t,a){var r=this.observer,n=e.samples,o=t.samples,i=this.typeSupported,d='audio/mp4',l={},u=void 0===this._initPTS,p,c;if(u&&(p=c=Infinity),e.config&&n.length&&(e.timescale=e.samplerate,O.b.log('audio sampling rate : '+e.samplerate),!e.isAAC&&(i.mpeg?(d='audio/mpeg',e.codec=''):i.mp3&&(e.codec='mp3')),l.audio={container:d,codec:e.codec,initSegment:!e.isAAC&&i.mpeg?new Uint8Array:Z.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=c=n[0].pts-e.inputTimeScale*a)),t.sps&&t.pps&&o.length){var f=t.inputTimeScale;t.timescale=f,l.video={container:'video/mp4',codec:t.codec,initSegment:Z.initSegment([t]),metadata:{width:t.width,height:t.height}},u&&(p=s(p,o[0].pts-f*a),c=s(c,o[0].dts-f*a),this.observer.trigger(P.a.INIT_PTS_FOUND,{initPTS:p}))}Object.keys(l).length?(r.trigger(P.a.FRAG_PARSING_INIT_SEGMENT,{tracks:l}),this.ISGenerated=!0,u&&(this._initPTS=p,this._initDTS=c)):r.trigger(P.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!1,reason:'no audio/video samples found'})},n.prototype.remuxVideo=function(r,n,d,l,u){var p=8,c=r.timescale,f=r.samples,g=[],m=f.length,y=this._PTSNormalize,h=this._initDTS,b=this.nextAvcDts,_=this.isSafari,T,E,R,S,v,A,L,D;_&&(d|=f.length&&b&&(u&&0.1>a(n-b/c)||a(f[0].pts-b-h)<c/5)),d||(b=n*c),f.forEach(function(e){e.pts=y(e.pts-h,b),e.dts=y(e.dts-h,b)}),f.sort(function(e,t){var a=e.dts-t.dts,r=e.pts-t.pts;return a?a:r?r:e.id-t.id});var C=f.reduce(function(t,a){return e(s(t,a.pts-a.dts),-18000)},0);if(0>C){O.b.warn('PTS < DTS detected in video samples, shifting DTS by '+t(C/90)+' ms to overcome this issue');for(var k=0;k<f.length;k++)f[k].dts+=C}var i=f[0];v=e(i.dts,0),S=e(i.pts,0);var I=t((v-b)/90);d&&I&&(1<I?O.b.log('AVC:'+I+' ms hole between fragments detected,filling it'):-1>I&&O.b.log('AVC:'+-I+' ms overlapping between fragments detected'),v=b,f[0].dts=v,S=e(S-I,b),f[0].pts=S,O.b.log('Video/PTS/DTS adjusted: '+t(S/90)+'/'+t(v/90)+',delta:'+I+' ms')),A=v,i=f[f.length-1],D=e(i.dts,0),L=e(i.pts,0,D),_&&(T=t((D-v)/(f.length-1)));for(var x=0,F=0,N=0;N<m;N++){for(var B=f[N],M=B.units,U=M.length,G=0,W=0;W<U;W++)G+=M[W].data.length;F+=G,x+=U,B.length=G,B.dts=_?v+N*T:e(B.dts,v),B.pts=e(B.pts,B.dts)}var K=F+4*x+8;try{E=new Uint8Array(K)}catch(e){return void this.observer.trigger(P.a.ERROR,{type:w.b.MUX_ERROR,details:w.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:K,reason:'fail allocating video mdat '+K})}var H=new DataView(E.buffer);H.setUint32(0,K),E.set(Z.types.mdat,4);for(var V=0;V<m;V++){for(var j=f[V],Y=j.units,z=0,q=void 0,X=0,Q=Y.length;X<Q;X++){var $=Y[X],J=$.data,ee=$.data.byteLength;H.setUint32(p,ee),p+=4,E.set(J,p),p+=ee,z+=4+ee}if(!_){if(V<m-1)T=f[V+1].dts-j.dts;else{var te=this.config,ae=j.dts-f[0<V?V-1:V].dts;if(te.stretchShortVideoTrack){var re=te.maxBufferHole,ne=te.maxSeekHole,oe=o(s(re,ne)*c),ie=(l?S+l*c:this.nextAudioPts)-j.pts;ie>oe?(T=ie-ae,0>T&&(T=ae),O.b.log('It is approximately '+ie/90+' ms to the next segment; using duration '+T/90+' ms for the last video frame.')):T=ae}else T=ae}q=t(j.pts-j.dts)}else q=e(0,T*t((j.pts-j.dts)/T));g.push({size:z,duration:T,cts:q,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:j.key?2:1,isNonSync:j.key?0:1}})}this.nextAvcDts=D+T;var de=r.dropped;if(r.len=0,r.nbNalu=0,r.dropped=0,g.length&&-1<navigator.userAgent.toLowerCase().indexOf('chrome')){var se=g[0].flags;se.dependsOn=2,se.isNonSync=0}r.samples=g,R=Z.moof(r.sequenceNumber++,v,r),r.samples=[];var le={data1:R,data2:E,startPTS:S/c,endPTS:(L+T)/c,startDTS:v/c,endDTS:this.nextAvcDts/c,type:'video',nb:g.length,dropped:de};return this.observer.trigger(P.a.FRAG_PARSING_DATA,le),le},n.prototype.remuxAudio=function(r,n,o,d){var s=r.inputTimeScale,l=r.timescale,u=s/l,p=r.isAAC?1024:1152,c=p*u,f=this._PTSNormalize,g=this._initDTS,m=!r.isAAC&&this.typeSupported.mpeg,y=r.samples,h=[],b=this.nextAudioPts,_,T,E,R,S,v,A;if(o|=y.length&&b&&(d&&0.1>a(n-b/s)||a(y[0].pts-b-g)<20*c),y.forEach(function(e){e.pts=e.dts=f(e.pts-g,n*s)}),y=y.filter(function(e){return 0<=e.pts}),0!==y.length){if(o||(d?b=n*s:b=y[0].pts),r.isAAC)for(var L=this.config.maxAudioFramesDrift,D=0,i=b;D<y.length;){var C=y[D],k=C.pts,I;I=k-i;var x=a(1e3*I/s);if(I<=-L*c)O.b.warn('Dropping 1 audio frame @ '+(i/s).toFixed(3)+'s due to '+t(x)+' ms overlap.'),y.splice(D,1),r.len-=C.unit.length;else if(I>=L*c&&x<$&&i){var F=t(I/c);O.b.warn('Injecting '+F+' audio frame @ '+(i/s).toFixed(3)+'s due to '+t(1e3*I/s)+' ms gap.');for(var N=0,B;N<F;N++)B=e(i,0),E=q.getSilentFrame(r.manifestCodec||r.codec,r.channelCount),E||(O.b.log('Unable to get silent frame for given audio codec; duplicating last frame instead.'),E=C.unit.subarray()),y.splice(D,0,{unit:E,pts:B,dts:B}),r.len+=E.length,i+=c,D++;C.pts=C.dts=i,i+=c,D++}else a(I)>0.1*c,C.pts=C.dts=i,i+=c,D++}for(var M=0,U=y.length;M<U;M++){var G=y[M],W=G.unit,K=G.pts;if(void 0!=A)T.duration=t((K-A)/u);else{var H=t(1e3*(K-b)/s),V=0;if(o&&r.isAAC&&H){if(0<H&&H<$)V=t((K-b)/c),O.b.log(H+' ms hole between AAC samples detected,filling it'),0<V&&(E=q.getSilentFrame(r.manifestCodec||r.codec,r.channelCount),!E&&(E=W.subarray()),r.len+=V*E.length);else if(-12>H){O.b.log('drop overlapping AAC sample, expected/parsed/delta:'+(b/s).toFixed(3)+'s/'+(K/s).toFixed(3)+'s/'+-H+'ms'),r.len-=W.byteLength;continue}K=b}if(v=K,0<r.len){var j=m?r.len:r.len+8;_=m?0:8;try{R=new Uint8Array(j)}catch(e){return void this.observer.trigger(P.a.ERROR,{type:w.b.MUX_ERROR,details:w.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:j,reason:'fail allocating audio mdat '+j})}if(!m){var Y=new DataView(R.buffer);Y.setUint32(0,j),R.set(Z.types.mdat,4)}}else return;for(var z=0;z<V;z++)E=q.getSilentFrame(r.manifestCodec||r.codec,r.channelCount),E||(O.b.log('Unable to get silent frame for given audio codec; duplicating this frame instead.'),E=W.subarray()),R.set(E,_),_+=E.byteLength,T={size:E.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},h.push(T)}R.set(W,_);var X=W.byteLength;_+=X,T={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},h.push(T),A=K}var Q=0,J=h.length;if(2<=J&&(Q=h[J-2].duration,T.duration=Q),J){this.nextAudioPts=b=A+u*Q,r.len=0,r.samples=h,S=m?new Uint8Array:Z.moof(r.sequenceNumber++,v/u,r),r.samples=[];var ee=v/s,te=b/s,ae={data1:S,data2:R,startPTS:ee,endPTS:te,startDTS:ee,endDTS:te,type:'audio',nb:J};return this.observer.trigger(P.a.FRAG_PARSING_DATA,ae),ae}return null}},n.prototype.remuxEmptyAudio=function(e,t,a,n){var o=e.inputTimeScale,d=e.samplerate?e.samplerate:o,s=this.nextAudioPts,l=(void 0===s?n.startDTS*o:s)+this._initDTS,u=n.endDTS*o+this._initDTS,p=o/d*1024,c=r((u-l)/p),f=q.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(O.b.warn('remux empty Audio'),!f)return void O.b.trace('Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!');for(var g=[],m=0,i;m<c;m++)i=l+m*p,g.push({unit:f,pts:i,dts:i}),e.len+=f.length;e.samples=g,this.remuxAudio(e,t,a)},n.prototype.remuxID3=function(e,t){var a=e.samples.length,r=e.inputTimeScale,n=this._initPTS,o=this._initDTS,i;if(a){for(var d=0;d<a;d++)i=e.samples[d],i.pts=(i.pts-n)/r,i.dts=(i.dts-o)/r;this.observer.trigger(P.a.FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t},n.prototype.remuxText=function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var a=e.samples.length,r=e.inputTimeScale,n=this._initPTS,o;if(a){for(var i=0;i<a;i++)o=e.samples[i],o.pts=(o.pts-n)/r;this.observer.trigger(P.a.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t},n.prototype._PTSNormalize=function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;4294967296<a(e-t);)e+=r;return e},n}(),ee=J,te=function(){function e(t){k(this,e),this.observer=t}return e.prototype.destroy=function(){},e.prototype.resetTimeStamp=function(){},e.prototype.resetInitSegment=function(){},e.prototype.remux=function(e,t,a,r,n,o,i,d){var s=this.observer,l='';e&&(l+='audio'),t&&(l+='video'),s.trigger(P.a.FRAG_PARSING_DATA,{data1:d,startPTS:n,startDTS:n,type:l,nb:1,dropped:0}),s.trigger(P.a.FRAG_PARSED)},e}(),ae=function(){function e(t,a,r,n){I(this,e),this.observer=t,this.typeSupported=a,this.config=r,this.vendor=n}return e.prototype.destroy=function(){var e=this.demuxer;e&&e.destroy()},e.prototype.push=function(e,t,a,r,n,o,i,d,s,l,u,p){if(0<e.byteLength&&null!=t&&null!=t.key&&'AES-128'===t.method){var c=this.decrypter;null==c&&(c=this.decrypter=new x.a(this.observer,this.config));var f=this,g;try{g=performance.now()}catch(e){g=Date.now()}c.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var c;try{c=performance.now()}catch(e){c=Date.now()}f.observer.trigger(P.a.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:c}}),f.pushDecrypted(new Uint8Array(e),t,new Uint8Array(a),r,n,o,i,d,s,l,u,p)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(a),r,n,o,i,d,s,l,u,p)},e.prototype.pushDecrypted=function(e,t,a,r,n,o,d,s,l,u,p,c){var f=this.demuxer;if(!f||d&&!this.probe(e)){for(var g=this.observer,m=this.typeSupported,y=this.config,h=[{demux:j,remux:ee},{demux:M,remux:te},{demux:N,remux:ee},{demux:Y,remux:ee}],b=0,i=h.length;b<i;b++){var _=h[b],T=_.demux.probe;if(T(e)){var E=this.remuxer=new _.remux(g,y,m,this.vendor);f=new _.demux(g,E,y,m),this.probe=T;break}}if(!f)return void g.trigger(P.a.ERROR,{type:w.b.MEDIA_ERROR,details:w.a.FRAG_PARSING_ERROR,fatal:!0,reason:'no demux matching with content found'});this.demuxer=f}var R=this.remuxer;(d||s)&&(f.resetInitSegment(a,r,n,u),R.resetInitSegment()),d&&(f.resetTimeStamp(c),R.resetTimeStamp(c)),'function'==typeof f.setDecryptData&&f.setDecryptData(t),f.append(e,o,l,p)},e}(),re=i.a=ae},function(r,i,l){'use strict';function u(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function p(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function c(e,t){var a=Xe[t];return!!a&&!0===a[e.slice(0,4)]}function f(e,t){return MediaSource.isTypeSupported((t||'video')+'/mp4;codecs="'+e+'"')}function g(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function m(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function y(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function h(e,t){if(!e)return null;for(var a=null,r=0,n;r<e.length;r++)n=e[r],n.id===t&&(a=n);return a}function b(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function _(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function T(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function R(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function S(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function v(){if('undefined'!=typeof window)return window.MediaSource||window.WebKitMediaSource}function A(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function L(t,a,r){var n=t[a],o=t[r],i=o.startPTS;isNaN(i)?r>a?o.start=n.start+n.duration:o.start=e(n.start-o.duration,0):r>a?(n.duration=i-n.start,0>n.duration&&We.b.warn('negative duration computed for frag '+n.sn+',level '+n.level+', there should be some duration drift between playlist and fragment!')):(o.duration=n.start-i,0>o.duration&&We.b.warn('negative duration computed for frag '+o.sn+',level '+o.level+', there should be some duration drift between playlist and fragment!'))}function D(t,r,n,o,d,l){var u=n;if(!isNaN(r.startPTS)){var p=a(r.startPTS-n);r.deltaPTS=isNaN(r.deltaPTS)?p:e(p,r.deltaPTS),u=e(n,r.startPTS),n=s(n,r.startPTS),o=e(o,r.endPTS),d=s(d,r.startDTS),l=e(l,r.endDTS)}var c=n-r.start;r.start=r.startPTS=n,r.maxStartPTS=u,r.endPTS=o,r.startDTS=d,r.endDTS=l,r.duration=o-n;var f=r.sn;if(!t||f<t.startSN||f>t.endSN)return 0;var g,m,y;for(g=f-t.startSN,m=t.fragments,m[g]=r,y=g;0<y;y--)L(m,y,y-1);for(y=g;y<m.length-1;y++)L(m,y,y+1);return t.PTSKnown=!0,c}function C(t,a){var r=e(t.startSN,a.startSN)-a.startSN,n=s(t.endSN,a.endSN)-a.startSN,o=a.startSN-t.startSN,d=t.fragments,l=a.fragments,u=0,p;if(n<r)return void(a.PTSKnown=!1);for(var c=r;c<=n;c++){var i=d[o+c],f=l[c];f&&i&&(u=i.cc-f.cc,!isNaN(i.startPTS)&&(f.start=f.startPTS=i.startPTS,f.endPTS=i.endPTS,f.duration=i.duration,f.backtracked=i.backtracked,f.dropped=i.dropped,p=f))}if(u)for(We.b.log('discontinuity sliding from playlist, take drift into account'),c=0;c<l.length;c++)l[c].cc+=u;if(p)D(a,p,p.startPTS,p.endPTS,p.startDTS,p.endDTS);else if(0<=o&&o<d.length){var g=d[o].start;for(c=0;c<l.length;c++)l[c].start+=g}a.PTSKnown=t.PTSKnown}function k(e,t){for(var a=null,r=0,n;r<e.length;r+=1)if(n=e[r],n&&n.cc===t){a=n;break}return a}function I(e,t){return it.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}function P(e,t,a){var r=!1;return t&&t.details&&a&&(a.endCC>a.startCC||e&&e.cc<a.startCC)&&(r=!0),r}function w(e,t){var a=e.fragments,r=t.fragments;if(!r.length||!a.length)return void We.b.log('No fragments to align');var n=k(a,r[0].cc);return n&&(!n||n.startPTS)?n:void We.b.log('No frag in previous level to align on')}function x(e,t){t.fragments.forEach(function(t){if(t){var a=t.start+e;t.start=t.startPTS=a,t.endPTS=a+t.duration}}),t.PTSKnown=!0}function O(e,t,a){if(P(e,t,a)){var r=w(t.details,a);r&&(We.b.log('Adjusting PTS using last level due to CC increase within current level'),x(r.start,a))}if(!1===a.PTSKnown&&t&&t.details){var n=t.details.programDateTime,o=a.programDateTime,i=(o-n)/1e3+t.details.fragments[0].start;isNaN(i)||(We.b.log('adjusting PTS using programDateTime delta, sliding:'+i.toFixed(3)),x(i,a))}}function F(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function N(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function B(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function M(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function U(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function G(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function W(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function K(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function H(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function V(){var e=v(),t=window.SourceBuffer||window.WebKitSourceBuffer,a=e&&'function'==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&'function'==typeof t.prototype.appendBuffer&&'function'==typeof t.prototype.remove;return!!a&&!!r}function j(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Y(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function z(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function q(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function X(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Q(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Z(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function $(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function J(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function ee(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function te(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ae(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function re(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function ne(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function oe(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function ie(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function de(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function se(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function le(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function ue(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function pe(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ce(){this.window=window,this.state='INITIAL',this.buffer='',this.decoder=new Wt,this.regionList=[]}function fe(e){function t(e,t,a,r){return 3600*(0|e)+60*(0|t)+(0|a)+(0|r)/1e3}var a=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return a?a[3]?t(a[1],a[2],a[3].replace(':',''),a[4]):59<a[1]?t(a[1],a[2],0,a[4]):t(0,a[1],a[2],a[4]):null}function ge(){this.values=Object.create(null)}function me(e,t,a,r){var n=r?e.split(r):[e];for(var o in n)if('string'==typeof n[o]){var i=n[o].split(a);if(2===i.length){var d=i[0],s=i[1];t(d,s)}}}function ye(e,t,a){function r(){var t=fe(e);if(null===t)throw new Error('Malformed timestamp: '+o);return e=e.replace(/^[^\sa-zA-Z-]+/,''),t}function n(){e=e.replace(/^\s+/,'')}var o=e;if(n(),t.startTime=r(),n(),'-->'!==e.substr(0,3))throw new Error('Malformed time stamp (time stamps must be separated by \'-->\'): '+o);e=e.substr(3),n(),t.endTime=r(),n(),function(e,t){var r=new ge;me(e,function(e,t){switch(e){case'region':for(var n=a.length-1;0<=n;n--)if(a[n].id===t){r.set(e,a[n].region);break}break;case'vertical':r.alt(e,t,['rl','lr']);break;case'line':var o=t.split(','),i=o[0];r.integer(e,i),r.percent(e,i)&&r.set('snapToLines',!1),r.alt(e,i,['auto']),2===o.length&&r.alt('lineAlign',o[1],['start',Ht,'end']);break;case'position':o=t.split(','),r.percent(e,o[0]),2===o.length&&r.alt('positionAlign',o[1],['start',Ht,'end','line-left','line-right','auto']);break;case'size':r.percent(e,t);break;case'align':r.alt(e,t,['start',Ht,'end','left','right']);}},/:/,/\s/),t.region=r.get('region',null),t.vertical=r.get('vertical','');var n=r.get('line','auto');'auto'===n&&-1===Kt.line&&(n=-1),t.line=n,t.lineAlign=r.get('lineAlign','start'),t.snapToLines=r.get('snapToLines',!0),t.size=r.get('size',100),t.align=r.get('align',Ht);var o=r.get('position','auto');'auto'===o&&50===Kt.position&&(o='start'===t.align||'left'===t.align?0:'end'===t.align||'right'===t.align?100:50),t.position=o}(e,t)}function he(e){return e.replace(/<br(?: \/)?>/gi,'\n')}function be(t,a,n,o){for(var i=window.VTTCue||window.TextTrackCue,d=0,r,l,u,p,f;d<o.rows.length;d++)if(r=o.rows[d],u=!0,p=0,f='',!r.isEmpty()){for(var g=0;g<r.chars.length;g++)r.chars[g].uchar.match(/\s/)&&u?p++:(f+=r.chars[g].uchar,u=!1);r.cueStartTime=a,a===n&&(n+=1e-4),l=new i(a,n,he(f.trim())),16<=p?p--:p++,l.line=navigator.userAgent.match(/Firefox\//)?d+1:7<d?d-2:d+1,l.align='left',l.position=e(0,s(100,100*(p/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(l)}}function _e(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Te(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Ee(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Re(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function Se(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function ve(e){if(e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}function Ae(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function Le(t,a,r,n){return s(a,n)-e(t,r)}function De(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function Ce(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function ke(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Ie(e){for(var t=[],a=0;a<e.length;a++)'subtitles'===e[a].kind&&t.push(e[a]);return t}function Pe(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function we(e,t){if(!e)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return t&&('object'==typeof t||'function'==typeof t)?t:e}function xe(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Oe(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}var Fe=Number.POSITIVE_INFINITY;Object.defineProperty(i,'__esModule',{value:!0});var Ne={};l.d(Ne,'newCue',function(){return be});var Be=l(6),Me=l.n(Be),Ue=l(1),Ge=l(2),We=l(0),Ke='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},He=function(){function e(t){u(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var a=arguments.length,r=Array(1<a?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return e.prototype.destroy=function(){this.unregisterListeners()},e.prototype.isEventHandler=function(){return'object'===Ke(this.handledEvents)&&this.handledEvents.length&&'function'==typeof this.onEvent},e.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if('hlsEventGeneric'===e)throw new Error('Forbidden event name: '+e);this.hls.on(e,this.onEvent)},this)},e.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)},this)},e.prototype.onEvent=function(e,t){this.onEventGeneric(e,t)},e.prototype.onEventGeneric=function(e,t){var a=function(e,t){var a='on'+e.replace('hls','');if('function'!=typeof this[a])throw new Error('Event '+e+' has no generic handler in this '+this.constructor.name+' class (tried '+a+')');return this[a].bind(this,t)};try{a.call(this,e,t).call()}catch(t){We.b.error('internal error happened while processing '+e+':'+t.message),this.hls.trigger(Ue.a.ERROR,{type:Ge.b.OTHER_ERROR,details:Ge.a.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),Ve=He,je=/^(\d+)x(\d+)$/,Ye=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,ze=function(){function e(t){for(var a in p(this,e),'string'==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(a)&&(this[a]=t[a])}var t=Number.MAX_SAFE_INTEGER;return e.prototype.decimalInteger=function(e){var a=parseInt(this[e],10);return a>t?Infinity:a},e.prototype.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||'0x').slice(2);t=(1&t.length?'0':'')+t;for(var a=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)a[r]=parseInt(t.slice(2*r,2*r+2),16);return a}return null},e.prototype.hexadecimalIntegerAsNumber=function(e){var a=parseInt(this[e],16);return a>t?Infinity:a},e.prototype.decimalFloatingPoint=function(e){return parseFloat(this[e])},e.prototype.enumeratedString=function(e){return this[e]},e.prototype.decimalResolution=function(e){var t=je.exec(this[e]);return null===t?void 0:{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t={},a;for(Ye.lastIndex=0;null!==(a=Ye.exec(e));){var r=a[2],n='"';0===r.indexOf(n)&&r.lastIndexOf(n)===r.length-1&&(r=r.slice(1,-1)),t[a[1]]=r}return t},e}(),qe=ze,Xe={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Qe=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Ze=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,$e=/#EXT-X-MEDIA:(.*)/g,Je=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(''),'g'),et=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,tt=function(){function e(){y(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return Qe(e,[{key:'uri',get:function(){return!this._uri&&this.reluri&&(this._uri=Me.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),at=function(){function e(){y(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return e.prototype.createInitializationVector=function(e){for(var t=new Uint8Array(16),a=12;16>a;a++)t[a]=255&e>>8*(15-a);return t},e.prototype.fragmentDecryptdataFromLevelkey=function(e,t){var a=e;return e&&e.method&&e.uri&&!e.iv&&(a=new tt,a.method=e.method,a.baseuri=e.baseuri,a.reluri=e.reluri,a.iv=this.createInitializationVector(t)),a},e.prototype.cloneObj=function(e){return JSON.parse(JSON.stringify(e))},Qe(e,[{key:'url',get:function(){return!this._url&&this.relurl&&(this._url=Me.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:'programDateTime',get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:'byteRange',get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split('@',2);if(1===t.length){var a=this.lastByteRangeEndOffset;e[0]=a?a:0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:'byteRangeStartOffset',get:function(){return this.byteRange[0]}},{key:'byteRangeEndOffset',get:function(){return this.byteRange[1]}},{key:'decryptdata',get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),rt=function(e){function t(a){y(this,t);var r=g(this,e.call(this,a,Ue.a.MANIFEST_LOADING,Ue.a.LEVEL_LOADING,Ue.a.AUDIO_TRACK_LOADING,Ue.a.SUBTITLE_TRACK_LOADING));return r.loaders={},r}return m(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},Ve.prototype.destroy.call(this)},t.prototype.onManifestLoading=function(e){this.load(e.url,{type:'manifest'})},t.prototype.onLevelLoading=function(e){this.load(e.url,{type:'level',level:e.level,id:e.id})},t.prototype.onAudioTrackLoading=function(e){this.load(e.url,{type:'audioTrack',id:e.id})},t.prototype.onSubtitleTrackLoading=function(e){this.load(e.url,{type:'subtitleTrack',id:e.id})},t.prototype.load=function(e,t){var a=this.loaders[t.type];if(void 0!==a){var r=a.context;if(r&&r.url===e)return void We.b.trace('playlist request ongoing');We.b.warn('abort previous loader for type:'+t.type),a.abort()}var n=this.hls.config,o,i,d,s;'manifest'===t.type?(o=n.manifestLoadingMaxRetry,i=n.manifestLoadingTimeOut,d=n.manifestLoadingRetryDelay,s=n.manifestLoadingMaxRetryTimeout):'level'===t.type?(o=0,i=n.levelLoadingTimeOut):(o=n.levelLoadingMaxRetry,i=n.levelLoadingTimeOut,d=n.levelLoadingRetryDelay,s=n.levelLoadingMaxRetryTimeout,We.b.log('loading playlist for '+t.type+' '+(t.level||t.id))),a=this.loaders[t.type]=t.loader='undefined'==typeof n.pLoader?new n.loader(n):new n.pLoader(n),t.url=e,t.responseType='';var l,u;l={timeout:i,maxRetry:o,retryDelay:d,maxRetryDelay:s},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},a.load(t,l,u)},t.prototype.resolve=function(e,t){return Me.a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},t.prototype.parseMasterPlaylist=function(e,t){function a(e,t){['video','audio'].forEach(function(a){var r=e.filter(function(e){return c(e,a)});if(r.length){var n=r.filter(function(e){return 0===e.lastIndexOf('avc1',0)||0===e.lastIndexOf('mp4a',0)});t[a+'Codec']=0<n.length?n[0]:r[0],e=e.filter(function(e){return-1===r.indexOf(e)})}}),t.unknownCodecs=e}var r=[],n;for(Ze.lastIndex=0;null!=(n=Ze.exec(e));){var o={},i=o.attrs=new qe(n[1]);o.url=this.resolve(n[2],t);var d=i.decimalResolution('RESOLUTION');d&&(o.width=d.width,o.height=d.height),o.bitrate=i.decimalInteger('AVERAGE-BANDWIDTH')||i.decimalInteger('BANDWIDTH'),o.name=i.NAME,a([].concat((i.CODECS||'').split(/[ ,]+/)),o),o.videoCodec&&-1!==o.videoCodec.indexOf('avc1')&&(o.videoCodec=this.avc1toavcoti(o.videoCodec)),r.push(o)}return r},t.prototype.parseMasterPlaylistMedia=function(e,t,a){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],n=[],o=0,i;for($e.lastIndex=0;null!==(i=$e.exec(e));){var d={},s=new qe(i[1]);if(s.TYPE===a){if(d.groupId=s['GROUP-ID'],d.name=s.NAME,d.type=a,d.default='YES'===s.DEFAULT,d.autoselect='YES'===s.AUTOSELECT,d.forced='YES'===s.FORCED,s.URI&&(d.url=this.resolve(s.URI,t)),d.lang=s.LANGUAGE,d.name||(d.name=d.lang),r.length){var l=h(r,d.groupId);d.audioCodec=l?l.codec:r[0].codec}d.id=o++,n.push(d)}}return n},t.prototype.avc1toavcoti=function(e){var t=e.split('.'),a;return 2<t.length?(a=t.shift()+'.',a+=parseInt(t.shift()).toString(16),a+=('000'+parseInt(t.shift()).toString(16)).substr(-4)):a=e,a},t.prototype.parseLevelPlaylist=function(e,t,a,r){var n=0,o=0,d={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},s=new tt,l=0,u=null,p=new at,c,f;for(Je.lastIndex=0;null!==(c=Je.exec(e));){var i=c[1];if(i){p.duration=parseFloat(i);var g=(' '+c[2]).slice(1);p.title=g?g:null,p.tagList.push(g?['INF',i,g]:['INF',i])}else if(c[3]){if(!isNaN(p.duration)){var m=n++;p.type=r,p.start=o,p.levelkey=s,p.sn=m,p.level=a,p.cc=l,p.baseurl=t,p.relurl=(' '+c[3]).slice(1),d.fragments.push(p),u=p,o+=p.duration,p=new at}}else if(c[4]){if(p.rawByteRange=(' '+c[4]).slice(1),u){var y=u.byteRangeEndOffset;y&&(p.lastByteRangeEndOffset=y)}}else if(c[5])p.rawProgramDateTime=(' '+c[5]).slice(1),p.tagList.push(['PROGRAM-DATE-TIME',p.rawProgramDateTime]),void 0===d.programDateTime&&(d.programDateTime=new Date(new Date(Date.parse(c[5]))-1e3*o));else{for(c=c[0].match(et),f=1;f<c.length&&void 0===c[f];f++);var h=(' '+c[f+1]).slice(1),b=(' '+c[f+2]).slice(1);switch(c[f]){case'#':p.tagList.push(b?[h,b]:[h]);break;case'PLAYLIST-TYPE':d.type=h.toUpperCase();break;case'MEDIA-SEQUENCE':n=d.startSN=parseInt(h);break;case'TARGETDURATION':d.targetduration=parseFloat(h);break;case'VERSION':d.version=parseInt(h);break;case'EXTM3U':break;case'ENDLIST':d.live=!1;break;case'DIS':l++,p.tagList.push(['DIS']);break;case'DISCONTINUITY-SEQ':l=parseInt(h);break;case'KEY':var _=new qe(h),T=_.enumeratedString('METHOD'),E=_.URI,R=_.hexadecimalInteger('IV');T&&(s=new tt,E&&0<=['AES-128','SAMPLE-AES'].indexOf(T)&&(s.method=T,s.baseuri=t,s.reluri=E,s.key=null,s.iv=R));break;case'START':var S=new qe(h),v=S.decimalFloatingPoint('TIME-OFFSET');isNaN(v)||(d.startTimeOffset=v);break;case'MAP':var A=new qe(h);p.relurl=A.URI,p.rawByteRange=A.BYTERANGE,p.baseurl=t,p.level=a,p.type=r,p.sn='initSegment',d.initSegment=p,p=new at;break;default:We.b.warn('line parsed but not handled: '+c);}}}return p=u,p&&!p.relurl&&(d.fragments.pop(),o-=p.duration),d.totalduration=o,d.averagetargetduration=o/d.fragments.length,d.endSN=n-1,d.startCC=d.fragments[0]?d.fragments[0].cc:0,d.endCC=l,d},t.prototype.loadsuccess=function(e,t,a){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,n=e.data,o=e.url,i=a.type,d=a.id,s=a.level,l=this.hls;if(this.loaders[i]=void 0,(void 0===o||0===o.indexOf('data:'))&&(o=a.url),t.tload=performance.now(),0!==n.indexOf('#EXTM3U'))l.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.MANIFEST_PARSING_ERROR,fatal:!0,url:o,reason:'no EXTM3U delimiter',networkDetails:r});else if(0<n.indexOf('#EXTINF:')){var u=isNaN(s)?isNaN(d)?0:d:s,p=this.parseLevelPlaylist(n,o,u,'audioTrack'===i?'audio':'subtitleTrack'===i?'subtitle':'main');p.tload=t.tload,'manifest'===i&&l.trigger(Ue.a.MANIFEST_LOADED,{levels:[{url:o,details:p}],audioTracks:[],url:o,stats:t,networkDetails:r}),t.tparsed=performance.now(),p.targetduration?'audioTrack'!==i&&'subtitleTrack'!==i?l.trigger(Ue.a.LEVEL_LOADED,{details:p,level:s||0,id:d||0,stats:t,networkDetails:r}):'audioTrack'===i?l.trigger(Ue.a.AUDIO_TRACK_LOADED,{details:p,id:d,stats:t,networkDetails:r}):'subtitleTrack'===i&&l.trigger(Ue.a.SUBTITLE_TRACK_LOADED,{details:p,id:d,stats:t,networkDetails:r}):l.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.MANIFEST_PARSING_ERROR,fatal:!0,url:o,reason:'invalid targetduration',networkDetails:r})}else{var c=this.parseMasterPlaylist(n,o);if(c.length){var f=c.map(function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}}),g=this.parseMasterPlaylistMedia(n,o,'AUDIO',f),m=this.parseMasterPlaylistMedia(n,o,'SUBTITLES');if(g.length){var y=!1;g.forEach(function(e){e.url||(y=!0)}),!1==y&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(We.b.log('audio codec signaled in quality level, but no embedded audio track signaled, create one'),g.unshift({type:'main',name:'main'}))}l.trigger(Ue.a.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:m,url:o,stats:t,networkDetails:r})}else l.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.MANIFEST_PARSING_ERROR,fatal:!0,url:o,reason:'no level found in manifest',networkDetails:r})}},t.prototype.loaderror=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=t.loader,n,o;switch(t.type){case'manifest':n=Ge.a.MANIFEST_LOAD_ERROR,o=!0;break;case'level':n=Ge.a.LEVEL_LOAD_ERROR,o=!1;break;case'audioTrack':n=Ge.a.AUDIO_TRACK_LOAD_ERROR,o=!1;}r&&(r.abort(),this.loaders[t.type]=void 0),this.hls.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:n,fatal:o,url:r.url,loader:r,response:e,context:t,networkDetails:a})},t.prototype.loadtimeout=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=t.loader,n,o;switch(t.type){case'manifest':n=Ge.a.MANIFEST_LOAD_TIMEOUT,o=!0;break;case'level':n=Ge.a.LEVEL_LOAD_TIMEOUT,o=!1;break;case'audioTrack':n=Ge.a.AUDIO_TRACK_LOAD_TIMEOUT,o=!1;}r&&(r.abort(),this.loaders[t.type]=void 0),this.hls.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:n,fatal:o,url:r.url,loader:r,context:t,networkDetails:a})},t}(Ve),nt=function(e){function t(a){b(this,t);var r=_(this,e.call(this,a,Ue.a.FRAG_LOADING));return r.loaders={},r}return T(t,e),t.prototype.destroy=function(){var e=this.loaders;for(var t in e){var a=e[t];a&&a.destroy()}this.loaders={},Ve.prototype.destroy.call(this)},t.prototype.onFragLoading=function(e){var t=e.frag,a=t.type,r=this.loaders[a],n=this.hls.config;t.loaded=0,r&&(We.b.warn('abort previous fragment loader for type:'+a),r.abort()),r=this.loaders[a]=t.loader='undefined'==typeof n.fLoader?new n.loader(n):new n.fLoader(n);var o,i,d;o={url:t.url,frag:t,responseType:'arraybuffer',progressData:!1};var s=t.byteRangeStartOffset,l=t.byteRangeEndOffset;isNaN(s)||isNaN(l)||(o.rangeStart=s,o.rangeEnd=l),i={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(o,i,d)},t.prototype.loadsuccess=function(e,t,a){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,n=e.data,o=a.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(Ue.a.FRAG_LOADED,{payload:n,frag:o,stats:t,networkDetails:r})},t.prototype.loaderror=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:a})},t.prototype.loadtimeout=function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:a})},t.prototype.loadprogress=function(e,t){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=t.frag;r.loaded=e.loaded,this.hls.trigger(Ue.a.FRAG_LOAD_PROGRESS,{frag:r,stats:e,networkDetails:a})},t}(Ve),ot=function(e){function t(a){E(this,t);var r=R(this,e.call(this,a,Ue.a.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return S(t,e),t.prototype.destroy=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},Ve.prototype.destroy.call(this)},t.prototype.onKeyLoading=function(e){var t=e.frag,a=t.type,r=this.loaders[a],n=t.decryptdata,o=n.uri;if(o!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;r&&(We.b.warn('abort previous key loader for type:'+a),r.abort()),t.loader=this.loaders[a]=new i.loader(i),this.decrypturl=o,this.decryptkey=null;var d,s,l;d={url:o,frag:t,responseType:'arraybuffer'},s={timeout:i.fragLoadingTimeOut,maxRetry:i.fragLoadingMaxRetry,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(d,s,l)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(Ue.a.KEY_LOADED,{frag:t}))},t.prototype.loadsuccess=function(e,t,a){var r=a.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(Ue.a.KEY_LOADED,{frag:r})},t.prototype.loaderror=function(e,t){var a=t.frag,r=a.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.KEY_LOAD_ERROR,fatal:!1,frag:a,response:e})},t.prototype.loadtimeout=function(e,t){var a=t.frag,r=a.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(Ue.a.ERROR,{type:Ge.b.NETWORK_ERROR,details:Ge.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})},t}(Ve),it={search:function(e,t){for(var a=0,r=e.length-1,n=null,o=null;a<=r;){n=0|(a+r)/2,o=e[n];var i=t(o);if(0<i)a=n+1;else if(0>i)r=n-1;else return o}return null}},dt={isBuffered:function(e,t){try{if(e)for(var a=e.buffered,r=0;r<a.length;r++)if(t>=a.start(r)&&t<=a.end(r))return!0}catch(e){}return!1},bufferInfo:function(e,t,a){try{if(e){var r=e.buffered,n=[],o;for(o=0;o<r.length;o++)n.push({start:r.start(o),end:r.end(o)});return this.bufferedInfo(n,t,a)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},bufferedInfo:function(e,t,a){var r=[],n,o,d,s,l;for(e.sort(function(e,t){var a=e.start-t.start;return a?a:t.end-e.end}),l=0;l<e.length;l++){var i=r.length;if(i){var u=r[i-1].end;e[l].start-u<a?e[l].end>u&&(r[i-1].end=e[l].end):r.push(e[l])}else r.push(e[l])}for(l=0,n=0,o=d=t;l<r.length;l++){var p=r[l].start,c=r[l].end;if(t+a>=p&&t<c)o=p,d=c,n=d-t;else if(t+a<p){s=p;break}}return{len:n,start:o,end:d,nextStart:s}}},st=l(7),lt=l(5),ut=l.n(lt),pt=l(9),ct=l.n(pt),ft=v(),gt=function(){function e(t,a){A(this,e),this.hls=t,this.id=a;var r=this.observer=new ut.a,n=t.config;r.trigger=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];r.emit.apply(r,[e,e].concat(a))},r.off=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];r.removeListener.apply(r,[e].concat(a))};var o=function(e,a){a=a||{},a.frag=this.frag,a.id=this.id,t.trigger(e,a)}.bind(this);r.on(Ue.a.FRAG_DECRYPTED,o),r.on(Ue.a.FRAG_PARSING_INIT_SEGMENT,o),r.on(Ue.a.FRAG_PARSING_DATA,o),r.on(Ue.a.FRAG_PARSED,o),r.on(Ue.a.ERROR,o),r.on(Ue.a.FRAG_PARSING_METADATA,o),r.on(Ue.a.FRAG_PARSING_USERDATA,o),r.on(Ue.a.INIT_PTS_FOUND,o);var i={mp4:ft.isTypeSupported('video/mp4'),mpeg:ft.isTypeSupported('audio/mpeg'),mp3:ft.isTypeSupported('audio/mp4; codecs="mp3"')},d=navigator.vendor;if(n.enableWorker&&'undefined'!=typeof Worker){We.b.log('demuxing in webworker');var s;try{s=this.w=ct()(10),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener('message',this.onwmsg),s.onerror=function(e){t.trigger(Ue.a.ERROR,{type:Ge.b.OTHER_ERROR,details:Ge.a.INTERNAL_EXCEPTION,fatal:!0,event:'demuxerWorker',err:{message:e.message+' ('+e.filename+':'+e.lineno+')'}})},s.postMessage({cmd:'init',typeSupported:i,vendor:d,id:a,config:JSON.stringify(n)})}catch(e){We.b.error('error while initializing DemuxerWorker, fallback on DemuxerInline'),s&&URL.revokeObjectURL(s.objectURL),this.demuxer=new st.a(r,i,n,d),this.w=void 0}}else this.demuxer=new st.a(r,i,n,d)}return e.prototype.destroy=function(){var e=this.w;if(e)e.removeEventListener('message',this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var a=this.observer;a&&(a.removeAllListeners(),this.observer=null)},e.prototype.push=function(e,t,a,r,n,o,i,d){var s=this.w,l=isNaN(n.startDTS)?n.start:n.startDTS,u=n.decryptdata,p=this.frag,c=!(p&&n.cc===p.cc),f=!(p&&n.level===p.level),g=p&&n.sn===p.sn+1,m=!f&&g;if(c&&We.b.log(this.id+':discontinuity detected'),f&&We.b.log(this.id+':switch detected'),this.frag=n,s)s.postMessage({cmd:'demux',data:e,decryptdata:u,initSegment:t,audioCodec:a,videoCodec:r,timeOffset:l,discontinuity:c,trackSwitch:f,contiguous:m,duration:o,accurateTimeOffset:i,defaultInitPTS:d},e instanceof ArrayBuffer?[e]:[]);else{var y=this.demuxer;y&&y.push(e,u,t,a,r,l,c,f,m,o,i,d)}},e.prototype.onWorkerMessage=function(e){var t=e.data,a=this.hls;switch(t.event){case'init':URL.revokeObjectURL(this.w.objectURL);break;case Ue.a.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,a.trigger(t.event,t.data);}},e}(),mt=gt,yt={toString:function(e){for(var t='',a=e.length,r=0;r<a;r++)t+='['+e.start(r).toFixed(3)+','+e.end(r).toFixed(3)+']';return t}},ht=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),bt={STOPPED:'STOPPED',IDLE:'IDLE',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_LEVEL:'WAITING_LEVEL',PARSING:'PARSING',PARSED:'PARSED',BUFFER_FLUSHING:'BUFFER_FLUSHING',ENDED:'ENDED',ERROR:'ERROR'},_t=function(r){function o(e){F(this,o);var t=N(this,r.call(this,e,Ue.a.MEDIA_ATTACHED,Ue.a.MEDIA_DETACHING,Ue.a.MANIFEST_LOADING,Ue.a.MANIFEST_PARSED,Ue.a.LEVEL_LOADED,Ue.a.KEY_LOADED,Ue.a.FRAG_LOADED,Ue.a.FRAG_LOAD_EMERGENCY_ABORTED,Ue.a.FRAG_PARSING_INIT_SEGMENT,Ue.a.FRAG_PARSING_DATA,Ue.a.FRAG_PARSED,Ue.a.ERROR,Ue.a.AUDIO_TRACK_SWITCHING,Ue.a.AUDIO_TRACK_SWITCHED,Ue.a.BUFFER_CREATED,Ue.a.BUFFER_APPENDED,Ue.a.BUFFER_FLUSHED));return t.config=e.config,t.audioCodecSwap=!1,t.ticks=0,t._state=bt.STOPPED,t.ontick=t.tick.bind(t),t}return B(o,r),o.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Ve.prototype.destroy.call(this),this.state=bt.STOPPED},o.prototype.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=a.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=a.nextLoadLevel=r,this.loadedmetadata=!1}0<t&&-1===e&&(We.b.log('override startPosition with lastCurrentTime @'+t.toFixed(3)),e=t),this.state=bt.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=bt.STOPPED},o.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=bt.STOPPED,this.forceStartLoad=!1},o.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},o.prototype.doTick=function(){switch(this.state){case bt.ERROR:break;case bt.BUFFER_FLUSHING:this.fragLoadError=0;break;case bt.IDLE:this._doTickIdle();break;case bt.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=bt.IDLE);break;case bt.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),a=this.retryDate;(!a||t>=a||this.media&&this.media.seeking)&&(We.b.log('mediaController: retryDate reached, switch back to IDLE state'),this.state=bt.IDLE);break;case bt.ERROR:case bt.STOPPED:case bt.FRAG_LOADING:case bt.PARSING:case bt.PARSED:case bt.ENDED:break;default:}this._checkBuffer(),this._checkFragmentChanged()},o.prototype._doTickIdle=function(){var t=this.hls,a=t.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&a.startFragPrefetch)){var n=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var o=t.nextLoadLevel,i=this.levels[o];if(i){var d=i.bitrate,l;l=d?e(8*a.maxBufferSize/d,a.maxBufferLength):a.maxBufferLength,l=s(l,a.maxMaxBufferLength);var u=dt.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,n,a.maxBufferHole),p=u.len;if(!(p>=l)){We.b.trace('buffer length of '+p.toFixed(3)+' is below max of '+l.toFixed(3)+'. checking for more payload ...'),this.level=t.nextLoadLevel=o;var c=i.details;if(void 0===c||!0===c.live&&this.levelLastLoaded!==o)return void(this.state=bt.WAITING_LEVEL);var f=this.fragPrevious;if(!c.live&&f&&!f.backtracked&&f.sn===c.endSN&&!u.nextStart){var g=s(r.duration,f.start+f.duration);if(g-e(u.end,f.start)<=e(0.2,f.duration)){var m={};return this.altAudio&&(m.type='video'),this.hls.trigger(Ue.a.BUFFER_EOS,m),void(this.state=bt.ENDED)}}this._fetchPayloadOrEos(n,u,c)}}}},o.prototype._fetchPayloadOrEos=function(e,t,a){var r=this.fragPrevious,n=this.level,o=a.fragments,i=o.length;if(0!==i){var d=o[0].start,s=o[i-1].start+o[i-1].duration,l=t.end,u;if(a.initSegment&&!a.initSegment.data)u=a.initSegment;else if(a.live){var p=this.config.initialLiveManifestSize;if(i<p)return void We.b.warn('Can not start playback of a level, reason: not enough fragments '+i+' < '+p);if(u=this._ensureFragmentAtLivePoint(a,l,d,s,r,o,i),null===u)return}else l<d&&(u=o[0]);return u||(u=this._findFragment(d,r,i,o,l,s,a)),void(u&&this._loadFragmentOrKey(u,n,a,e,l))}},o.prototype._ensureFragmentAtLivePoint=function(a,r,n,o,i,d,l){var u=this.hls.config,p=this.media,c=void 0===u.liveMaxLatencyDuration?u.liveMaxLatencyDurationCount*a.targetduration:u.liveMaxLatencyDuration,f;if(r<e(n-u.maxFragLookUpTolerance,o-c)){var g=this.liveSyncPosition=this.computeLivePosition(n,a);We.b.log('buffer end: '+r.toFixed(3)+' is located too far from the end of live sliding playlist, reset currentTime to : '+g.toFixed(3)),r=g,p&&p.readyState&&p.duration>g&&(p.currentTime=g),this.nextLoadPosition=g}if(a.PTSKnown&&r>o&&p&&p.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(i){var m=i.sn+1;if(m>=a.startSN&&m<=a.endSN){var y=d[m-a.startSN];i.cc===y.cc&&(f=y,We.b.log('live playlist, switching playlist, load frag with next SN: '+f.sn))}f||(f=it.search(d,function(e){return i.cc-e.cc}),f&&We.b.log('live playlist, switching playlist, load frag with same CC: '+f.sn))}f||(f=d[s(l-1,t(l/2))],We.b.log('live playlist, switching playlist, unknown, load middle frag : '+f.sn))}return f},o.prototype._findFragment=function(e,t,a,r,n,o,i){var d=this.hls.config,l=d.maxFragLookUpTolerance,u=t?r[t.sn-r[0].sn+1]:void 0,p=function(e){var t=s(l,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=n?1:e.start-t>n&&e.start?-1:0},c,f;if(n<o?(n>o-l&&(l=0),f=u&&!p(u)?u:it.search(r,p)):f=r[a-1],f){c=f;var g=c.sn-i.startSN,m=t&&c.level===t.level,y=r[g-1],h=r[g+1];if(t&&c.sn===t.sn)if(!m||c.backtracked)c.backtracked&&(h&&h.backtracked?(We.b.warn('Already backtracked from fragment '+h.sn+', will not backtrack to fragment '+c.sn+'. Loading fragment '+h.sn),c=h):(We.b.warn('Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe'),c.dropped=0,y?(y.loadCounter&&y.loadCounter--,c=y,c.backtracked=!0):g&&(c=null)));else if(c.sn<i.endSN){var b=t.deltaPTS;b&&b>d.maxBufferHole&&t.dropped&&g?(c=y,We.b.warn('SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this'),t.loadCounter--):(c=h,We.b.log('SN just loaded, load next one: '+c.sn))}else c=null}return c},o.prototype._loadFragmentOrKey=function(e,t,r,n,o){var i=this.hls,d=i.config;if(e.decryptdata&&null!=e.decryptdata.uri&&null==e.decryptdata.key)We.b.log('Loading key for '+e.sn+' of ['+r.startSN+' ,'+r.endSN+'],level '+t),this.state=bt.KEY_LOADING,i.trigger(Ue.a.KEY_LOADING,{frag:e});else{if(We.b.log('Loading '+e.sn+' of ['+r.startSN+' ,'+r.endSN+'],level '+t+', currentTime:'+n.toFixed(3)+',bufferEnd:'+o.toFixed(3)),void 0===this.fragLoadIdx?this.fragLoadIdx=0:this.fragLoadIdx++,e.loadCounter){e.loadCounter++;var s=d.fragLoadingLoopThreshold;if(e.loadCounter>s&&a(this.fragLoadIdx-e.loadIdx)<s)return void i.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e})}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,e.autoLevel=i.autoLevelEnabled,e.bitrateTest=this.bitrateTest,this.fragCurrent=e,this.startFragRequested=!0,isNaN(e.sn)||e.bitrateTest||(this.nextLoadPosition=e.start+e.duration),i.trigger(Ue.a.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new mt(i,'main')),void(this.state=bt.FRAG_LOADING)}},o.prototype.getBufferedFrag=function(e){return it.search(this._bufferedFrags,function(t){return e<t.startPTS?-1:e>t.endPTS?1:0})},o.prototype.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+0.5):null},o.prototype._checkFragmentChanged=function(){var e=this.media,t,a;if(e&&e.readyState&&!1===e.seeking&&(a=e.currentTime,a>e.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=a),dt.isBuffered(e,a)?t=this.getBufferedFrag(a):dt.isBuffered(e,a+0.1)&&(t=this.getBufferedFrag(a+0.1)),t)){var r=t;if(r!==this.fragPlaying){this.hls.trigger(Ue.a.FRAG_CHANGED,{frag:r});var n=r.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(Ue.a.LEVEL_SWITCHED,{level:n}),this.fragPlaying=r}}},o.prototype.immediateLevelSwitch=function(){if(We.b.log('immediateLevelSwitch'),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},o.prototype.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,dt.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),!this.previouslyPaused&&e.play())},o.prototype.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,a,r;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),a=this.getBufferedFrag(e.currentTime),a&&1<a.startPTS&&this.flushMainBuffer(0,a.startPTS-1),!e.paused){var n=this.hls.nextLoadLevel,o=this.levels[n],i=this.fragLastKbps;t=i&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*i)+1:0}else t=0;if(r=this.getBufferedFrag(e.currentTime+t),r&&(r=this.followingBufferedFrag(r),r)){var d=this.fragCurrent;d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.maxStartPTS,Number.POSITIVE_INFINITY)}}},o.prototype.flushMainBuffer=function(e,t){this.state=bt.BUFFER_FLUSHING;var a={startOffset:e,endOffset:t};this.altAudio&&(a.type='video'),this.hls.trigger(Ue.a.BUFFER_FLUSHING,a)},o.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener('seeking',this.onvseeking),t.addEventListener('seeked',this.onvseeked),t.addEventListener('ended',this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.hls.startLoad(a.startPosition)},o.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(We.b.log('MSE detaching and video ended, reset startPosition'),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0,e.backtracked=void 0})}),e&&(e.removeEventListener('seeking',this.onvseeking),e.removeEventListener('seeked',this.onvseeked),e.removeEventListener('ended',this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},o.prototype.onMediaSeeking=function(){var e=this.media,t=e?e.currentTime:void 0,a=this.config;isNaN(t)||We.b.log('media seeking to '+t.toFixed(3));var r=this.mediaBuffer?this.mediaBuffer:e,n=dt.bufferInfo(r,t,this.config.maxBufferHole);if(this.state===bt.FRAG_LOADING){var o=this.fragCurrent;if(0===n.len&&o){var i=a.maxFragLookUpTolerance,d=o.start-i,s=o.start+o.duration+i;t<d||t>s?(o.loader&&(We.b.log('seeking outside of buffer while fragment load in progress, cancel fragment load'),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=bt.IDLE):We.b.log('seeking outside of buffer but within currently loaded fragment range')}}else this.state===bt.ENDED&&(0===n.len&&(this.fragPrevious=0),this.state=bt.IDLE);e&&(this.lastCurrentTime=t),this.state!==bt.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*a.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()},o.prototype.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;isNaN(t)||We.b.log('media seeked to '+t.toFixed(3)),this.tick()},o.prototype.onMediaEnded=function(){We.b.log('media ended'),this.startPosition=this.lastCurrentTime=0},o.prototype.onManifestLoading=function(){We.b.log('trigger BUFFER_RESET'),this.hls.trigger(Ue.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},o.prototype.onManifestParsed=function(e){var t=!1,a=!1,r;e.levels.forEach(function(e){r=e.audioCodec,r&&(-1!==r.indexOf('mp4a.40.2')&&(t=!0),-1!==r.indexOf('mp4a.40.5')&&(a=!0))}),this.audioCodecSwitch=t&&a,this.audioCodecSwitch&&We.b.log('both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC'),this.levels=e.levels,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)},o.prototype.onLevelLoaded=function(e){var t=e.details,a=e.level,r=this.levels[this.levelLastLoaded],n=this.levels[a],o=t.totalduration,i=0;if(We.b.log('level '+a+' loaded ['+t.startSN+','+t.endSN+'],duration:'+o),t.live){var d=n.details;d&&0<t.fragments.length?(C(d,t),i=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(i,d),t.PTSKnown&&!isNaN(i)?We.b.log('live playlist sliding:'+i.toFixed(3)):(We.b.log('live playlist - outdated PTS, unknown sliding'),O(this.fragPrevious,r,t))):(We.b.log('live playlist - first load, unknown sliding'),t.PTSKnown=!1,O(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(n.details=t,this.levelLastLoaded=a,this.hls.trigger(Ue.a.LEVEL_UPDATED,{details:t,level:a}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var s=t.startTimeOffset;isNaN(s)?t.live?(this.startPosition=this.computeLivePosition(i,t),We.b.log('configure startPosition to '+this.startPosition)):this.startPosition=0:(0>s&&(We.b.log('negative start time offset '+s+', count from end of last fragment'),s=i+o+s),We.b.log('start time offset found in playlist, adjust startPosition to '+s),this.startPosition=s),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===bt.WAITING_LEVEL&&(this.state=bt.IDLE),this.tick()},o.prototype.onKeyLoaded=function(){this.state===bt.KEY_LOADING&&(this.state=bt.IDLE,this.tick())},o.prototype.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag;if(this.state===bt.FRAG_LOADING&&t&&'main'===a.type&&a.level===t.level&&a.sn===t.sn){var r=e.stats,n=this.levels[t.level],o=n.details;if(We.b.log('Loaded  '+t.sn+' of ['+o.startSN+' ,'+o.endSN+'],level '+t.level),this.bitrateTest=!1,this.stats=r,!0===a.bitrateTest&&this.hls.nextLoadLevel)this.state=bt.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=performance.now(),this.hls.trigger(Ue.a.FRAG_BUFFERED,{stats:r,frag:t,id:'main'}),this.tick();else if('initSegment'===a.sn)this.state=bt.IDLE,r.tparsed=r.tbuffered=performance.now(),o.initSegment.data=e.payload,this.hls.trigger(Ue.a.FRAG_BUFFERED,{stats:r,frag:t,id:'main'}),this.tick();else{this.state=bt.PARSING;var i=o.totalduration,d=t.level,s=t.sn,l=this.config.defaultAudioCodec||n.audioCodec;this.audioCodecSwap&&(We.b.log('swapping playlist audio codec'),void 0===l&&(l=this.lastAudioCodec),l&&(-1===l.indexOf('mp4a.40.5')?l='mp4a.40.5':l='mp4a.40.2')),this.pendingBuffering=!0,this.appended=!1,We.b.log('Parsing '+s+' of ['+o.startSN+' ,'+o.endSN+'],level '+d+', cc '+t.cc);var u=this.demuxer;u||(u=this.demuxer=new mt(this.hls,'main'));var p=this.media,c=p&&p.seeking,f=!c&&(o.PTSKnown||!o.live),g=o.initSegment?o.initSegment.data:[];u.push(e.payload,g,l,n.videoCodec,t,i,f,void 0)}}this.fragLoadError=0},o.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&'main'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===bt.PARSING){var r=e.tracks,n,o;if(r.audio&&this.altAudio&&delete r.audio,o=r.audio,o){var i=this.levels[this.level].audioCodec,d=navigator.userAgent.toLowerCase();i&&this.audioCodecSwap&&(We.b.log('swapping playlist audio codec'),i=-1===i.indexOf('mp4a.40.5')?'mp4a.40.5':'mp4a.40.2'),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===d.indexOf('firefox')&&(i='mp4a.40.5'),-1!==d.indexOf('android')&&'audio/mpeg'!==o.container&&(i='mp4a.40.2',We.b.log('Android: force audio codec to '+i)),o.levelCodec=i,o.id=e.id}for(n in o=r.video,o&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=e.id),this.hls.trigger(Ue.a.BUFFER_CODECS,r),r){o=r[n],We.b.log('main track:'+n+',container:'+o.container+',codecs[level/parsed]=['+o.levelCodec+'/'+o.codec+']');var s=o.initSegment;s&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ue.a.BUFFER_APPENDING,{type:n,data:s,parent:'main',content:'initSegment'}))}this.tick()}},o.prototype.onFragParsingData=function(e){var t=this,a=this.fragCurrent,r=e.frag;if(a&&'main'===e.id&&r.sn===a.sn&&r.level===a.level&&!('audio'===e.type&&this.altAudio)&&this.state===bt.PARSING){var n=this.levels[this.level],o=a;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),We.b.log('Parsed '+e.type+',PTS:['+e.startPTS.toFixed(3)+','+e.endPTS.toFixed(3)+'],DTS:['+e.startDTS.toFixed(3)+'/'+e.endDTS.toFixed(3)+'],nb:'+e.nb+',dropped:'+(e.dropped||0)),'video'===e.type)if(o.dropped=e.dropped,!o.dropped)o.backtracked=!1;else if(!o.backtracked){var i=n.details;if(i&&o.sn===i.startSN)We.b.warn('missing video frame(s) on first frag, appending with gap');else return We.b.warn('missing video frame(s), backtracking fragment'),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=bt.IDLE,this.fragPrevious=o,void this.tick()}else We.b.warn('Already backtracked on this fragment, appending with the gap');var d=D(n.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),s=this.hls;s.trigger(Ue.a.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:d,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(a){a&&a.length&&t.state===bt.PARSING&&(t.appended=!0,t.pendingBuffering=!0,s.trigger(Ue.a.BUFFER_APPENDING,{type:e.type,data:a,parent:'main',content:'data'}))}),this.tick()}},o.prototype.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&'main'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===bt.PARSING&&(this.stats.tparsed=performance.now(),this.state=bt.PARSED,this._checkAppendedParsed())},o.prototype.onAudioTrackSwitching=function(e){var t=!!e.url,a=e.id;if(!t){if(this.mediaBuffer!==this.media){We.b.log('switching on main audio, use media.buffered to schedule main fragment loading'),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(We.b.log('switching to main audio track, cancel main fragment load'),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=bt.IDLE}var n=this.hls;n.trigger(Ue.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Fe,type:'audio'}),n.trigger(Ue.a.AUDIO_TRACK_SWITCHED,{id:a}),this.altAudio=!1}},o.prototype.onAudioTrackSwitched=function(e){var t=e.id,a=!!this.hls.audioTracks[t].url;if(a){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(We.b.log('switching on alternate audio, use video.buffered to schedule main fragment loading'),this.mediaBuffer=r)}this.altAudio=a,this.tick()},o.prototype.onBufferCreated=function(e){var t=e.tracks,a=!1,r,n;for(var o in t){var i=t[o];'main'===i.id?(n=o,r=i,'video'==o&&(this.videoBuffer=t[o].buffer)):a=!0}a&&r?(We.b.log('alternate track found, use '+n+'.buffered to schedule main fragment loading'),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},o.prototype.onBufferAppended=function(e){if('main'===e.parent){var t=this.state;(t===bt.PARSING||t===bt.PARSED)&&(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},o.prototype._checkAppendedParsed=function(){if(this.state===bt.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent;if(e){var a=this.mediaBuffer?this.mediaBuffer:this.media;We.b.log('main buffered : '+yt.toString(a.buffered));var r=this._bufferedFrags.filter(function(e){return dt.isBuffered(a,(e.startPTS+e.endPTS)/2)});r.push(e),this._bufferedFrags=r.sort(function(e,t){return e.startPTS-t.startPTS}),this.fragPrevious=e;var n=this.stats;n.tbuffered=performance.now(),this.fragLastKbps=t(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(Ue.a.FRAG_BUFFERED,{stats:n,frag:e,id:'main'}),this.state=bt.IDLE}this.tick()}},o.prototype.onError=function(e){var t=e.frag||this.fragCurrent;if(!(t&&'main'!==t.type)){var a=!!this.media&&dt.isBuffered(this.media,this.media.currentTime)&&dt.isBuffered(this.media,this.media.currentTime+0.5);switch(e.details){case Ge.a.FRAG_LOAD_ERROR:case Ge.a.FRAG_LOAD_TIMEOUT:case Ge.a.KEY_LOAD_ERROR:case Ge.a.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=s(n(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);t.loadCounter=0,We.b.warn('mediaController: frag loading failed, retry in '+r+' ms'),this.retryDate=performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=bt.FRAG_LOADING_WAITING_RETRY}else We.b.error('mediaController: '+e.details+' reaches max retry, redispatch as fatal ...'),e.fatal=!0,this.state=bt.ERROR;break;case Ge.a.FRAG_LOOP_LOADING_ERROR:e.fatal||(a?(this._reduceMaxBufferLength(t.duration),this.state=bt.IDLE):(!t.autoLevel||0===t.level)&&(e.fatal=!0,this.state=bt.ERROR));break;case Ge.a.LEVEL_LOAD_ERROR:case Ge.a.LEVEL_LOAD_TIMEOUT:this.state!==bt.ERROR&&(e.fatal?(this.state=bt.ERROR,We.b.warn('streamController: '+e.details+',switch to '+this.state+' state ...')):!e.levelRetry&&this.state===bt.WAITING_LEVEL&&(this.state=bt.IDLE));break;case Ge.a.BUFFER_FULL_ERROR:'main'===e.parent&&(this.state===bt.PARSING||this.state===bt.PARSED)&&(a?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=bt.IDLE):(We.b.warn('buffer full error also media.currentTime is not buffered, flush everything'),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)));break;default:}}},o.prototype._reduceMaxBufferLength=function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,We.b.warn('main:reduce max buffer length to '+t.maxMaxBufferLength+'s'),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*t.fragLoadingLoopThreshold))},o.prototype._checkBuffer=function(){var e=this.media,r=this.config;if(e&&e.readyState){var n=e.currentTime,o=this.mediaBuffer?this.mediaBuffer:e,i=o.buffered;if(!this.loadedmetadata&&i.length){this.loadedmetadata=!0;var d=e.seeking?n:this.startPosition,s=dt.isBuffered(o,d),l=i.start(0),u=!s&&a(d-l)<r.maxSeekHole;(n!==d||u)&&(We.b.log('target start position:'+d),u&&(d=l,We.b.log('target start position not buffered, seek to buffered.start(0) '+d)),We.b.log('adjust currentTime from '+n+' to '+d),e.currentTime=d)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var p=dt.bufferInfo(e,n,0),c=!(e.paused||e.ended||0===e.buffered.length),f=0.5,g=n!==this.lastCurrentTime;if(g)this.stallReported&&(We.b.warn('playback not stuck anymore @'+n+', after '+t(performance.now()-this.stalled)+'ms'),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(c){var m=performance.now(),y=this.hls;if(!this.stalled)this.stalled=m,this.stallReported=!1;else{var h=m-this.stalled,b=p.len,_=this.nudgeRetry||0;if(b<=f&&h>1e3*r.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,We.b.warn('playback stalling in low buffer @'+n),y.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:b}));var T=p.nextStart,E=T-n;if(T&&E<r.maxSeekHole&&0<E){this.nudgeRetry=++_;var R=_*r.nudgeOffset;We.b.log('adjust currentTime from '+e.currentTime+' to next buffered @ '+T+' + nudge '+R),e.currentTime=T+R,this.stalled=void 0,y.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:T+R-n})}}else if(b>f&&h>1e3*r.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,We.b.warn('playback stalling in high buffer @'+n),y.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:b})),this.stalled=void 0,this.nudgeRetry=++_,_<r.nudgeMaxRetry){var S=e.currentTime,v=S+_*r.nudgeOffset;We.b.log('adjust currentTime from '+S+' to '+v),e.currentTime=v,y.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else We.b.error('still stuck in high buffer @'+n+' after '+r.nudgeMaxRetry+', raise fatal error'),y.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_STALLED_ERROR,fatal:!0})}}}}},o.prototype.onFragLoadEmergencyAborted=function(){this.state=bt.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},o.prototype.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(t){return dt.isBuffered(e,(t.startPTS+t.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=bt.IDLE,this.fragPrevious=null},o.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},o.prototype.computeLivePosition=function(t,a){var r=void 0===this.config.liveSyncDuration?this.config.liveSyncDurationCount*a.targetduration:this.config.liveSyncDuration;return t+e(0,a.totalduration-r)},ht(o,[{key:'state',set:function(e){if(this.state!==e){var t=this.state;this._state=e,We.b.log('main stream:'+t+'->'+e),this.hls.trigger(Ue.a.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:'currentLevel',get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:'nextBufferedFrag',get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:'nextLevel',get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:'liveSyncPosition',get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),o}(Ve),Tt=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Et=function(a){function r(e){M(this,r);var t=U(this,a.call(this,e,Ue.a.MANIFEST_LOADED,Ue.a.LEVEL_LOADED,Ue.a.FRAG_LOADED,Ue.a.ERROR));return t.canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,t}return G(r,a),r.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},r.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},r.prototype.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),null!==this.timer&&this.loadLevel()},r.prototype.stopLoad=function(){this.canload=!1},r.prototype.onManifestLoaded=function(e){var t=[],a={},r=null,n=!1,o=!1,d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),s=[],l;if(e.levels.forEach(function(e){e.loadError=0,e.fragmentError=!1,n=n||!!e.videoCodec,o=o||!!e.audioCodec||!!(e.attrs&&e.attrs.AUDIO),!0===d&&e.audioCodec&&-1!==e.audioCodec.indexOf('mp4a.40.34')&&(e.audioCodec=void 0),r=a[e.bitrate],void 0===r?(e.url=[e.url],e.urlId=0,a[e.bitrate]=e,t.push(e)):r.url.push(e.url)}),!0==n&&!0==o&&(t=t.filter(function(e){var t=e.videoCodec;return!!t})),t=t.filter(function(e){var t=e.audioCodec,a=e.videoCodec;return(!t||f(t))&&(!a||f(a))}),e.audioTracks&&(s=e.audioTracks.filter(function(e){return!e.audioCodec||f(e.audioCodec,'audio')})),0<t.length){l=t[0].bitrate,t.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=t;for(var u=0;u<t.length;u++)if(t[u].bitrate===l){this._firstLevel=u,We.b.log('manifest loaded,'+t.length+' level(s) found, first bitrate:'+l);break}this.hls.trigger(Ue.a.MANIFEST_PARSED,{levels:t,audioTracks:s,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:n,altAudio:0<s.length})}else this.hls.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:'no level with compatible codecs found in manifest'})},r.prototype.setLevelInternal=function(e){var t=this._levels,a=this.hls;if(0<=e&&e<t.length){if(this.cleanTimer(),this.currentLevelIndex!==e){We.b.log('switching to level '+e),this.currentLevelIndex=e;var r=t[e];r.level=e,a.trigger(Ue.a.LEVEL_SWITCH,r),a.trigger(Ue.a.LEVEL_SWITCHING,r)}var n=t[e],o=n.details;if(!o||!0===o.live){var i=n.urlId;a.trigger(Ue.a.LEVEL_LOADING,{url:n.url[i],level:e,id:i})}}else a.trigger(Ue.a.ERROR,{type:Ge.b.OTHER_ERROR,details:Ge.a.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:'invalid level idx'})},r.prototype.onError=function(e){if(!0===e.fatal)return void(e.type===Ge.b.NETWORK_ERROR&&this.cleanTimer());var t=!1,a=!1,r;switch(e.details){case Ge.a.FRAG_LOAD_ERROR:case Ge.a.FRAG_LOAD_TIMEOUT:case Ge.a.FRAG_LOOP_LOADING_ERROR:case Ge.a.KEY_LOAD_ERROR:case Ge.a.KEY_LOAD_TIMEOUT:r=e.frag.level,a=!0;break;case Ge.a.LEVEL_LOAD_ERROR:case Ge.a.LEVEL_LOAD_TIMEOUT:r=e.context.level,t=!0;break;case Ge.a.REMUX_ALLOC_ERROR:r=e.level,t=!0;}void 0!==r&&this.recoverLevel(e,r,t,a)},r.prototype.recoverLevel=function(e,t,a,r){var o=this,i=this.hls.config,d=e.details,l=this._levels[t],u,p,c;if(l.loadError++,l.fragmentError=r,!0===a)if(this.levelRetryCount+1<=i.levelLoadingMaxRetry)p=s(n(2,this.levelRetryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return o.loadLevel()},p),e.levelRetry=!0,this.levelRetryCount++,We.b.warn('level controller, '+d+', retry in '+p+' ms, current retry count is '+this.levelRetryCount);else return We.b.error('level controller, cannot recover from '+d+' error'),this.currentLevelIndex=null,this.cleanTimer(),void(e.fatal=!0);(!0===a||!0===r)&&(u=l.url.length,1<u&&l.loadError<u?(We.b.warn('level controller, '+d+' for level '+t+': switching to redundant stream id '+l.urlId),l.urlId=(l.urlId+1)%u,l.details=void 0):-1===this.manualLevelIndex?(c=0===t?this._levels.length-1:t-1,We.b.warn('level controller, '+d+': switch to '+c),this.hls.nextAutoLevel=this.currentLevelIndex=c):!0===r&&(We.b.warn('level controller, '+d+': reload a fragment'),this.currentLevelIndex=null))},r.prototype.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&'main'===t.type){var a=this._levels[t.level];void 0!==a&&(a.fragmentError=!1,a.loadError=0,this.levelRetryCount=0)}},r.prototype.onLevelLoaded=function(a){var r=this,n=a.level;if(n===this.currentLevelIndex){var o=this._levels[n];!1===o.fragmentError&&(o.loadError=0,this.levelRetryCount=0);var i=a.details;if(i.live){var d=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),s=o.details;s&&i.endSN===s.endSN&&(d/=2,We.b.log('same live playlist, reload twice faster')),d-=performance.now()-a.stats.trequest,d=e(1e3,t(d)),We.b.log('live playlist, reload in '+d+' ms'),this.timer=setTimeout(function(){return r.loadLevel()},d)}else this.cleanTimer()}},r.prototype.loadLevel=function(){var e,t;null!==this.currentLevelIndex&&!0===this.canload&&(e=this._levels[this.currentLevelIndex],void 0!==e&&0<e.url.length&&(t=e.urlId,this.hls.trigger(Ue.a.LEVEL_LOADING,{url:e.url[t],level:this.currentLevelIndex,id:t})))},Tt(r,[{key:'levels',get:function(){return this._levels}},{key:'level',get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=s(e,t.length-1),(this.currentLevelIndex!==e||void 0===t[e].details)&&this.setLevelInternal(e))}},{key:'manualLevel',get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:'firstLevel',get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:'startLevel',get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0===e?this._firstLevel:e}return this._startLevel},set:function(e){this._startLevel=e}},{key:'nextLoadLevel',get:function(){return-1===this.manualLevelIndex?this.hls.nextAutoLevel:this.manualLevelIndex},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),r}(Ve),Rt=l(3),St=function(e){function t(a){W(this,t);var r=K(this,e.call(this,a,Ue.a.MEDIA_ATTACHED,Ue.a.MEDIA_DETACHING,Ue.a.FRAG_PARSING_METADATA));return r.id3Track=void 0,r.media=void 0,r}return H(t,e),t.prototype.destroy=function(){Ve.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){this.media=e.media,!this.media},t.prototype.onMediaDetaching=function(){this.media=void 0},t.prototype.onFragParsingMetadata=function(e){var t=e.frag,a=e.samples;this.id3Track||(this.id3Track=this.media.addTextTrack('metadata','id3'),this.id3Track.mode='hidden');for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0,o;n<a.length;n++)if(o=Rt.a.getID3Frames(a[n].data),o){var i=a[n].pts,d=n<a.length-1?a[n+1].pts:t.endPTS;i===d&&(d+=1e-4);for(var s=0,l;s<o.length;s++)if(l=o[s],!Rt.a.isTimeStampFrame(l)){var u=new r(i,d,'');u.value=l,this.id3Track.addCue(u)}}},t}(Ve),vt=function(){function e(t){j(this,e),this.alpha_=t?Math.exp(-0.6931471805599453/t):0,this.estimate_=0,this.totalWeight_=0}return e.prototype.sample=function(e,t){var a=n(this.alpha_,e);this.estimate_=t*(1-a)+a*this.estimate_,this.totalWeight_+=e},e.prototype.getTotalWeight=function(){return this.totalWeight_},e.prototype.getEstimate=function(){if(this.alpha_){var e=1-n(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),At=vt,Lt=function(){function t(e,a,r,n){Y(this,t),this.hls=e,this.defaultEstimate_=n,this.minWeight_=1e-3,this.minDelayMs_=50,this.slow_=new At(a),this.fast_=new At(r)}return t.prototype.sample=function(t,a){t=e(t,this.minDelayMs_);var r=8e3*a/t,n=t/1e3;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.prototype.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){return this.canEstimate()?s(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}(),Dt=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Ct=function(r){function n(e){z(this,n);var t=q(this,r.call(this,e,Ue.a.FRAG_LOADING,Ue.a.FRAG_LOADED,Ue.a.FRAG_BUFFERED,Ue.a.ERROR));return t.lastLoadedFragLevel=0,t._nextAutoLevel=-1,t.hls=e,t.timer=null,t._bwEstimator=null,t.onCheck=t._abandonRulesCheck.bind(t),t}return X(n,r),n.prototype.destroy=function(){this.clearTimer(),Ve.prototype.destroy.call(this)},n.prototype.onFragLoading=function(e){var t=e.frag;if('main'===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var a=this.hls,r=e.frag.level,n=a.levels[r].details.live,o=a.config,i,d;n?(i=o.abrEwmaFastLive,d=o.abrEwmaSlowLive):(i=o.abrEwmaFastVoD,d=o.abrEwmaSlowVoD),this._bwEstimator=new Lt(a,d,i,o.abrEwmaDefaultEstimate)}this.fragCurrent=t}},n.prototype._abandonRulesCheck=function(){var r=this.hls,n=r.media,o=this.fragCurrent,i=o.loader,d=r.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return We.b.warn('frag loader destroy or aborted, disarm abandonRules'),this.clearTimer(),void(this._nextAutoLevel=-1);var s=i.stats;if(n&&s&&(!n.paused&&0!==n.playbackRate||!n.readyState)&&o.autoLevel&&o.level){var l=performance.now()-s.trequest,u=a(n.playbackRate);if(l>500*o.duration/u){var p=r.levels,c=e(1,s.bw?s.bw/8:1e3*s.loaded/l),f=p[o.level],g=f.realBitrate?e(f.realBitrate,f.bitrate):f.bitrate,m=s.total?s.total:e(s.loaded,t(o.duration*g/8)),y=n.currentTime,h=(m-s.loaded)/c,b=(dt.bufferInfo(n,y,r.config.maxBufferHole).end-y)/u;if(b<2*o.duration/u&&h>b){var _,T;for(T=o.level-1;T>d;T--){var E=p[T].realBitrate?e(p[T].realBitrate,p[T].bitrate):p[T].bitrate;if(_=o.duration*E/(8*0.8*c),_<b)break}_<h&&(We.b.warn('loading too slow, abort fragment loading and switch to level '+T+':fragLoadedDelay['+T+']<fragLoadedDelay['+(o.level-1)+'];bufferStarvationDelay:'+_.toFixed(1)+'<'+h.toFixed(1)+':'+b.toFixed(1)),r.nextLoadLevel=T,this._bwEstimator.sample(l,s.loaded),i.abort(),this.clearTimer(),r.trigger(Ue.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:o,stats:s}))}}}},n.prototype.onFragLoaded=function(e){var a=e.frag;if('main'===a.type&&!isNaN(a.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=a.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[a.level],n=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,o=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={bytes:n,duration:o},r.realBitrate=t(8*n/o)}if(e.frag.bitrateTest){var i=e.stats;i.tparsed=i.tbuffered=i.tload,this.onFragBuffered(e)}}},n.prototype.onFragBuffered=function(e){var a=e.stats,r=e.frag;if(!0!==a.aborted&&1===r.loadCounter&&'main'===r.type&&!isNaN(r.sn)&&(!r.bitrateTest||a.tload===a.tbuffered)){var n=a.tparsed-a.trequest;We.b.log('latency/loading/parsing/append/kbps:'+t(a.tfirst-a.trequest)+'/'+t(a.tload-a.tfirst)+'/'+t(a.tparsed-a.tload)+'/'+t(a.tbuffered-a.tparsed)+'/'+t(8*a.loaded/(a.tbuffered-a.trequest))),this._bwEstimator.sample(n,a.loaded),a.bwEstimate=this._bwEstimator.getEstimate(),this.bitrateTestDelay=r.bitrateTest?n/1e3:0}},n.prototype.onError=function(e){switch(e.details){case Ge.a.FRAG_LOAD_ERROR:case Ge.a.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:}},n.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},n.prototype._findBestLevel=function(a,r,n,o,d,s,l,u,p){for(var c=d;c>=o;c--){var i=p[c],f=i.details,g=f?f.totalduration/f.fragments.length:r,m=!!f&&f.live,y=void 0;y=c<=a?l*n:u*n;var h=p[c].realBitrate?e(p[c].realBitrate,p[c].bitrate):p[c].bitrate,b=h*g/y;if(We.b.trace('level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: '+c+'/'+t(y)+'/'+h+'/'+g+'/'+s+'/'+b),y>h&&(!b||m&&!this.bitrateTestDelay||b<s))return c}return-1},Dt(n,[{key:'nextAutoLevel',get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(-1!==e&&(!t||!t.canEstimate()))return e;var a=this._nextABRAutoLevel;return-1!==e&&(a=s(e,a)),a},set:function(e){this._nextAutoLevel=e}},{key:'_nextABRAutoLevel',get:function(){var r=this.hls,n=r.maxAutoLevel,o=r.levels,i=r.config,d=r.minAutoLevel,l=r.media,u=this.lastLoadedFragLevel,p=this.fragCurrent?this.fragCurrent.duration:0,c=l?l.currentTime:0,f=l&&0!==l.playbackRate?a(l.playbackRate):1,g=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,m=(dt.bufferInfo(l,c,i.maxBufferHole).end-c)/f,y=this._findBestLevel(u,p,g,d,n,m,i.abrBandWidthFactor,i.abrBandWidthUpFactor,o);if(0<=y)return y;We.b.trace('rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering');var h=p?s(p,i.maxStarvationDelay):i.maxStarvationDelay,b=i.abrBandWidthFactor,_=i.abrBandWidthUpFactor;if(0==m){var T=this.bitrateTestDelay;if(T){var E=p?s(p,i.maxLoadingDelay):i.maxLoadingDelay;h=E-T,We.b.trace('bitrate test took '+t(1e3*T)+'ms, set first fragment max fetchDuration to '+t(1e3*h)+' ms'),b=_=1}}return y=this._findBestLevel(u,p,g,d,n,m+h,b,_,o),e(y,0)}}]),n}(Ve),kt=v(),It=function(t){function r(e){Q(this,r);var a=Z(this,t.call(this,e,Ue.a.MEDIA_ATTACHING,Ue.a.MEDIA_DETACHING,Ue.a.MANIFEST_PARSED,Ue.a.BUFFER_RESET,Ue.a.BUFFER_APPENDING,Ue.a.BUFFER_CODECS,Ue.a.BUFFER_EOS,Ue.a.BUFFER_FLUSHING,Ue.a.LEVEL_PTS_UPDATED,Ue.a.LEVEL_UPDATED));return a._msDuration=null,a._levelDuration=null,a._live=null,a._objectUrl=null,a.onsbue=a.onSBUpdateEnd.bind(a),a.onsbe=a.onSBUpdateError.bind(a),a.pendingTracks={},a.tracks={},a}return $(r,t),r.prototype.destroy=function(){Ve.prototype.destroy.call(this)},r.prototype.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if('audio'===t&&r&&'audio/mpeg'===r.container){var n=this.sourceBuffer.audio,o=a(n.timestampOffset-e.start);if(0.1<o){var i=n.updating;try{n.abort()}catch(e){i=!0,We.b.warn('can not abort audio buffer: '+e)}i?this.audioTimestampOffset=e.start:(We.b.warn('change mpeg audio timestamp offset from '+n.timestampOffset+' to '+e.start),n.timestampOffset=e.start)}}},r.prototype.onManifestParsed=function(e){var t=e.audio,a=e.video||e.levels.length&&e.audio,r=0;e.altAudio&&(t||a)&&(r=(t?1:0)+(a?1:0),We.b.log(r+' sourceBuffer(s) expected')),this.sourceBufferNb=r},r.prototype.onMediaAttaching=function(e){var t=this.media=e.media;if(t){var a=this.mediaSource=new kt;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),a.addEventListener('sourceopen',this.onmso),a.addEventListener('sourceended',this.onmse),a.addEventListener('sourceclose',this.onmsc),t.src=URL.createObjectURL(a),this._objectUrl=t.src}},r.prototype.onMediaDetaching=function(){We.b.log('media source detaching');var e=this.mediaSource;if(e){if('open'===e.readyState)try{e.endOfStream()}catch(e){We.b.warn('onMediaDetaching:'+e.message+' while calling endOfStream')}e.removeEventListener('sourceopen',this.onmso),e.removeEventListener('sourceended',this.onmse),e.removeEventListener('sourceclose',this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute('src'),this.media.load()):We.b.warn('media.src was changed by a third party - skip cleanup')),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(Ue.a.MEDIA_DETACHED)},r.prototype.onMediaSourceOpen=function(){We.b.log('media source opened'),this.hls.trigger(Ue.a.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener('sourceopen',this.onmso),this.checkPendingTracks()},r.prototype.checkPendingTracks=function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},r.prototype.onMediaSourceClose=function(){We.b.log('media source closed')},r.prototype.onMediaSourceEnded=function(){We.b.log('media source ended')},r.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;We.b.warn('change mpeg audio timestamp offset from '+e.timestampOffset+' to '+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,a=this.segments.reduce(function(e,a){return a.parent===t?e+1:e},0);this.hls.trigger(Ue.a.BUFFER_APPENDED,{parent:t,pending:a}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},r.prototype.onSBUpdateError=function(e){We.b.error('sourceBuffer error:',e),this.hls.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_APPENDING_ERROR,fatal:!1})},r.prototype.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var a=e[t];try{this.mediaSource.removeSourceBuffer(a),a.removeEventListener('updateend',this.onsbue),a.removeEventListener('error',this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},r.prototype.onBufferCodecs=function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var a=this.mediaSource;a&&'open'===a.readyState&&this.checkPendingTracks()}},r.prototype.createSourceBuffers=function(e){var t=this.sourceBuffer,a=this.mediaSource;for(var r in e)if(!t[r]){var n=e[r],o=n.levelCodec||n.codec,i=n.container+';codecs='+o;We.b.log('creating sourceBuffer('+i+')');try{var d=t[r]=a.addSourceBuffer(i);d.addEventListener('updateend',this.onsbue),d.addEventListener('error',this.onsbe),this.tracks[r]={codec:o,container:n.container},n.buffer=d}catch(e){We.b.error('error while trying to add sourceBuffer:'+e.message),this.hls.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:i})}}this.hls.trigger(Ue.a.BUFFER_CREATED,{tracks:e})},r.prototype.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},r.prototype.onBufferAppendFail=function(e){We.b.error('sourceBuffer error:',e.event),this.hls.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.BUFFER_APPENDING_ERROR,fatal:!1})},r.prototype.onBufferEos=function(e){var t=this.sourceBuffer,a=e.type;for(var r in t)(!a||r===a)&&(t[r].ended||(t[r].ended=!0,We.b.log(r+' sourceBuffer now EOS')));this.checkEos()},r.prototype.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||'open'!==t.readyState)return void(this._needsEos=!1);for(var a in e){var r=e[a];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}We.b.log('all media data available, signal endOfStream() to MediaSource and stop loading fragment');try{t.endOfStream()}catch(t){We.b.warn('exception while calling mediaSource.endOfStream()')}this._needsEos=!1},r.prototype.onBufferFlushing=function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()},r.prototype.onLevelUpdated=function(e){var t=e.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},r.prototype.updateMediaElementDuration=function(){var e=this.hls.config,t;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&'open'===this.mediaSource.readyState){for(var a in this.sourceBuffer)if(!0===this.sourceBuffer[a].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(We.b.log('Media Source duration is set to Infinity'),this._msDuration=this.mediaSource.duration=Infinity):(this._levelDuration>this._msDuration&&this._levelDuration>t||t===Infinity||isNaN(t))&&(We.b.log('Updating Media Source duration to '+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},r.prototype.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(this.flushBuffer(e.start,e.end,e.type))this.flushRange.shift(),this.flushBufferCounter=0;else return void(this._needsFlush=!0)}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,a=this.sourceBuffer;try{for(var r in a)t+=a[r].buffered.length}catch(e){We.b.error('error while accessing sourceBuffer.buffered')}this.appended=t,this.hls.trigger(Ue.a.BUFFER_FLUSHED)}},r.prototype.doAppending=function(){var e=this.hls,t=this.sourceBuffer,a=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void We.b.error('trying to append although a media error occured, flush segment and abort');if(this.appending)return;if(a&&a.length){var r=a.shift();try{var n=r.type,o=t[n];o?o.updating?a.unshift(r):(o.ended=!1,this.parent=r.parent,o.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){We.b.error('error while trying to append buffer:'+t.message),a.unshift(r);var i={type:Ge.b.MEDIA_ERROR,parent:r.parent};if(22!==t.code){if(this.appendError?this.appendError++:this.appendError=1,i.details=Ge.a.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry)return We.b.log('fail '+e.config.appendErrorMaxRetry+' times to append segment in sourceBuffer'),a=[],i.fatal=!0,void e.trigger(Ue.a.ERROR,i);i.fatal=!1,e.trigger(Ue.a.ERROR,i)}else return this.segments=[],i.details=Ge.a.BUFFER_FULL_ERROR,i.fatal=!1,void e.trigger(Ue.a.ERROR,i)}}}},r.prototype.flushBuffer=function(t,a,r){var n=this.sourceBuffer,o,d,i,l,u,p;if(Object.keys(n).length){if(We.b.log('flushBuffer,pos/start/end: '+this.media.currentTime.toFixed(3)+'/'+t+'/'+a),this.flushBufferCounter<this.appended){for(var c in n)if(!(r&&c!==r))if(o=n[c],o.ended=!1,!o.updating)try{for(d=0;d<o.buffered.length;d++)if(i=o.buffered.start(d),l=o.buffered.end(d),-1!==navigator.userAgent.toLowerCase().indexOf('firefox')&&a===Fe?(u=t,p=a):(u=e(i,t),p=s(l,a)),0.5<s(p,l)-u)return this.flushBufferCounter++,We.b.log('flush '+c+' ['+u+','+p+'], of ['+i+','+l+'], pos:'+this.media.currentTime),o.remove(u,p),!1}catch(t){We.b.warn('exception while accessing sourcebuffer, it might have been removed from MediaSource')}else return We.b.warn('cannot flush, sb updating in progress'),!1;}else We.b.warn('abort flushing too many retries');We.b.log('buffer flushed')}return!0},r}(Ve),Pt=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),wt=function(e){function t(a){return J(this,t),ee(this,e.call(this,a,Ue.a.FPS_DROP_LEVEL_CAPPING,Ue.a.MEDIA_ATTACHING,Ue.a.MANIFEST_PARSED))}return te(t,e),t.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Fe,this.timer&&(this.timer=clearInterval(this.timer)))},t.prototype.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},t.prototype.onMediaAttaching=function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null},t.prototype.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Fe,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.prototype.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.prototype.getMaxLevel=function(e){var a=this;if(!this.levels)return-1;var r=this.levels.filter(function(r,n){return t.isLevelAllowed(n,a.restrictedLevels)&&n<=e});return t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.isLevelAllowed=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return-1===t.indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,a){if(!e||e&&!e.length)return-1;for(var r=function(e,t){return!t||e.width!==t.width||e.height!==t.height},n=e.length-1,o=0,i;o<e.length;o+=1)if(i=e[o],(i.width>=t||i.height>=a)&&r(i,e[o+1])){n=o;break}return n},Pt(t,[{key:'mediaWidth',get:function(){var e=this.media,a;return e&&(a=e.width||e.clientWidth||e.offsetWidth,a*=t.contentScaleFactor),a}},{key:'mediaHeight',get:function(){var e=this.media,a;return e&&(a=e.height||e.clientHeight||e.offsetHeight,a*=t.contentScaleFactor),a}}],[{key:'contentScaleFactor',get:function(){var e=1;try{e=window.devicePixelRatio}catch(t){}return e}}]),t}(Ve),xt=function(e){function t(a){return ae(this,t),re(this,e.call(this,a,Ue.a.MEDIA_ATTACHING))}return ne(t,e),t.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},t.prototype.onMediaAttaching=function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var a=this.video=e.media instanceof HTMLVideoElement?e.media:null;'function'==typeof a.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}},t.prototype.checkFPS=function(e,t,a){var r=performance.now();if(t){if(this.lastTime){var n=r-this.lastTime,o=a-this.lastDroppedFrames,i=t-this.lastDecodedFrames,d=this.hls;if(d.trigger(Ue.a.FPS_DROP,{currentDropped:o,currentDecoded:i,totalDroppedFrames:a}),0<1e3*o/n&&o>d.config.fpsDroppedMonitoringThreshold*i){var s=d.currentLevel;We.b.warn('drop FPS ratio greater than max allowed value for currentLevel: '+s),0<s&&(-1===d.autoLevelCapping||d.autoLevelCapping>=s)&&(--s,d.trigger(Ue.a.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:d.currentLevel}),d.autoLevelCapping=s,d.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=a,this.lastDecodedFrames=t}},t.prototype.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},t}(Ve),Ot=function(){function t(e){oe(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(e,t,a){this.context=e,this.config=t,this.callbacks=a,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t=this.context,a;a=this.loader=new XMLHttpRequest;var e=this.stats;e.tfirst=0,e.loaded=0;var r=this.xhrSetup;try{if(r)try{r(a,t.url)}catch(n){a.open('GET',t.url,!0),r(a,t.url)}a.readyState||a.open('GET',t.url,!0)}catch(r){return void this.callbacks.onError({code:a.status,text:r.message},t,a)}t.rangeEnd&&a.setRequestHeader('Range','bytes='+t.rangeStart+'-'+(t.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},t.prototype.readystatechange=function(t){var a=t.currentTarget,r=a.readyState,n=this.stats,o=this.context,i=this.config;if(!n.aborted&&2<=r)if(window.clearTimeout(this.requestTimeout),0===n.tfirst&&(n.tfirst=e(performance.now(),n.trequest)),4===r){var d=a.status;if(200<=d&&300>d){n.tload=e(n.tfirst,performance.now());var l,u;'arraybuffer'===o.responseType?(l=a.response,u=l.byteLength):(l=a.responseText,u=l.length),n.loaded=n.total=u;var p={url:a.responseURL,data:l};this.callbacks.onSuccess(p,n,o,a)}else n.retry>=i.maxRetry||400<=d&&499>d?(We.b.error(d+' while loading '+o.url),this.callbacks.onError({code:d,text:a.statusText},o,a)):(We.b.warn(d+' while loading '+o.url+', retrying in '+this.retryDelay+'...'),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=s(2*this.retryDelay,i.maxRetryDelay),n.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),i.timeout)},t.prototype.loadtimeout=function(){We.b.warn('timeout while loading '+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(e){var t=e.currentTarget,a=this.stats;a.loaded=e.loaded,e.lengthComputable&&(a.total=e.total);var r=this.callbacks.onProgress;r&&r(a,this.context,null,t)},t}(),Ft=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Nt=function(e){function t(a){ie(this,t);var r=de(this,e.call(this,a,Ue.a.MANIFEST_LOADING,Ue.a.MANIFEST_PARSED,Ue.a.AUDIO_TRACK_LOADED,Ue.a.ERROR));return r.ticks=0,r.ontick=r.tick.bind(r),r}return se(t,e),t.prototype.destroy=function(){this.cleanTimer(),Ve.prototype.destroy.call(this)},t.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},t.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},t.prototype.doTick=function(){this.updateTrack(this.trackId)},t.prototype.onError=function(e){e.fatal&&e.type===Ge.b.NETWORK_ERROR&&this.cleanTimer()},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestParsed=function(e){var t=this,a=e.audioTracks||[],r=!1;this.tracks=a,this.hls.trigger(Ue.a.AUDIO_TRACKS_UPDATED,{audioTracks:a});var n=0;a.forEach(function(e){return e.default&&!r?(t.audioTrack=n,void(r=!0)):void n++}),!1==r&&a.length&&(We.b.log('no default audio track defined, use first audio track as default'),this.audioTrack=0)},t.prototype.onAudioTrackLoaded=function(e){e.id<this.tracks.length&&(We.b.log('audioTrack '+e.id+' loaded'),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&this.cleanTimer())},t.prototype.setAudioTrackInternal=function(e){if(0<=e&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,We.b.log('switching to audioTrack '+e);var t=this.tracks[e],a=this.hls,r=t.type,n=t.url,o={id:e,type:r,url:n};a.trigger(Ue.a.AUDIO_TRACK_SWITCH,o),a.trigger(Ue.a.AUDIO_TRACK_SWITCHING,o);var i=t.details;n&&(void 0===i||!0===i.live)&&(We.b.log('(re)loading playlist for audioTrack '+e),a.trigger(Ue.a.AUDIO_TRACK_LOADING,{url:n,id:e}))}},t.prototype.updateTrack=function(e){if(0<=e&&e<this.tracks.length){this.cleanTimer(),this.trackId=e,We.b.log('updating audioTrack '+e);var t=this.tracks[e],a=t.url,r=t.details;a&&(void 0===r||!0===r.live)&&(We.b.log('(re)loading playlist for audioTrack '+e),this.hls.trigger(Ue.a.AUDIO_TRACK_LOADING,{url:a,id:e}))}},Ft(t,[{key:'audioTracks',get:function(){return this.tracks}},{key:'audioTrack',get:function(){return this.trackId},set:function(e){(this.trackId!==e||void 0===this.tracks[e].details)&&this.setAudioTrackInternal(e)}}]),t}(Ve),Bt=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Mt={STOPPED:'STOPPED',STARTING:'STARTING',IDLE:'IDLE',PAUSED:'PAUSED',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_TRACK:'WAITING_TRACK',PARSING:'PARSING',PARSED:'PARSED',BUFFER_FLUSHING:'BUFFER_FLUSHING',ENDED:'ENDED',ERROR:'ERROR',WAITING_INIT_PTS:'WAITING_INIT_PTS'},Ut=function(t){function r(e){le(this,r);var a=ue(this,t.call(this,e,Ue.a.MEDIA_ATTACHED,Ue.a.MEDIA_DETACHING,Ue.a.AUDIO_TRACKS_UPDATED,Ue.a.AUDIO_TRACK_SWITCHING,Ue.a.AUDIO_TRACK_LOADED,Ue.a.KEY_LOADED,Ue.a.FRAG_LOADED,Ue.a.FRAG_PARSING_INIT_SEGMENT,Ue.a.FRAG_PARSING_DATA,Ue.a.FRAG_PARSED,Ue.a.ERROR,Ue.a.BUFFER_RESET,Ue.a.BUFFER_CREATED,Ue.a.BUFFER_APPENDED,Ue.a.BUFFER_FLUSHED,Ue.a.INIT_PTS_FOUND));return a.config=e.config,a.audioCodecSwap=!1,a.ticks=0,a._state=Mt.STOPPED,a.ontick=a.tick.bind(a),a.initPTS=[],a.waitingFragment=null,a.videoTrackCC=null,a}return pe(r,t),r.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Ve.prototype.destroy.call(this),this.state=Mt.STOPPED},r.prototype.onInitPtsFound=function(e){var t=e.id,a=e.frag.cc,r=e.initPTS;'main'===t&&(this.initPTS[a]=r,this.videoTrackCC=a,We.b.log('InitPTS for cc:'+a+' found from video track:'+r),this.state===Mt.WAITING_INIT_PTS&&this.tick())},r.prototype.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,0<t&&-1===e?(We.b.log('audio:override startPosition with lastCurrentTime @'+t.toFixed(3)),this.state=Mt.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=Mt.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=Mt.STOPPED},r.prototype.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Mt.STOPPED},r.prototype.tick=function(){this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},r.prototype.doTick=function(){var t=this.hls,r=t.config,n,o,i;switch(this.state){case Mt.ERROR:case Mt.PAUSED:case Mt.BUFFER_FLUSHING:break;case Mt.STARTING:this.state=Mt.WAITING_TRACK,this.loadedmetadata=!1;break;case Mt.IDLE:var d=this.tracks;if(!d)break;if(!this.media&&(this.startFragRequested||!r.startFragPrefetch))break;if(this.loadedmetadata)n=this.media.currentTime;else if(n=this.nextLoadPosition,void 0===n)break;var l=this.mediaBuffer?this.mediaBuffer:this.media,u=this.videoBuffer?this.videoBuffer:this.media,p=dt.bufferInfo(l,n,r.maxBufferHole),c=dt.bufferInfo(u,n,r.maxBufferHole),f=p.len,g=p.end,m=this.fragPrevious,y=e(r.maxBufferLength,c.len),h=this.audioSwitch,b=this.trackId;if((f<y||h)&&b<d.length){if(i=d[b].details,'undefined'==typeof i){this.state=Mt.WAITING_TRACK;break}if(!h&&!i.live&&m&&m.sn===i.endSN&&!p.nextStart&&(!this.media.seeking||this.media.duration-g<m.duration/2)){this.hls.trigger(Ue.a.BUFFER_EOS,{type:'audio'}),this.state=Mt.ENDED;break}var _=i.fragments,T=_.length,E=_[0].start,R=_[T-1].start+_[T-1].duration,S;if(h)if(i.live&&!i.PTSKnown)We.b.log('switching audiotrack, live stream, unknown PTS,load first fragment'),g=0;else if(g=n,i.PTSKnown&&n<E)if(p.end>E||p.nextStart)We.b.log('alt audio track ahead of main track, seek to start of alt audio track'),this.media.currentTime=E+0.05;else return;if(i.initSegment&&!i.initSegment.data)S=i.initSegment;else if(!(g<=E)){var v=r.maxFragLookUpTolerance,A=m?_[m.sn-_[0].sn+1]:void 0,L=function(e){var t=s(v,e.duration);return e.start+e.duration-t<=g?1:e.start-t>g&&e.start?-1:0},D;g<R?(g>R-v&&(v=0),D=A&&!L(A)?A:it.search(_,L)):D=_[T-1],D&&(S=D,E=D.start,m&&S.level===m.level&&S.sn===m.sn&&(S.sn<i.endSN?(S=_[S.sn+1-i.startSN],We.b.log('SN just loaded, load next one: '+S.sn)):S=null))}else if(S=_[0],null!==this.videoTrackCC&&S.cc!==this.videoTrackCC&&(S=I(_,this.videoTrackCC)),i.live&&S.loadIdx&&S.loadIdx===this.fragLoadIdx){var C=p.nextStart?p.nextStart:E;return We.b.log('no alt audio available @currentTime:'+this.media.currentTime+', seeking @'+(C+0.05)),void(this.media.currentTime=C+0.05)}if(S)if(S.decryptdata&&null!=S.decryptdata.uri&&null==S.decryptdata.key)We.b.log('Loading key for '+S.sn+' of ['+i.startSN+' ,'+i.endSN+'],track '+b),this.state=Mt.KEY_LOADING,t.trigger(Ue.a.KEY_LOADING,{frag:S});else{if(We.b.log('Loading '+S.sn+', cc: '+S.cc+' of ['+i.startSN+' ,'+i.endSN+'],track '+b+', currentTime:'+n+',bufferEnd:'+g.toFixed(3)),void 0===this.fragLoadIdx?this.fragLoadIdx=0:this.fragLoadIdx++,S.loadCounter){S.loadCounter++;var k=r.fragLoadingLoopThreshold;if(S.loadCounter>k&&a(this.fragLoadIdx-S.loadIdx)<k)return void t.trigger(Ue.a.ERROR,{type:Ge.b.MEDIA_ERROR,details:Ge.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:S})}else S.loadCounter=1;S.loadIdx=this.fragLoadIdx,this.fragCurrent=S,this.startFragRequested=!0,isNaN(S.sn)||(this.nextLoadPosition=S.start+S.duration),t.trigger(Ue.a.FRAG_LOADING,{frag:S}),this.state=Mt.FRAG_LOADING}}break;case Mt.WAITING_TRACK:o=this.tracks[this.trackId],o&&o.details&&(this.state=Mt.IDLE);break;case Mt.FRAG_LOADING_WAITING_RETRY:var P=performance.now(),w=this.retryDate;l=this.media;var x=l&&l.seeking;(!w||P>=w||x)&&(We.b.log('audioStreamController: retryDate reached, switch back to IDLE state'),this.state=Mt.IDLE);break;case Mt.WAITING_INIT_PTS:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var F=this.waitingFragment;if(F){var N=F.frag.cc;O===N?(this.state=Mt.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null):(o=this.tracks[this.trackId],o.details&&o.details.live&&(We.b.warn('Waiting fragment CC ('+N+') does not match video track CC ('+O+')'),this.waitingFragment=null,this.state=Mt.IDLE))}else this.state=Mt.IDLE;break;case Mt.STOPPED:case Mt.FRAG_LOADING:case Mt.PARSING:case Mt.PARSED:case Mt.ENDED:break;default:}},r.prototype.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener('seeking',this.onvseeking),t.addEventListener('ended',this.onvended);var a=this.config;this.tracks&&a.autoStartLoad&&this.startLoad(a.startPosition)},r.prototype.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(We.b.log('MSE detaching and video ended, reset startPosition'),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener('seeking',this.onvseeking),e.removeEventListener('ended',this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},r.prototype.onMediaSeeking=function(){this.state===Mt.ENDED&&(this.state=Mt.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},r.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.prototype.onAudioTracksUpdated=function(e){We.b.log('audio tracks updated'),this.tracks=e.audioTracks},r.prototype.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.state=Mt.PAUSED,this.waitingFragment=null,t?!this.timer&&(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=Mt.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},r.prototype.onAudioTrackLoaded=function(e){var t=e.details,a=e.id,r=this.tracks[a],n=t.totalduration,o=0;if(We.b.log('track '+a+' loaded ['+t.startSN+','+t.endSN+'],duration:'+n),t.live){var i=r.details;i&&0<t.fragments.length?(C(i,t),o=t.fragments[0].start,t.PTSKnown?We.b.log('live audio playlist sliding:'+o.toFixed(3)):We.b.log('live audio playlist - outdated PTS, unknown sliding')):(t.PTSKnown=!1,We.b.log('live audio playlist - first load, unknown sliding'))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var d=t.startTimeOffset;isNaN(d)?this.startPosition=0:(We.b.log('start time offset found in playlist, adjust startPosition to '+d),this.startPosition=d)}this.nextLoadPosition=this.startPosition}this.state===Mt.WAITING_TRACK&&(this.state=Mt.IDLE),this.tick()},r.prototype.onKeyLoaded=function(){this.state===Mt.KEY_LOADING&&(this.state=Mt.IDLE,this.tick())},r.prototype.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag;if(this.state===Mt.FRAG_LOADING&&t&&'audio'===a.type&&a.level===t.level&&a.sn===t.sn){var r=this.tracks[this.trackId],n=r.details,o=n.totalduration,i=t.level,d=t.sn,s=t.cc,l=this.config.defaultAudioCodec||r.audioCodec||'mp4a.40.2',u=this.stats=e.stats;if('initSegment'===d)this.state=Mt.IDLE,u.tparsed=u.tbuffered=performance.now(),n.initSegment.data=e.payload,this.hls.trigger(Ue.a.FRAG_BUFFERED,{stats:u,frag:t,id:'audio'}),this.tick();else{this.state=Mt.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new mt(this.hls,'audio'));var p=this.initPTS[s],c=n.initSegment?n.initSegment.data:[];if(n.initSegment||void 0!==p){this.pendingBuffering=!0,We.b.log('Demuxing '+d+' of ['+n.startSN+' ,'+n.endSN+'],track '+i);this.demuxer.push(e.payload,c,l,null,t,o,!1,p)}else We.b.log('unknown video PTS for continuity counter '+s+', waiting for video PTS before demuxing audio frag '+d+' of ['+n.startSN+' ,'+n.endSN+'],track '+i),this.waitingFragment=e,this.state=Mt.WAITING_INIT_PTS}}this.fragLoadError=0},r.prototype.onFragParsingInitSegment=function(e){var t=this.fragCurrent,a=e.frag;if(t&&'audio'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===Mt.PARSING){var r=e.tracks,n;if(r.video&&delete r.video,n=r.audio,n){n.levelCodec=n.codec,n.id=e.id,this.hls.trigger(Ue.a.BUFFER_CODECS,r),We.b.log('audio track:audio,container:'+n.container+',codecs[level/parsed]=['+n.levelCodec+'/'+n.codec+']');var o=n.initSegment;if(o){var i={type:'audio',data:o,parent:'audio',content:'initSegment'};this.audioSwitch?this.pendingData=[i]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ue.a.BUFFER_APPENDING,i))}this.tick()}}},r.prototype.onFragParsingData=function(e){var t=this,a=this.fragCurrent,r=e.frag;if(a&&'audio'===e.id&&'audio'===e.type&&r.sn===a.sn&&r.level===a.level&&this.state===Mt.PARSING){var n=this.trackId,o=this.tracks[n],i=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+a.duration,e.endDTS=e.startDTS+a.duration),We.b.log('parsed '+e.type+',PTS:['+e.startPTS.toFixed(3)+','+e.endPTS.toFixed(3)+'],DTS:['+e.startDTS.toFixed(3)+'/'+e.endDTS.toFixed(3)+'],nb:'+e.nb),D(o.details,a,e.startPTS,e.endPTS);var d=this.audioSwitch,s=this.media,l=!1;if(d&&s)if(s.readyState){var u=s.currentTime;We.b.log('switching audio track : currentTime:'+u),u>=e.startPTS&&(We.b.log('switching audio track : flushing all audio'),this.state=Mt.BUFFER_FLUSHING,i.trigger(Ue.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Fe,type:'audio'}),l=!0,this.audioSwitch=!1,i.trigger(Ue.a.AUDIO_TRACK_SWITCHED,{id:n}))}else this.audioSwitch=!1,i.trigger(Ue.a.AUDIO_TRACK_SWITCHED,{id:n});var p=this.pendingData;this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&p.push({type:e.type,data:t,parent:'audio',content:'data'})}),!l&&p.length&&(p.forEach(function(e){t.state===Mt.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(Ue.a.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}},r.prototype.onFragParsed=function(e){var t=this.fragCurrent,a=e.frag;t&&'audio'===e.id&&a.sn===t.sn&&a.level===t.level&&this.state===Mt.PARSING&&(this.stats.tparsed=performance.now(),this.state=Mt.PARSED,this._checkAppendedParsed())},r.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.prototype.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},r.prototype.onBufferAppended=function(e){if('audio'===e.parent){var t=this.state;(t===Mt.PARSING||t===Mt.PARSED)&&(this.pendingBuffering=0<e.pending,this._checkAppendedParsed())}},r.prototype._checkAppendedParsed=function(){if(this.state===Mt.PARSED&&(!this.appended||!this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,a=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),a.trigger(Ue.a.FRAG_BUFFERED,{stats:t,frag:e,id:'audio'});var r=this.mediaBuffer?this.mediaBuffer:this.media;We.b.log('audio buffered : '+yt.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,a.trigger(Ue.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Mt.IDLE}this.tick()}},r.prototype.onError=function(e){var t=e.frag;if(!(t&&'audio'!==t.type))switch(e.details){case Ge.a.FRAG_LOAD_ERROR:case Ge.a.FRAG_LOAD_TIMEOUT:if(!e.fatal){var a=this.fragLoadError;a?a++:a=1;var r=this.config;if(a<=r.fragLoadingMaxRetry){this.fragLoadError=a,t.loadCounter=0;var o=s(n(2,a-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);We.b.warn('audioStreamController: frag loading failed, retry in '+o+' ms'),this.retryDate=performance.now()+o,this.state=Mt.FRAG_LOADING_WAITING_RETRY}else We.b.error('audioStreamController: '+e.details+' reaches max retry, redispatch as fatal ...'),e.fatal=!0,this.state=Mt.ERROR}break;case Ge.a.FRAG_LOOP_LOADING_ERROR:case Ge.a.AUDIO_TRACK_LOAD_ERROR:case Ge.a.AUDIO_TRACK_LOAD_TIMEOUT:case Ge.a.KEY_LOAD_ERROR:case Ge.a.KEY_LOAD_TIMEOUT:this.state!==Mt.ERROR&&(this.state=e.fatal?Mt.ERROR:Mt.IDLE,We.b.warn('audioStreamController: '+e.details+' while loading frag,switch to '+this.state+' state ...'));break;case Ge.a.BUFFER_FULL_ERROR:if('audio'===e.parent&&(this.state===Mt.PARSING||this.state===Mt.PARSED)){var i=this.mediaBuffer,d=this.media.currentTime,l=i&&dt.isBuffered(i,d)&&dt.isBuffered(i,d+0.5);if(l){var u=this.config;u.maxMaxBufferLength>=u.maxBufferLength&&(u.maxMaxBufferLength/=2,We.b.warn('audio:reduce max buffer length to '+u.maxMaxBufferLength+'s'),this.fragLoadIdx+=2*u.fragLoadingLoopThreshold),this.state=Mt.IDLE}else We.b.warn('buffer full error also media.currentTime is not buffered, flush audio buffer'),this.fragCurrent=null,this.state=Mt.BUFFER_FLUSHING,this.hls.trigger(Ue.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Fe,type:'audio'})}break;default:}},r.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(We.b.log('appending pending audio data on Buffer Flushed'),t.forEach(function(t){e.hls.trigger(Ue.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=Mt.PARSED):(this.state=Mt.IDLE,this.fragPrevious=null,this.tick())},Bt(r,[{key:'state',set:function(e){if(this.state!==e){var t=this.state;this._state=e,We.b.log('audio stream:'+t+'->'+e)}},get:function(){return this._state}}]),r}(Ve),Gt=function(){function e(e){if('string'!=typeof e)return!1;var t=o[e.toLowerCase()];return!!t&&e.toLowerCase()}function t(e){if('string'!=typeof e)return!1;var t=i[e.toLowerCase()];return!!t&&e.toLowerCase()}function a(e){for(var t=1,a;t<arguments.length;t++)for(var r in a=arguments[t],a)e[r]=a[r];return e}function r(r,o,i){var d=this,s=function(){return'undefined'==typeof navigator?void 0:/MSIE\s8\.0/.test(navigator.userAgent)}(),l={};s?d=document.createElement('custom'):l.enumerable=!0,d.hasBeenReset=!1;var u='',p=!1,c=r,f=o,g=i,m=null,y='',h=!0,b='auto',_='start',T=50,E='middle',R=50,S='middle';if(Object.defineProperty(d,'id',a({},l,{get:function(){return u},set:function(e){u=''+e}})),Object.defineProperty(d,'pauseOnExit',a({},l,{get:function(){return p},set:function(e){p=!!e}})),Object.defineProperty(d,'startTime',a({},l,{get:function(){return c},set:function(e){if('number'!=typeof e)throw new TypeError('Start time must be set to a number.');c=e,this.hasBeenReset=!0}})),Object.defineProperty(d,'endTime',a({},l,{get:function(){return f},set:function(e){if('number'!=typeof e)throw new TypeError('End time must be set to a number.');f=e,this.hasBeenReset=!0}})),Object.defineProperty(d,'text',a({},l,{get:function(){return g},set:function(e){g=''+e,this.hasBeenReset=!0}})),Object.defineProperty(d,'region',a({},l,{get:function(){return m},set:function(e){m=e,this.hasBeenReset=!0}})),Object.defineProperty(d,'vertical',a({},l,{get:function(){return y},set:function(t){var a=e(t);if(!1===a)throw new SyntaxError('An invalid or illegal string was specified.');y=a,this.hasBeenReset=!0}})),Object.defineProperty(d,'snapToLines',a({},l,{get:function(){return h},set:function(e){h=!!e,this.hasBeenReset=!0}})),Object.defineProperty(d,'line',a({},l,{get:function(){return b},set:function(e){if('number'!=typeof e&&e!==n)throw new SyntaxError('An invalid number or illegal string was specified.');b=e,this.hasBeenReset=!0}})),Object.defineProperty(d,'lineAlign',a({},l,{get:function(){return _},set:function(e){var a=t(e);if(!a)throw new SyntaxError('An invalid or illegal string was specified.');_=a,this.hasBeenReset=!0}})),Object.defineProperty(d,'position',a({},l,{get:function(){return T},set:function(e){if(0>e||100<e)throw new Error('Position must be between 0 and 100.');T=e,this.hasBeenReset=!0}})),Object.defineProperty(d,'positionAlign',a({},l,{get:function(){return E},set:function(e){var a=t(e);if(!a)throw new SyntaxError('An invalid or illegal string was specified.');E=a,this.hasBeenReset=!0}})),Object.defineProperty(d,'size',a({},l,{get:function(){return R},set:function(e){if(0>e||100<e)throw new Error('Size must be between 0 and 100.');R=e,this.hasBeenReset=!0}})),Object.defineProperty(d,'align',a({},l,{get:function(){return S},set:function(e){var a=t(e);if(!a)throw new SyntaxError('An invalid or illegal string was specified.');S=a,this.hasBeenReset=!0}})),d.displayState=void 0,s)return d}if('undefined'!=typeof window&&window.VTTCue)return window.VTTCue;var n='auto',o={"":!0,lr:!0,rl:!0},i={start:!0,middle:!0,end:!0,left:!0,right:!0};return r.prototype.getCueAsHTML=function(){var e=window.WebVTT;return e.convertCueToDOMTree(window,this.text)},r}(),Wt=function(){return{decode:function(e){if(!e)return'';if('string'!=typeof e)throw new Error('Error - expected string data.');return decodeURIComponent(encodeURIComponent(e))}}};ge.prototype={set:function(e,t){this.get(e)||''===t||(this.values[e]=t)},get:function(e,t,a){return a?this.has(e)?this.values[e]:t[a]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var a=0;a<r.length;++a)if(t===r[a]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){var a;return(a=t.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(t=parseFloat(t),0<=t&&100>=t)&&(this.set(e,t),!0)}};var Kt=new Gt(0,0,0),Ht='middle'===Kt.align?'middle':'center';ce.prototype={parse:function(e){function t(){var e=r.buffer,t=0;for(e=he(e);t<e.length&&'\r'!==e[t]&&'\n'!==e[t];)++t;var a=e.substr(0,t);return'\r'===e[t]&&++t,'\n'===e[t]&&++t,r.buffer=e.substr(t),a}function a(e){me(e,function(e,t){'Region'===e?console.log('parse region',t):void 0},/:/)}var r=this;e&&(r.buffer+=r.decoder.decode(e,{stream:!0}));try{var n;if('INITIAL'===r.state){if(!/\r\n|\n/.test(r.buffer))return this;n=t();var o=n.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error('Malformed WebVTT signature.');r.state='HEADER'}for(var i=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(i?i=!1:n=t(),r.state){case'HEADER':/:/.test(n)?a(n):!n&&(r.state='ID');continue;case'NOTE':n||(r.state='ID');continue;case'ID':if(/^NOTE($|[ \t])/.test(n)){r.state='NOTE';break}if(!n)continue;if(r.cue=new Gt(0,0,''),r.state='CUE',-1===n.indexOf('-->')){r.cue.id=n;continue}case'CUE':try{ye(n,r.cue,r.regionList)}catch(t){r.cue=null,r.state='BADCUE';continue}r.state='CUETEXT';continue;case'CUETEXT':var d=-1!==n.indexOf('-->');if(!n||d&&(i=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state='ID';continue}r.cue.text&&(r.cue.text+='\n'),r.cue.text+=n;continue;case'BADCUE':n||(r.state='ID');continue;}}}catch(t){'CUETEXT'===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state='INITIAL'===r.state?'BADWEBVTT':'BADCUE'}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||'HEADER'===e.state)&&(e.buffer+='\n\n',e.parse()),'INITIAL'===e.state)throw new Error('Malformed WebVTT signature.')}catch(t){throw t}return e.onflush&&e.onflush(),this}};var Vt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},jt=function(e){var t=e;return Vt.hasOwnProperty(e)&&(t=Vt[e]),d(t)},Yt=15,zt=100,qt={16:11,17:1,18:3,19:12,20:14,21:5,22:7,23:9},Xt={17:2,18:4,19:13,20:15,21:6,22:8,23:10},Qt={24:11,25:1,26:3,27:12,28:14,29:5,30:7,31:9},Zt={25:2,26:4,27:13,28:15,29:6,30:8,31:10},$t=['white','green','blue','cyan','red','yellow','magenta','black','transparent'],Jt={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var a=this.verboseFilter[e];this.verboseLevel>=a&&console.log(this.time+' ['+e+'] '+t)}},ea=function(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].toString(16));return t},ta=function(){function e(t,a,r,n,o){_e(this,e),this.foreground=t||'white',this.underline=a||!1,this.italics=r||!1,this.background=n||'black',this.flash=o||!1}return e.prototype.reset=function(){this.foreground='white',this.underline=!1,this.italics=!1,this.background='black',this.flash=!1},e.prototype.setStyles=function(e){for(var t=['foreground','underline','italics','background','flash'],a=0,r;a<t.length;a++)r=t[a],e.hasOwnProperty(r)&&(this[r]=e[r])},e.prototype.isDefault=function(){return'white'===this.foreground&&!this.underline&&!this.italics&&'black'===this.background&&!this.flash},e.prototype.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},e.prototype.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},e.prototype.toString=function(){return'color='+this.foreground+', underline='+this.underline+', italics='+this.italics+', background='+this.background+', flash='+this.flash},e}(),aa=function(){function e(t,a,r,n,o,i){_e(this,e),this.uchar=t||' ',this.penState=new ta(a,r,n,o,i)}return e.prototype.reset=function(){this.uchar=' ',this.penState.reset()},e.prototype.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},e.prototype.setPenState=function(e){this.penState.copy(e)},e.prototype.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},e.prototype.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},e.prototype.isEmpty=function(){return' '===this.uchar&&this.penState.isDefault()},e}(),ra=function(){function e(){_e(this,e),this.chars=[];for(var t=0;t<zt;t++)this.chars.push(new aa);this.pos=0,this.currPenState=new ta}return e.prototype.equals=function(e){for(var t=!0,a=0;a<zt;a++)if(!this.chars[a].equals(e.chars[a])){t=!1;break}return t},e.prototype.copy=function(e){for(var t=0;t<zt;t++)this.chars[t].copy(e.chars[t])},e.prototype.isEmpty=function(){for(var e=!0,t=0;t<zt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},e.prototype.setCursor=function(e){this.pos!==e&&(this.pos=e),0>this.pos?(Jt.log('ERROR','Negative cursor position '+this.pos),this.pos=0):this.pos>zt&&(Jt.log('ERROR','Too large cursor position '+this.pos),this.pos=zt)},e.prototype.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var a=this.pos+1;a<t+1;a++)this.chars[a].setPenState(this.currPenState);this.setCursor(t)},e.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(' ',this.currPenState)},e.prototype.insertChar=function(e){144<=e&&this.backSpace();var t=jt(e);return this.pos>=zt?void Jt.log('ERROR','Cannot insert '+e.toString(16)+' ('+t+') at position '+this.pos+'. Skipping it!'):void(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},e.prototype.clearFromPos=function(e){var t;for(t=e;t<zt;t++)this.chars[t].reset()},e.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.prototype.getTextString=function(){for(var e=[],t=!0,a=0,r;a<zt;a++)r=this.chars[a].uchar,' '!==r&&(t=!1),e.push(r);return t?'':e.join('')},e.prototype.setPenStyles=function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)},e}(),na=function(){function t(){_e(this,t),this.rows=[];for(var e=0;e<Yt;e++)this.rows.push(new ra);this.currRow=Yt-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var e=0;e<Yt;e++)this.rows[e].clear();this.currRow=Yt-1},t.prototype.equals=function(e){for(var t=!0,a=0;a<Yt;a++)if(!this.rows[a].equals(e.rows[a])){t=!1;break}return t},t.prototype.copy=function(e){for(var t=0;t<Yt;t++)this.rows[t].copy(e.rows[t])},t.prototype.isEmpty=function(){for(var e=!0,t=0;t<Yt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.prototype.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},t.prototype.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},t.prototype.insertChar=function(e){var t=this.rows[this.currRow];t.insertChar(e)},t.prototype.setPen=function(e){var t=this.rows[this.currRow];t.setPenStyles(e)},t.prototype.moveCursor=function(e){var t=this.rows[this.currRow];t.moveCursor(e)},t.prototype.setCursor=function(e){Jt.log('INFO','setCursor: '+e);var t=this.rows[this.currRow];t.setCursor(e)},t.prototype.setPAC=function(t){Jt.log('INFO','pacData = '+JSON.stringify(t));var a=t.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(var r=0;r<Yt;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){var i=o.rows[n].cueStartTime;if(i&&i<Jt.time)for(var d=0;d<this.nrRollUpRows;d++)this.rows[a-this.nrRollUpRows+d+1].copy(o.rows[n+d])}}this.currRow=a;var s=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,u=e(l-1,0);s.setCursor(t.indent),t.color=s.chars[u].penState.foreground}var p={foreground:t.color,underline:t.underline,italics:t.italics,background:'black',flash:!1};this.setPen(p)},t.prototype.setBkgData=function(e){Jt.log('INFO','bkgData = '+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.prototype.setRollUpRows=function(e){this.nrRollUpRows=e},t.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void Jt.log('DEBUG','roll_up but nrRollUpRows not set yet');Jt.log('TEXT',this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),Jt.log('INFO','Rolling up')},t.prototype.getDisplayText=function(e){e=e||!1;for(var t=[],a='',r=-1,n=0,o;n<Yt;n++)o=this.rows[n].getTextString(),o&&(r=n+1,e?t.push('Row '+r+': \''+o+'\''):t.push(o.trim()));return 0<t.length&&(e?a='['+t.join(' | ')+']':a=t.join('\n')),a},t.prototype.getTextAndFormat=function(){return this.rows},t}(),oa=function(){function e(t,a){_e(this,e),this.chNr=t,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new na,this.nonDisplayedMemory=new na,this.lastOutputScreen=new na,this.currRollUpRow=this.displayedMemory.rows[Yt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[Yt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},e.prototype.getHandler=function(){return this.outputFilter},e.prototype.setHandler=function(e){this.outputFilter=e},e.prototype.setPAC=function(e){this.writeScreen.setPAC(e)},e.prototype.setBkgData=function(e){this.writeScreen.setBkgData(e)},e.prototype.setMode=function(e){e===this.mode||(this.mode=e,Jt.log('INFO','MODE='+e),'MODE_POP-ON'===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),'MODE_ROLL-UP'!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},e.prototype.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var a=this.writeScreen===this.displayedMemory?'DISP':'NON_DISP';Jt.log('INFO',a+': '+this.writeScreen.getDisplayText(!0)),('MODE_PAINT-ON'===this.mode||'MODE_ROLL-UP'===this.mode)&&(Jt.log('TEXT','DISPLAYED: '+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.prototype.ccRCL=function(){Jt.log('INFO','RCL - Resume Caption Loading'),this.setMode('MODE_POP-ON')},e.prototype.ccBS=function(){Jt.log('INFO','BS - BackSpace'),'MODE_TEXT'===this.mode||(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.prototype.ccAOF=function(){},e.prototype.ccAON=function(){},e.prototype.ccDER=function(){Jt.log('INFO','DER- Delete to End of Row'),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.prototype.ccRU=function(e){Jt.log('INFO','RU('+e+') - Roll Up'),this.writeScreen=this.displayedMemory,this.setMode('MODE_ROLL-UP'),this.writeScreen.setRollUpRows(e)},e.prototype.ccFON=function(){Jt.log('INFO','FON - Flash On'),this.writeScreen.setPen({flash:!0})},e.prototype.ccRDC=function(){Jt.log('INFO','RDC - Resume Direct Captioning'),this.setMode('MODE_PAINT-ON')},e.prototype.ccTR=function(){Jt.log('INFO','TR'),this.setMode('MODE_TEXT')},e.prototype.ccRTD=function(){Jt.log('INFO','RTD'),this.setMode('MODE_TEXT')},e.prototype.ccEDM=function(){Jt.log('INFO','EDM - Erase Displayed Memory'),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.prototype.ccCR=function(){Jt.log('CR - Carriage Return'),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.prototype.ccENM=function(){Jt.log('INFO','ENM - Erase Non-displayed Memory'),this.nonDisplayedMemory.reset()},e.prototype.ccEOC=function(){if(Jt.log('INFO','EOC - End Of Caption'),'MODE_POP-ON'===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,Jt.log('TEXT','DISP: '+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.prototype.ccTO=function(e){Jt.log('INFO','TO('+e+') - Tab Offset'),this.writeScreen.moveCursor(e)},e.prototype.ccMIDROW=function(e){var t={flash:!1,underline:1==e%2,italics:46<=e};if(!t.italics){var a=o(e/2)-16;t.foreground=['white','green','blue','cyan','red','yellow','magenta'][a]}else t.foreground='white';Jt.log('INFO','MIDROW: '+JSON.stringify(t)),this.writeScreen.setPen(t)},e.prototype.outputDataUpdate=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],a=Jt.time;null===a||this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?!this.displayedMemory.equals(this.lastOutputScreen)&&(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),!0===e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))},e.prototype.cueSplitAtTime=function(e){this.outputFilter&&!this.displayedMemory.isEmpty()&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e)},e}(),ia=function(){function e(t,a,r){_e(this,e),this.field=t||1,this.outputs=[a,r],this.channels=[new oa(1,a),new oa(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return e.prototype.getHandler=function(e){return this.channels[e].getHandler()},e.prototype.setHandler=function(e,t){this.channels[e].setHandler(t)},e.prototype.addData=function(e,t){var r=!1,n,o,a;this.lastTime=e,Jt.setTime(e);for(var d=0;d<t.length;d+=2){if(o=127&t[d],a=127&t[d+1],0===o&&0===a){this.dataCounters.padding+=2;continue}else Jt.log('DATA','['+ea([t[d],t[d+1]])+'] -> ('+ea([o,a])+')');if(n=this.parseCmd(o,a),n||(n=this.parseMidrow(o,a)),n||(n=this.parsePAC(o,a)),n||(n=this.parseBackgroundAttributes(o,a)),!n&&(r=this.parseChars(o,a),r))if(this.currChNr&&0<=this.currChNr){var i=this.channels[this.currChNr-1];i.insertChars(r)}else Jt.log('WARNING','No channel found yet. TEXT-MODE?');n?this.dataCounters.cmd+=2:r?this.dataCounters.char+=2:(this.dataCounters.other+=2,Jt.log('WARNING','Couldn\'t parse cleaned data '+ea([o,a])+' orig: '+ea([t[d],t[d+1]])))}},e.prototype.parseCmd=function(e,t){var a=null;if(!((20===e||28===e)&&32<=t&&47>=t||(23===e||31===e)&&33<=t&&35>=t))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,Jt.log('DEBUG','Repeated command ('+ea([e,t])+') is dropped'),!0;a=20===e||23===e?1:2;var r=this.channels[a-1];return 20===e||28===e?32===t?r.ccRCL():33===t?r.ccBS():34===t?r.ccAOF():35===t?r.ccAON():36===t?r.ccDER():37===t?r.ccRU(2):38===t?r.ccRU(3):39===t?r.ccRU(4):40===t?r.ccFON():41===t?r.ccRDC():42===t?r.ccTR():43===t?r.ccRTD():44===t?r.ccEDM():45===t?r.ccCR():46===t?r.ccENM():47===t&&r.ccEOC():r.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=a,!0},e.prototype.parseMidrow=function(e,t){var a=null;if((17===e||25===e)&&32<=t&&47>=t){if(a=17===e?1:2,a!==this.currChNr)return Jt.log('ERROR','Mismatch channel in midrow parsing'),!1;var r=this.channels[a-1];return r.ccMIDROW(t),Jt.log('DEBUG','MIDROW ('+ea([e,t])+')'),!0}return!1},e.prototype.parsePAC=function(e,t){var a=null,r=null;if(!((17<=e&&23>=e||25<=e&&31>=e)&&64<=t&&127>=t||(16===e||24===e)&&64<=t&&95>=t))return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;a=23>=e?1:2,r=64<=t&&95>=t?1===a?qt[e]:Qt[e]:1===a?Xt[e]:Zt[e];var n=this.interpretPAC(r,t),o=this.channels[a-1];return o.setPAC(n),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=a,!0},e.prototype.interpretPAC=function(e,t){var a=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return a=95<t?t-96:t-64,r.underline=1==(1&a),13>=a?r.color=['white','green','blue','cyan','red','yellow','magenta','white'][o(a/2)]:15>=a?(r.italics=!0,r.color='white'):r.indent=4*o((a-16)/2),r},e.prototype.parseChars=function(e,t){var a=null,r=null,n=null;if(25<=e?(a=2,n=e-8):(a=1,n=e),17<=n&&19>=n){var o=t;o=17===n?t+80:18===n?t+112:t+144,Jt.log('INFO','Special char \''+jt(o)+'\' in channel '+a),r=[o]}else 32<=e&&127>=e&&(r=0===t?[e]:[e,t]);if(r){var i=ea(r);Jt.log('DEBUG','Char codes =  '+i.join(',')),this.lastCmdA=null,this.lastCmdB=null}return r},e.prototype.parseBackgroundAttributes=function(e,t){var a,r,n,i;return((16===e||24===e)&&32<=t&&47>=t||(23===e||31===e)&&45<=t&&47>=t)&&(a={},16===e||24===e?(r=o((t-32)/2),a.background=$t[r],1==t%2&&(a.background+='_semi')):45===t?a.background='transparent':(a.foreground='black',47===t&&(a.underline=!0)),n=24>e?1:2,i=this.channels[n-1],i.setBkgData(a),this.lastCmdA=null,this.lastCmdB=null,!0)},e.prototype.reset=function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},e.prototype.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)},e}(),da=function(){function e(t,a){Te(this,e),this.timelineController=t,this.track=a,this.startTime=null,this.endTime=null,this.screen=null}return e.prototype.dispatchCue=function(){null===this.startTime||(this.timelineController.addCues('textTrack'+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},e.prototype.newCue=function(e,t,a){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=a,this.timelineController.createCaptionsTrack(this.track)},e}(),sa=da,la=function(e,t,a){return e.substr(a||0,t.length)===t},ua=function(e){var t=parseInt(e.substr(-3)),a=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),n=9<e.length?parseInt(e.substr(0,e.indexOf(':'))):0;return isNaN(t)||isNaN(a)||isNaN(r)||isNaN(n)?-1:(t+=1e3*a,t+=60000*r,t+=3600000*n,t)},pa=function(e){for(var t=5381,a=e.length;a;)t=33*t^e.charCodeAt(--a);return(t>>>0).toString()},ca=function(e,t,a){var r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;n&&n.new;)e.ccOffset+=r.start-n.start,r.new=!1,r=n,n=e[r.prevCC];e.presentationOffset=a},fa={parse:function(e,t,a,r,n,o){var i=/\r\n|\n\r|\n|\r/g,d=Object(Rt.b)(new Uint8Array(e)).trim().replace(i,'\n').split('\n'),s='00:00.000',l=0,u=0,p=0,c=[],f=!0,g=new ce,m;g.oncue=function(e){var t=a[r],n=a.ccOffset;t&&t.new&&(u===void 0?ca(a,r,p):n=a.ccOffset=t.start),p&&(n=p+a.ccOffset-a.presentationOffset),e.startTime+=n-u,e.endTime+=n-u,e.id=pa(e.startTime.toString())+pa(e.endTime.toString())+pa(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&c.push(e)},g.onparsingerror=function(t){m=t},g.onflush=function(){return m&&o?void o(m):void n(c)},d.forEach(function(e){if(f){if(la(e,'X-TIMESTAMP-MAP=')){f=!1,e.substr(16).split(',').forEach(function(e){la(e,'LOCAL:')?s=e.substr(6):la(e,'MPEGTS:')&&(l=parseInt(e.substr(7)))});try{t=0>t?t+8589934592:t,l-=t,u=ua(s)/1e3,p=l/9e4,-1==u&&(m=new Error('Malformed X-TIMESTAMP-MAP: '+e))}catch(t){m=new Error('Malformed X-TIMESTAMP-MAP: '+e)}return}''===e&&(f=!1)}g.parse(e+'\n')}),g.flush()}},ga=function(t){function a(e){Ee(this,a);var r=Re(this,t.call(this,e,Ue.a.MEDIA_ATTACHING,Ue.a.MEDIA_DETACHING,Ue.a.FRAG_PARSING_USERDATA,Ue.a.FRAG_DECRYPTED,Ue.a.MANIFEST_LOADING,Ue.a.MANIFEST_LOADED,Ue.a.FRAG_LOADED,Ue.a.LEVEL_SWITCHING,Ue.a.INIT_PTS_FOUND));if(r.hls=e,r.config=e.config,r.enabled=!0,r.Cues=e.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.config.enableCEA708Captions){var n=new sa(r,1),o=new sa(r,2);r.cea608Parser=new ia(0,n,o)}return r}return Se(a,t),a.prototype.addCues=function(t,a,r,n){for(var o=this.cueRanges,d=!1,l=o.length;l--;){var i=o[l],u=Le(i[0],i[1],a,r);if(0<=u&&(i[0]=s(i[0],a),i[1]=e(i[1],r),d=!0,0.5<u/(r-a)))return}d||o.push([a,r]),this.Cues.newCue(this[t],a,r,n)},a.prototype.onInitPtsFound=function(e){var t=this;'undefined'==typeof this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])},a.prototype.getExistingTrack=function(e){var t=this.media;if(t)for(var a=0;a<t.textTracks.length;a++){var r=t.textTracks[a];if(!0===r['textTrack'+e])return r}return null},a.prototype.sendAddTrackEvent=function(t,a){var r=null;try{r=new window.Event('addtrack')}catch(e){r=document.createEvent('Event'),r.initEvent('addtrack',!1,!1)}r.track=t,a.dispatchEvent(r)},a.prototype.createCaptionsTrack=function(e){var t='textTrack'+e;if(!this[t]){var a=this.getExistingTrack(e);if(!a){var r=this.createTextTrack('captions',this.config['captionsTextTrack'+e+'Label'],this.config.captionsTextTrack1LanguageCode);r&&(r[t]=!0,this[t]=r)}else this[t]=a,ve(this[t]),this.sendAddTrackEvent(this[t],this.media)}},a.prototype.createTextTrack=function(e,t,a){var r=this.media;if(r)return r.addTextTrack(e,t,a)},a.prototype.destroy=function(){Ve.prototype.destroy.call(this)},a.prototype.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},a.prototype.onMediaDetaching=function(){ve(this.textTrack1),ve(this.textTrack2)},a.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},a.prototype._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var a=0;a<t.length;a++)ve(t[a])}},a.prototype.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var a=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,r){var n;if(r<a.length){var o=a[r];Ae(o,e)&&(n=o)}n||(n=t.createTextTrack('subtitles',e.name,e.lang)),n.mode=e.default?'showing':'hidden',t.textTracks.push(n)})}},a.prototype.onLevelSwitching=function(){this.enabled='NONE'!==this.hls.currentLevel.closedCaptions},a.prototype.onFragLoaded=function(e){var t=e.frag,a=e.payload;if('main'===t.type){var r=t.sn;if(r!==this.lastSn+1){var n=this.cea608Parser;n&&n.reset()}this.lastSn=r}else if('subtitle'===t.type)if(a.byteLength){if('undefined'==typeof this.initPTS)return void this.unparsedVttFrags.push(e);var o=t.decryptdata;(null==o||null==o.key||'AES-128'!==o.method)&&this._parseVTTs(t,a)}else this.hls.trigger(Ue.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},a.prototype._parseVTTs=function(t,e){var a=this.vttCCs;a[t.cc]||(a[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var r=this.textTracks,n=this.hls;fa.parse(e,this.initPTS,a,t.cc,function(e){var a=r[t.trackId];e.forEach(function(e){if(!a.cues.getCueById(e.id))try{a.addCue(e)}catch(r){var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,a.addCue(t)}}),n.trigger(Ue.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(a){We.b.log('Failed to parse VTT cue: '+a),n.trigger(Ue.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},a.prototype.onFragDecrypted=function(e){var t=e.payload,a=e.frag;if('subtitle'===a.type){if('undefined'==typeof this.initPTS)return void this.unparsedVttFrags.push(e);this._parseVTTs(a,t)}},a.prototype.onFragParsingUserdata=function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0,a;t<e.samples.length;t++)a=this.extractCea608Data(e.samples[t].bytes),this.cea608Parser.addData(e.samples[t].pts,a)},a.prototype.extractCea608Data=function(e){for(var t=31&e[0],a=2,r=[],n=0,o,i,d,s,l;n<t;n++)(o=e[a++],i=127&e[a++],d=127&e[a++],s=0!=(4&o),l=3&o,0!==i||0!==d)&&s&&0===l&&(r.push(i),r.push(d));return r},a}(Ve),ma=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),ya=function(e){function t(a){De(this,t);var r=Ce(this,e.call(this,a,Ue.a.MEDIA_ATTACHED,Ue.a.MEDIA_DETACHING,Ue.a.MANIFEST_LOADING,Ue.a.MANIFEST_LOADED,Ue.a.SUBTITLE_TRACK_LOADED));return r.tracks=[],r.trackId=-1,r.media=void 0,r.subtitleDisplay=!1,r}return ke(t,e),t.prototype._onTextTracksChanged=function(){if(this.media){for(var e=-1,t=Ie(this.media.textTracks),a=0;a<t.length;a++)'showing'===t[a].mode&&(e=a);this.subtitleTrack=e}},t.prototype.destroy=function(){Ve.prototype.destroy.call(this)},t.prototype.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&'onchange'in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){t.trackChangeListener()},500):this.media.textTracks.addEventListener('change',this.trackChangeListener))},t.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener('change',this.trackChangeListener),this.media=void 0)},t.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},t.prototype.onManifestLoaded=function(e){var t=this,a=e.subtitles||[];this.tracks=a,this.trackId=-1,this.hls.trigger(Ue.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:a}),a.forEach(function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)})},t.prototype.onTick=function(){var e=this.trackId,t=this.tracks[e];if(t){var a=t.details;(void 0===a||!0===a.live)&&(We.b.log('(re)loading playlist for subtitle track '+e),this.hls.trigger(Ue.a.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))}},t.prototype.onSubtitleTrackLoaded=function(e){var t=this;e.id<this.tracks.length&&(We.b.log('subtitle track '+e.id+' loaded'),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},t.prototype.setSubtitleTrackInternal=function(e){if(!(-1>e||e>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var t=Ie(this.media.textTracks);if(-1!==this.trackId&&this.subtitleDisplay&&(t[this.trackId].mode='hidden'),this.trackId=e,We.b.log('switching to subtitle track '+e),this.hls.trigger(Ue.a.SUBTITLE_TRACK_SWITCH,{id:e}),-1!==e){var a=this.tracks[e];this.subtitleDisplay&&(t[e].mode='showing');var r=a.details;(void 0===r||!0===r.live)&&(We.b.log('(re)loading playlist for subtitle track '+e),this.hls.trigger(Ue.a.SUBTITLE_TRACK_LOADING,{url:a.url,id:e}))}}},ma(t,[{key:'subtitleTracks',get:function(){return this.tracks}},{key:'subtitleTrack',get:function(){return this.trackId},set:function(e){this.trackId!==e&&this.setSubtitleTrackInternal(e)}}]),t}(Ve),ha=l(4),ba={STOPPED:'STOPPED',IDLE:'IDLE',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING'},_a=function(e){function t(a){Pe(this,t);var r=we(this,e.call(this,a,Ue.a.MEDIA_ATTACHED,Ue.a.ERROR,Ue.a.KEY_LOADED,Ue.a.FRAG_LOADED,Ue.a.SUBTITLE_TRACKS_UPDATED,Ue.a.SUBTITLE_TRACK_SWITCH,Ue.a.SUBTITLE_TRACK_LOADED,Ue.a.SUBTITLE_FRAG_PROCESSED));return r.config=a.config,r.vttFragSNsProcessed={},r.vttFragQueues=void 0,r.currentlyProcessing=null,r.state=ba.STOPPED,r.currentTrackId=-1,r.ticks=0,r.decrypter=new ha.a(a.observer,a.config),r}return xe(t,e),t.prototype.destroy=function(){Ve.prototype.destroy.call(this),this.state=ba.STOPPED},t.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},t.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&-1<this.currentTrackId&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=e,this.hls.trigger(Ue.a.FRAG_LOADING,{frag:e}),this.state=ba.FRAG_LOADING}},t.prototype.onSubtitleFragProcessed=function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.state=ba.IDLE,this.nextFrag()},t.prototype.onMediaAttached=function(){this.state=ba.IDLE},t.prototype.onError=function(e){var t=e.frag;t&&'subtitle'!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},t.prototype.tick=function(){var e=this;this.ticks++,1===this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(function(){e.tick()},1),this.ticks=0)},t.prototype.doTick=function(){var e=this;switch(this.state){case ba.IDLE:var t=this.tracks,a=this.currentTrackId,r=this.vttFragSNsProcessed[a],n=this.vttFragQueues[a],o=this.currentlyProcessing?this.currentlyProcessing.sn:-1,i=function(e){return-1<r.indexOf(e.sn)},d=function(e){return n.some(function(t){return t.sn===e.sn})};if(!t)break;var s;if(a<t.length&&(s=t[a].details),'undefined'==typeof s)break;s.fragments.forEach(function(t){i(t)||t.sn===o||d(t)||(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key?(We.b.log('Loading key for '+t.sn),e.state=ba.KEY_LOADING,e.hls.trigger(Ue.a.KEY_LOADING,{frag:t})):(t.trackId=a,n.push(t),e.nextFrag()))});}},t.prototype.onSubtitleTracksUpdated=function(e){var t=this;We.b.log('subtitle tracks updated'),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})},t.prototype.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id,this.clearVttFragQueues()},t.prototype.onSubtitleTrackLoaded=function(){this.tick()},t.prototype.onKeyLoaded=function(){this.state===ba.KEY_LOADING&&(this.state=ba.IDLE,this.tick())},t.prototype.onFragLoaded=function(e){var t=this.fragCurrent,a=e.frag.decryptdata,r=e.frag,n=this.hls;if(this.state===ba.FRAG_LOADING&&t&&'subtitle'===e.frag.type&&t.sn===e.frag.sn&&0<e.payload.byteLength&&null!=a&&null!=a.key&&'AES-128'===a.method){var o;try{o=performance.now()}catch(e){o=Date.now()}this.decrypter.decrypt(e.payload,a.key.buffer,a.iv.buffer,function(e){var t;try{t=performance.now()}catch(e){t=Date.now()}n.trigger(Ue.a.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})})}},t}(Ve),Ta={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60000000,maxBufferHole:0.5,maxSeekHole:2,lowBufferWatchdogPeriod:0.5,highBufferWatchdogPeriod:3,nudgeOffset:0.1,nudgeMaxRetry:3,maxFragLookUpTolerance:0.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64000,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64000,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64000,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:3,loader:Ot,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Ct,bufferController:It,capLevelController:wt,fpsController:xt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:0.95,abrBandWidthUpFactor:0.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Ta.subtitleStreamController=_a,Ta.subtitleTrackController=ya,Ta.timelineController=ga,Ta.cueHandler=Ne,Ta.enableCEA708Captions=!0,Ta.enableWebVTT=!0,Ta.captionsTextTrack1Label='English',Ta.captionsTextTrack1LanguageCode='en',Ta.captionsTextTrack2Label='Spanish',Ta.captionsTextTrack2LanguageCode='es',Ta.audioStreamController=Ut,Ta.audioTrackController=Nt;var Ea=function(){function e(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),Ra=function(){function t(){var e=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Oe(this,t);var r=t.DefaultConfig;if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error('Illegal hls.js config: don\'t mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration');for(var n in r)n in a||(a[n]=r[n]);if(void 0!==a.liveMaxLatencyDurationCount&&a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==a.liveMaxLatencyDuration&&(a.liveMaxLatencyDuration<=a.liveSyncDuration||void 0===a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(We.a)(a.debug),this.config=a,this._autoLevelCapping=-1;var o=this.observer=new ut.a;o.trigger=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];o.emit.apply(o,[e,e].concat(a))},o.off=function(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];o.removeListener.apply(o,[e].concat(a))},this.on=o.on.bind(o),this.off=o.off.bind(o),this.trigger=o.trigger.bind(o);var i=this.abrController=new a.abrController(this),d=new a.bufferController(this),s=new a.capLevelController(this),l=new a.fpsController(this),u=new rt(this),p=new nt(this),c=new ot(this),f=new St(this),g=this.levelController=new Et(this),m=this.streamController=new _t(this),y=[g,m],h=a.audioStreamController;h&&y.push(new h(this)),this.networkControllers=y;var b=[u,p,c,i,d,s,l,f];if(h=a.audioTrackController,h){var _=new h(this);this.audioTrackController=_,b.push(_)}if(h=a.subtitleTrackController,h){var T=new h(this);this.subtitleTrackController=T,b.push(T)}[a.subtitleStreamController,a.timelineController].forEach(function(t){t&&b.push(new t(e))}),this.coreComponents=b}return t.isSupported=function(){return V()},Ea(t,null,[{key:'version',get:function(){return'0.8.9'}},{key:'Events',get:function(){return Ue.a}},{key:'ErrorTypes',get:function(){return Ge.b}},{key:'ErrorDetails',get:function(){return Ge.a}},{key:'DefaultConfig',get:function(){return t.defaultConfig?t.defaultConfig:Ta},set:function(e){t.defaultConfig=e}}]),t.prototype.destroy=function(){We.b.log('destroy'),this.trigger(Ue.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(e){We.b.log('attachMedia'),this.media=e,this.trigger(Ue.a.MEDIA_ATTACHING,{media:e})},t.prototype.detachMedia=function(){We.b.log('detachMedia'),this.trigger(Ue.a.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(e){e=Me.a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),We.b.log('loadSource:'+e),this.url=e,this.trigger(Ue.a.MANIFEST_LOADING,{url:e})},t.prototype.startLoad=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;We.b.log('startLoad('+e+')'),this.networkControllers.forEach(function(t){t.startLoad(e)})},t.prototype.stopLoad=function(){We.b.log('stopLoad'),this.networkControllers.forEach(function(e){e.stopLoad()})},t.prototype.swapAudioCodec=function(){We.b.log('swapAudioCodec'),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){We.b.log('recoverMediaError');var e=this.media;this.detachMedia(),this.attachMedia(e)},Ea(t,[{key:'levels',get:function(){return this.levelController.levels}},{key:'currentLevel',get:function(){return this.streamController.currentLevel},set:function(e){We.b.log('set currentLevel:'+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:'nextLevel',get:function(){return this.streamController.nextLevel},set:function(e){We.b.log('set nextLevel:'+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:'loadLevel',get:function(){return this.levelController.level},set:function(e){We.b.log('set loadLevel:'+e),this.levelController.manualLevel=e}},{key:'nextLoadLevel',get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:'firstLevel',get:function(){return e(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){We.b.log('set firstLevel:'+e),this.levelController.firstLevel=e}},{key:'startLevel',get:function(){return this.levelController.startLevel},set:function(t){We.b.log('set startLevel:'+t);var a=this;-1!==t&&(t=e(t,a.minAutoLevel)),a.levelController.startLevel=t}},{key:'autoLevelCapping',get:function(){return this._autoLevelCapping},set:function(e){We.b.log('set autoLevelCapping:'+e),this._autoLevelCapping=e}},{key:'autoLevelEnabled',get:function(){return-1===this.levelController.manualLevel}},{key:'manualLevel',get:function(){return this.levelController.manualLevel}},{key:'minAutoLevel',get:function(){for(var t=this,a=t.levels,r=t.config.minAutoBitrate,n=a?a.length:0,o=0,i;o<n;o++)if(i=a[o].realBitrate?e(a[o].realBitrate,a[o].bitrate):a[o].bitrate,i>r)return o;return 0}},{key:'maxAutoLevel',get:function(){var e=this,t=e.levels,a=e.autoLevelCapping,r;return r=-1===a&&t&&t.length?t.length-1:a,r}},{key:'nextAutoLevel',get:function(){var t=this;return s(e(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){var a=this;a.abrController.nextAutoLevel=e(a.minAutoLevel,t)}},{key:'audioTracks',get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:'audioTrack',get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:'liveSyncPosition',get:function(){return this.streamController.liveSyncPosition}},{key:'subtitleTracks',get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:'subtitleTrack',get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:'subtitleDisplay',get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),t}(),Sa=i['default']=Ra},function(e,t,a){function r(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(a,'a',a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='/',t.oe=function(e){throw console.error(e),e};var r=t(t.s=ENTRY_MODULE);return r.default||r}function n(e){return(e+'').replace(/[.?*+^$[\]\\(){}|-]/g,'\\$&')}function o(e){var t=[],a=e.toString(),r=a.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!r)return t;for(var o=r[1],i=new RegExp('(\\\\n|\\W)'+n(o)+'\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)','g'),d;d=i.exec(a);)t.push(d[3]);return t}function i(e,t){for(var a=[t],r=[],n={};a.length;){var i=a.pop();if(!n[i]&&e[i]){n[i]=!0,r.push(i);var d=o(e[i]);a=a.concat(d)}}return r}e.exports=function(e,t){t=t||{};var n=a.m,o=t.all?Object.keys(n):i(n,e),d='('+r.toString().replace('ENTRY_MODULE',JSON.stringify(e))+')({'+o.map(function(e){return''+JSON.stringify(e)+': '+n[e].toString()}).join(',')+'})(self);',s=new window.Blob([d],{type:'text/javascript'});if(t.bare)return s;var l=window.URL||window.webkitURL||window.mozURL||window.msURL,u=l.createObjectURL(s),p=new window.Worker(u);return p.objectURL=u,p}},function(e,t,a){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var r=a(7),n=a(1),o=a(0),i=a(5),d=a.n(i);t['default']=function(e){var t=new d.a;t.trigger=function(e){for(var a=arguments.length,r=Array(1<a?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var a=arguments.length,r=Array(1<a?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];t.removeListener.apply(t,[e].concat(r))};var a=function(t,a){e.postMessage({event:t,data:a})};e.addEventListener('message',function(n){var i=n.data;switch(i.cmd){case'init':var d=JSON.parse(i.config);e.demuxer=new r.a(t,i.typeSupported,d,i.vendor);try{Object(o.a)(!0===d.debug)}catch(e){console.warn('demuxerWorker: unable to enable logs')}a('init',null);break;case'demux':e.demuxer.push(i.data,i.decryptdata,i.initSegment,i.audioCodec,i.videoCodec,i.timeOffset,i.discontinuity,i.trackSwitch,i.contiguous,i.duration,i.accurateTimeOffset,i.defaultInitPTS);break;default:}}),t.on(n.a.FRAG_DECRYPTED,a),t.on(n.a.FRAG_PARSING_INIT_SEGMENT,a),t.on(n.a.FRAG_PARSED,a),t.on(n.a.ERROR,a),t.on(n.a.FRAG_PARSING_METADATA,a),t.on(n.a.FRAG_PARSING_USERDATA,a),t.on(n.a.INIT_PTS_FOUND,a),t.on(n.a.FRAG_PARSING_DATA,function(t,a){var r=[],n={event:t,data:a};a.data1&&(n.data1=a.data1.buffer,r.push(a.data1.buffer),delete a.data1),a.data2&&(n.data2=a.data2.buffer,r.push(a.data2.buffer),delete a.data2),e.postMessage(n,r)})}}])['default']})},function(e,t,a){var r;(function(n){'use strict';var o='?',i='function',d='undefined',s='object',l='model',u='name',p='type',c='vendor',f='version',g='architecture',m='console',y='mobile',h='tablet',b='smarttv',_='wearable',T={extend:function(e,t){var a={};for(var r in e)a[r]=t[r]&&0==t[r].length%2?t[r].concat(e[r]):e[r];return a},has:function(e,t){return!('string'!=typeof e)&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e=='string'?e.replace(/[^\d\.]/g,'').split('.')[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')}},E={rgx:function(e,t){for(var a=0,r,n,o,d,l,u;a<t.length&&!l;){var p=t[a],c=t[a+1];for(r=n=0;r<p.length&&!l;)if(l=p[r++].exec(e),!!l)for(o=0;o<c.length;o++)u=l[++n],d=c[o],typeof d==s&&0<d.length?2==d.length?typeof d[1]==i?this[d[0]]=d[1].call(this,u):this[d[0]]=d[1]:3==d.length?typeof d[1]!=i||d[1].exec&&d[1].test?this[d[0]]=u?u.replace(d[1],d[2]):void 0:this[d[0]]=u?d[1].call(this,u,d[2]):void 0:4==d.length&&(this[d[0]]=u?d[3].call(this,u.replace(d[1],d[2])):void 0):this[d]=u?u:void 0;a+=2}},str:function(e,t){for(var a in t)if(typeof t[a]==s&&0<t[a].length){for(var r=0;r<t[a].length;r++)if(T.has(t[a][r],e))return a==o?void 0:a;}else if(T.has(t[a],e))return a==o?void 0:a;return e}},R={browser:{oldsafari:{version:{"1.0":'/8',1.2:'/1',1.3:'/3',"2.0":'/412',"2.0.2":'/416',"2.0.3":'/417',"2.0.4":'/419',"?":'/'}}},device:{amazon:{model:{"Fire Phone":['SD','KF']}},sprint:{model:{"Evo Shift 4G":'7373KT'},vendor:{HTC:'APA',Sprint:'Sprint'}}},os:{windows:{version:{7:'NT 6.1',8:'NT 6.2',10:['NT 6.4','NT 10.0'],2000:'NT 5.0',ME:'4.90',"NT 3.11":'NT3.51',"NT 4.0":'NT4.0',XP:['NT 5.1','NT 5.2'],Vista:'NT 6.0',8.1:'NT 6.3',RT:'ARM'}}}},S={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[u,f],[/(opios)[\/\s]+([\w\.]+)/i],[[u,'Opera Mini'],f],[/\s(opr)\/([\w\.]+)/i],[[u,'Opera'],f],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[u,f],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[u,'IE'],f],[/(edge)\/((\d+)?[\w\.]+)/i],[u,f],[/(yabrowser)\/([\w\.]+)/i],[[u,'Yandex'],f],[/(puffin)\/([\w\.]+)/i],[[u,'Puffin'],f],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[u,'UCBrowser'],f],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g,' '],f],[/(micromessenger)\/([\w\.]+)/i],[[u,'WeChat'],f],[/(QQ)\/([\d\.]+)/i],[u,f],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[u,f],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[f,[u,'MIUI Browser']],[/;fbav\/([\w\.]+);/i],[f,[u,'Facebook']],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[f,[u,'Chrome Headless']],[/\swv\).+(chrome)\/([\w\.]+)/i],[[u,/(.+)/,'$1 WebView'],f],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[u,/(.+(?:g|us))(.+)/,'$1 $2'],f],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[f,[u,'Android Browser']],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[u,f],[/(dolfin)\/([\w\.]+)/i],[[u,'Dolphin'],f],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[u,'Chrome'],f],[/(coast)\/([\w\.]+)/i],[[u,'Opera Coast'],f],[/fxios\/([\w\.-]+)/i],[f,[u,'Firefox']],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[f,[u,'Mobile Safari']],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[f,u],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[u,'GSA'],f],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[u,[f,E.str,R.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[u,f],[/(navigator|netscape)\/([\w\.-]+)/i],[[u,'Netscape'],f],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[u,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[g,'amd64']],[/(ia32(?=;))/i],[[g,T.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[g,'ia32']],[/windows\s(ce|mobile);\sppc;/i],[[g,'arm']],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[g,/ower/,'',T.lowerize]],[/(sun4\w)[;\)]/i],[[g,'sparc']],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[g,T.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[l,c,[p,h]],[/applecoremedia\/[\w\.]+ \((ipad)/],[l,[c,'Apple'],[p,h]],[/(apple\s{0,1}tv)/i],[[l,'Apple TV'],[c,'Apple']],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[c,l,[p,h]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[l,[c,'Amazon'],[p,h]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[l,E.str,R.device.amazon.model],[c,'Amazon'],[p,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[l,c,[p,y]],[/\((ip[honed|\s\w*]+);/i],[l,[c,'Apple'],[p,y]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[c,l,[p,y]],[/\(bb10;\s(\w+)/i],[l,[c,'BlackBerry'],[p,y]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[l,[c,'Asus'],[p,h]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[c,'Sony'],[l,'Xperia Tablet'],[p,h]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[l,[c,'Sony'],[p,y]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[c,l,[p,m]],[/android.+;\s(shield)\sbuild/i],[l,[c,'Nvidia'],[p,m]],[/(playstation\s[34portablevi]+)/i],[l,[c,'Sony'],[p,m]],[/(sprint\s(\w+))/i],[[c,E.str,R.device.sprint.vendor],[l,E.str,R.device.sprint.model],[p,y]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[c,l,[p,h]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[c,[l,/_/g,' '],[p,y]],[/(nexus\s9)/i],[l,[c,'HTC'],[p,h]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[l,[c,'Huawei'],[p,y]],[/(microsoft);\s(lumia[\s\w]+)/i],[c,l,[p,y]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[l,[c,'Microsoft'],[p,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g,' '],[c,'Microsoft'],[p,y]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[l,[c,'Motorola'],[p,y]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[l,[c,'Motorola'],[p,h]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[c,T.trim],[l,T.trim],[p,b]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,'SmartTV'],[c,'Samsung'],[p,b]],[/\(dtv[\);].+(aquos)/i],[l,[c,'Sharp'],[p,b]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[c,'Samsung'],l,[p,h]],[/smart-tv.+(samsung)/i],[c,[p,b],l],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[c,'Samsung'],l,[p,y]],[/sie-(\w+)*/i],[l,[c,'Siemens'],[p,y]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[c,'Nokia'],l,[p,y]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[l,[c,'Acer'],[p,h]],[/android.+([vl]k\-?\d{3})\s+build/i],[l,[c,'LG'],[p,h]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[c,'LG'],l,[p,h]],[/(lg) netcast\.tv/i],[c,l,[p,b]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[l,[c,'LG'],[p,y]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[l,[c,'Lenovo'],[p,h]],[/linux;.+((jolla));/i],[c,l,[p,y]],[/((pebble))app\/[\d\.]+\s/i],[c,l,[p,_]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[c,l,[p,y]],[/crkey/i],[[l,'Chromecast'],[c,'Google']],[/android.+;\s(glass)\s\d/i],[l,[c,'Google'],[p,_]],[/android.+;\s(pixel c)\s/i],[l,[c,'Google'],[p,h]],[/android.+;\s(pixel xl|pixel)\s/i],[l,[c,'Google'],[p,y]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[l,/_/g,' '],[c,'Xiaomi'],[p,y]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[l,/_/g,' '],[c,'Xiaomi'],[p,h]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[l,[c,'Meizu'],[p,h]],[/android.+a000(1)\s+build/i],[l,[c,'OnePlus'],[p,y]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[l,[c,'RCA'],[p,h]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[l,[c,'Dell'],[p,h]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[l,[c,'Verizon'],[p,h]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[c,'Barnes & Noble'],l,[p,h]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[l,[c,'NuVision'],[p,h]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[c,'ZTE'],l,[p,h]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[l,[c,'Swiss'],[p,y]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[l,[c,'Swiss'],[p,h]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[l,[c,'Zeki'],[p,h]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[c,'Dragon Touch'],l,[p,h]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[l,[c,'Insignia'],[p,h]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[l,[c,'NextBook'],[p,h]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[c,'Voice'],l,[p,y]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[c,'LvTel'],l,[p,y]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[l,[c,'Envizen'],[p,h]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[c,l,[p,h]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[l,[c,'MachSpeed'],[p,h]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[c,l,[p,h]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[l,[c,'Rotor'],[p,h]],[/android.+(KS(.+))\s+build/i],[l,[c,'Amazon'],[p,h]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[c,l,[p,h]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[p,T.lowerize],c,l],[/(android.+)[;\/].+build/i],[l,[c,'Generic']]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[f,[u,'EdgeHTML']],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[u,f],[/rv\:([\w\.]+).*(gecko)/i],[f,u]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[u,f],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[u,[f,E.str,R.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[u,'Windows'],[f,E.str,R.os.windows.version]],[/\((bb)(10);/i],[[u,'BlackBerry'],f],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[u,f],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[u,'Symbian'],f],[/\((series40);/i],[u],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[u,'Firefox OS'],f],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[u,f],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[u,'Chromium OS'],f],[/(sunos)\s?([\w\.]+\d)*/i],[[u,'Solaris'],f],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[u,f],[/(haiku)\s(\w+)/i],[u,f],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[f,/_/g,'.'],[u,'iOS']],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[u,'Mac OS'],[f,/_/g,'.']],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[u,f]]},v=function(e,t){if('object'==typeof e&&(t=e,e=void 0),!(this instanceof v))return new v(e,t).getResult();var a=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:''),r=t?T.extend(S,t):S;return this.getBrowser=function(){var e={name:void 0,version:void 0};return E.rgx.call(e,a,r.browser),e.major=T.major(e.version),e},this.getCPU=function(){var e={architecture:void 0};return E.rgx.call(e,a,r.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return E.rgx.call(e,a,r.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return E.rgx.call(e,a,r.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return E.rgx.call(e,a,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return a},this.setUA=function(e){return a=e,this},this};v.VERSION='0.7.17',v.BROWSER={NAME:u,MAJOR:'major',VERSION:f},v.CPU={ARCHITECTURE:g},v.DEVICE={MODEL:l,VENDOR:c,TYPE:p,CONSOLE:m,MOBILE:y,SMARTTV:b,TABLET:h,WEARABLE:_,EMBEDDED:'embedded'},v.ENGINE={NAME:u,VERSION:f},v.OS={NAME:u,VERSION:f},typeof t==d?a(41)?(r=function(){return v}.call(t,a,t,e),!(r!==void 0&&(e.exports=r))):n&&(n.UAParser=v):(typeof e!=d&&e.exports&&(t=e.exports=v),t.UAParser=v);var A=n&&(n.jQuery||n.Zepto);if(typeof A!=d){var L=new v;A.ua=L.getResult(),A.ua.get=function(){return L.getUA()},A.ua.set=function(e){L.setUA(e);var t=L.getResult();for(var a in t)A.ua[a]=t[a]}}})('object'==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})}])});