/* A P2P-CDN supporting hls player built on WebRTC Data Channels API. @author XieTing <86755838@qq.com> <https://github.com/snowinszu> */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HlsPeerify=t():e.HlsPeerify=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=23)}([function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),i=c.length,u=0;u<i;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.trace),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.Fetcher=t.Events=t.DataChannel=void 0;var i=n(24),o=r(i),s=n(18),a=r(s),u=n(40),c=r(u),l=n(6).Buffer;t.DataChannel=o.default,t.Events=a.default,t.Fetcher=c.default,t.Buffer=l},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){g&&h&&(g=!1,h.length?p=h.concat(p):y=-1,p.length&&a())}function a(){if(!g){var e=i(s);g=!0;for(var t=p.length;t;){for(h=p,p=[];++y<t;)h&&h[y].run();y=-1,t=p.length}h=null,g=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var h,p=[],g=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new u(e,t)),1!==p.length||g||i(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);c.call(this,e),l.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||s.nextTick(o,this)}function o(e){e.end()}var s=n(9),a=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var u=n(8);u.inherits=n(4);var c=n(12),l=n(15);u.inherits(r,c);for(var f=a(l.prototype),d=0;d<f.length;d++){var h=f[d];r.prototype[h]||(r.prototype[h]=l.prototype[h])}Object.defineProperty(r.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),r.prototype._destroy=function(e,t){this.push(null),this.end(),s.nextTick(t,e)}},function(e,t,n){"use strict";(function(e){function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function i(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,n)}function s(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?d(e,t,n,r):"string"==typeof t?l(e,t,n):h(e,t)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t,n,r){return a(t),t<=0?i(e,t):void 0!==n?"string"==typeof r?i(e,t).fill(n,r):i(e,t).fill(n):i(e,t)}function c(e,t){if(a(t),e=i(e,t<0?0:0|p(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function l(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|y(t,n);e=i(e,r);var s=e.write(t,n);return s!==r&&(e=e.slice(0,s)),e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=i(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=f(e,t),e}function h(e,t){if(o.isBuffer(t)){var n=0|p(t.length);return e=i(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||Q(t.length)?i(e,0):f(e,t);if("Buffer"===t.type&&$(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function g(e){return+e!=e&&(e=0),o.alloc(+e)}function y(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return G(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return L(this,t,n);case"utf8":case"utf-8":return R(this,t,n);case"ascii":return x(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:w(e,t,n,r,i);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):w(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(e,t,n,r,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}var c;if(i){var l=-1;for(c=n;c<a;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(n+u>a&&(n=a-u),c=n;c>=0;c--){for(var f=!0,d=0;d<u;d++)if(o(e,c+d)!==o(t,d)){f=!1;break}if(f)return c}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function C(e,t,n,r){return J(G(t,e.length-n),e,n,r)}function S(e,t,n,r){return J(Y(t),e,n,r)}function E(e,t,n,r){return S(e,t,n,r)}function T(e,t,n,r){return J(V(t),e,n,r)}function k(e,t,n,r){return J(H(t,e.length-n),e,n,r)}function P(e,t,n){return 0===t&&n===e.length?K.fromByteArray(e):K.fromByteArray(e.slice(t,n))}function R(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=n){var u,c,l,f;switch(a){case 1:o<128&&(s=o);break;case 2:u=e[i+1],128==(192&u)&&(f=(31&o)<<6|63&u)>127&&(s=f);break;case 3:u=e[i+1],c=e[i+2],128==(192&u)&&128==(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c)>2047&&(f<55296||f>57343)&&(s=f);break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&f<1114112&&(s=f)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return A(r)}function A(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Z));return n}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function L(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=q(e[o]);return i}function M(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,r,i,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function N(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function B(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,r,i){return i||B(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(e,t,n,r,23,4),n+4}function F(e,t,n,r,i){return i||B(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(e,t,n,r,52,8),n+8}function W(e){if(e=z(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function z(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Y(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function H(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function V(e){return K.toByteArray(W(e))}function J(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Q(e){return e!==e}var K=n(25),X=n(26),$=n(11);t.Buffer=o,t.SlowBuffer=g,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return s(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return u(null,e,t,n)},o.allocUnsafe=function(e){return c(null,e)},o.allocUnsafeSlow=function(e){return c(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!$(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=o.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=y,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?R(this,0,e):v.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,r,i){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var s=i-r,a=n-t,u=Math.min(s,a),c=this.slice(r,i),l=e.slice(t,n),f=0;f<u;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return S(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r;if(o.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=o.prototype;else{var i=t-e;r=new o(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+e]}return r},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),X.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),X.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),X.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),X.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){I(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){I(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=o.isBuffer(e)?e:G(new o(e,r).toString()),u=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%u]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,n(1))},function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return s(e,t,n)}var o=n(6),s=o.Buffer;s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=o:(r(o,t),t.Buffer=i),r(s,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=s(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}},function(e,t,n){(function(e){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===y(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function s(e){return"number"==typeof e}function a(e){return"string"==typeof e}function u(e){return"symbol"==typeof e}function c(e){return void 0===e}function l(e){return"[object RegExp]"===y(e)}function f(e){return"object"==typeof e&&null!==e}function d(e){return"[object Date]"===y(e)}function h(e){return"[object Error]"===y(e)||e instanceof Error}function p(e){return"function"==typeof e}function g(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function y(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=o,t.isNumber=s,t.isString=a,t.isSymbol=u,t.isUndefined=c,t.isRegExp=l,t.isObject=f,t.isDate=d,t.isError=h,t.isFunction=p,t.isPrimitive=g,t.isBuffer=e.isBuffer}).call(t,n(6).Buffer)},function(e,t,n){"use strict";(function(t){function n(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick(function(){e.apply(null,o)})}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:n}:e.exports=t}).call(t,n(3))},function(e,t,n){(function(t){function r(e){var t=this;if(!(t instanceof r))return new r(e);if(t._id=u(4).toString("hex").slice(0,7),t._debug("new peer %o",e),e=Object.assign({allowHalfOpen:!1},e),c.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||u(20).toString("hex"):null,t._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||r.channelConfig,t.config=e.config||r.config,t.constraints=t._transformConstraints(e.constraints||r.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.reconnectTimer=e.reconnectTimer||!1,t.sdpTransform=e.sdpTransform||function(e){return e},t.stream=e.stream||!1,t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:s(),!t._wrtc)throw"undefined"==typeof window?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser");if(t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._previousStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._reconnectTimeout=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isWrtc=Array.isArray(t._pc.RTCIceConnectionStates),t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator){var n=!1;t._pc.onnegotiationneeded=function(){n||t._createOffer(),n=!0},t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)})}else t._pc.ondatachannel=function(e){t._setupData(e)};"addTrack"in t._pc?(t.stream&&t.stream.getTracks().forEach(function(e){t._pc.addTrack(e,t.stream)}),t._pc.ontrack=function(e){t._onTrack(e)}):(t.stream&&t._pc.addStream(t.stream),t._pc.onaddstream=function(e){t._onAddStream(e)}),t.initiator&&t._isWrtc&&t._pc.onnegotiationneeded(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}function i(){}e.exports=r;var o=n(27)("simple-peer"),s=n(30),a=n(4),u=n(31),c=n(32);a(r,c.Duplex),r.WEBRTC_SUPPORT=!!s(),r.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},r.constraints={},r.channelConfig={},Object.defineProperty(r.prototype,"bufferSize",{get:function(){var e=this;return e._channel&&e._channel.bufferedAmount||0}}),r.prototype.address=function(){var e=this;return{port:e.localPort,family:"IPv4",address:e.localAddress}},r.prototype.signal=function(e){var t=this;if(t.destroyed)throw new Error("cannot signal after peer is destroyed");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}t._debug("signal()"),e.candidate&&(t._pc.remoteDescription&&t._pc.remoteDescription.type?t._addIceCandidate(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),function(){t.destroyed||(t._pendingCandidates.forEach(function(e){t._addIceCandidate(e)}),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())},function(e){t.destroy(e)}),e.sdp||e.candidate||t.destroy(new Error("signal() called with invalid signal data"))},r.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),i,function(e){t.destroy(e)})}catch(e){t.destroy(new Error("error adding candidate: "+e.message))}},r.prototype.send=function(e){this._channel.send(e)},r.prototype.destroy=function(e){this._destroy(e,function(){})},r.prototype._destroy=function(e,t){var n=this;if(!n.destroyed){if(n._debug("destroy (error: %s)",e&&(e.message||e)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n.destroyed=!0,n.connected=!1,n._pcReady=!1,n._channelReady=!1,n._previousStreams=null,clearInterval(n._interval),clearTimeout(n._reconnectTimeout),n._interval=null,n._reconnectTimeout=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,"addTrack"in n._pc?n._pc.ontrack=null:n._pc.onaddstream=null,n._pc.onnegotiationneeded=null,n._pc.ondatachannel=null}if(n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}n._pc=null,n._channel=null,e&&n.emit("error",e),n.emit("close"),t()}},r.prototype._setupData=function(e){var t=this;if(!e.channel)return t.destroy(new Error("Data channel event is missing `channel` property"));t._channel=e.channel,t._channel.binaryType="arraybuffer","number"==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=65536),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._onChannelMessage(e)},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t.destroy(e)}},r.prototype._read=function(){},r.prototype._write=function(e,t,n){var r=this;if(r.destroyed)return n(new Error("cannot write after peer is destroyed"));if(r.connected){try{r.send(e)}catch(e){return r.destroy(e)}r._channel.bufferedAmount>65536?(r._debug("start backpressure: bufferedAmount %d",r._channel.bufferedAmount),r._cb=n):n(null)}else r._debug("write before connect"),r._chunk=e,r._cb=n},r.prototype._onFinish=function(){function e(){setTimeout(function(){t.destroy()},1e3)}var t=this;t.destroyed||(t.connected?e():t.once("connect",e))},r.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer(function(t){function n(){e.destroyed||(e.trickle||e._iceComplete?i():e.once("_iceComplete",i))}function r(t){e.destroy(t)}function i(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,n,r))},function(t){e.destroy(t)},e.offerConstraints)},r.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer(function(t){function n(){e.destroyed||(e.trickle||e._iceComplete?i():e.once("_iceComplete",i))}function r(t){e.destroy(t)}function i(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,n,r))},function(t){e.destroy(t)},e.answerConstraints)},r.prototype._onIceStateChange=function(){var e=this;if(!e.destroyed){var t=e._pc.iceConnectionState,n=e._pc.iceGatheringState;e._debug("iceStateChange (connection: %s) (gathering: %s)",t,n),e.emit("iceStateChange",t,n),"connected"!==t&&"completed"!==t||(clearTimeout(e._reconnectTimeout),e._pcReady=!0,e._maybeReady()),"disconnected"===t&&(e.reconnectTimer?(clearTimeout(e._reconnectTimeout),e._reconnectTimeout=setTimeout(function(){e.destroy()},e.reconnectTimer)):e.destroy()),"failed"===t&&e.destroy(new Error("Ice connection failed.")),"closed"===t&&e.destroy()}},r.prototype.getStats=function(e){var t=this;0===t._pc.getStats.length?t._pc.getStats().then(function(t){var n=[];t.forEach(function(e){n.push(e)}),e(null,n)},function(t){e(t)}):t._isReactNativeWebrtc?t._pc.getStats(null,function(t){var n=[];t.forEach(function(e){n.push(e)}),e(null,n)},function(t){e(t)}):t._pc.getStats.length>0?t._pc.getStats(function(n){if(!t.destroyed){var r=[];n.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),e(null,r)}},function(t){e(t)}):e(null,[])},r.prototype._maybeReady=function(){function e(){t.destroyed||t.getStats(function(n,r){function i(e){u=!0;var n=s[e.localCandidateId];n&&n.ip?(t.localAddress=n.ip,t.localPort=Number(n.port)):n&&n.ipAddress?(t.localAddress=n.ipAddress,t.localPort=Number(n.portNumber)):"string"==typeof e.googLocalAddress&&(n=e.googLocalAddress.split(":"),t.localAddress=n[0],t.localPort=Number(n[1]));var r=o[e.remoteCandidateId];r&&r.ip?(t.remoteAddress=r.ip,t.remotePort=Number(r.port)):r&&r.ipAddress?(t.remoteAddress=r.ipAddress,t.remotePort=Number(r.portNumber)):"string"==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(":"),t.remoteAddress=r[0],t.remotePort=Number(r[1])),t.remoteFamily="IPv4",t._debug("connect local: %s:%s remote: %s:%s",t.localAddress,t.localPort,t.remoteAddress,t.remotePort)}if(!t.destroyed){n&&(r=[]);var o={},s={},a={},u=!1;if(r.forEach(function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(o[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(s[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(a[e.id]=e)}),r.forEach(function(e){"transport"===e.type&&i(a[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&i(e)}),!(u||Object.keys(a).length&&!Object.keys(s).length))return void setTimeout(e,100);if(t._connecting=!1,t.connected=!0,t._chunk){try{t.send(t._chunk)}catch(n){return t.destroy(n)}t._chunk=null,t._debug('sent chunk from "write before connect"');var c=t._cb;t._cb=null,c(null)}"number"!=typeof t._channel.bufferedAmountLowThreshold&&(t._interval=setInterval(function(){t._onInterval()},150),t._interval.unref&&t._interval.unref()),t._debug("connect"),t.emit("connect")}})}var t=this;t._debug("maybeReady pc %s channel %s",t._pcReady,t._channelReady),!t.connected&&!t._connecting&&t._pcReady&&t._channelReady&&(t._connecting=!0,e())},r.prototype._onInterval=function(){var e=this;!e._cb||!e._channel||e._channel.bufferedAmount>65536||e._onChannelBufferedAmountLow()},r.prototype._onSignalingStateChange=function(){var e=this;e.destroyed||(e._debug("signalingStateChange %s",e._pc.signalingState),e.emit("signalingStateChange",e._pc.signalingState))},r.prototype._onIceCandidate=function(e){var t=this;t.destroyed||(e.candidate&&t.trickle?t.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(t._iceComplete=!0,t.emit("_iceComplete")))},r.prototype._onChannelMessage=function(e){var n=this;if(!n.destroyed){var r=e.data;r instanceof ArrayBuffer&&(r=t.from(r)),n.push(r)}},r.prototype._onChannelBufferedAmountLow=function(){var e=this;if(!e.destroyed&&e._cb){e._debug("ending backpressure: bufferedAmount %d",e._channel.bufferedAmount);var t=e._cb;e._cb=null,t(null)}},r.prototype._onChannelOpen=function(){var e=this;e.connected||e.destroyed||(e._debug("on channel open"),e._channelReady=!0,e._maybeReady())},r.prototype._onChannelClose=function(){var e=this;e.destroyed||(e._debug("on channel close"),e.destroy())},r.prototype._onAddStream=function(e){var t=this;t.destroyed||(t._debug("on add stream"),t.emit("stream",e.stream))},r.prototype._onTrack=function(e){var t=this;if(!t.destroyed){t._debug("on track");var n=e.streams[0].id;-1===t._previousStreams.indexOf(n)&&(t._previousStreams.push(n),t.emit("stream",e.streams[0]))}},r.prototype._debug=function(){var e=this,t=[].slice.call(arguments);t[0]="["+e._id+"] "+t[0],o.apply(null,t)},r.prototype._transformConstraints=function(e){var t=this;if(0===Object.keys(e).length)return e;if((e.mandatory||e.optional)&&!t._isChromium){var n=Object.assign({},e.optional,e.mandatory);return void 0!==n.OfferToReceiveVideo&&(n.offerToReceiveVideo=n.OfferToReceiveVideo,delete n.OfferToReceiveVideo),void 0!==n.OfferToReceiveAudio&&(n.offerToReceiveAudio=n.OfferToReceiveAudio,delete n.OfferToReceiveAudio),n}return e.mandatory||e.optional||!t._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e})}}).call(t,n(6).Buffer)},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(t,r){function i(e){return N.from(e)}function o(e){return N.isBuffer(e)||e instanceof B}function s(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?D(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}function a(e,t){M=M||n(5),e=e||{};var r=t instanceof M;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,o=e.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new q,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(z||(z=n(16).StringDecoder),this.decoder=new z(e.encoding),this.encoding=e.encoding)}function u(e){if(M=M||n(5),!(this instanceof u))return new u(e);this._readableState=new a(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),j.call(this)}function c(e,t,n,r,o){var s=e._readableState;if(null===t)s.reading=!1,g(e,s);else{var a;o||(a=f(s,t)),a?e.emit("error",a):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===N.prototype||(t=i(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):l(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?l(e,s,t,!1):b(e,s)):l(e,s,t,!1))):r||(s.reading=!1)}return d(s)}function l(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&y(e)),b(e,t)}function f(e,t){var n;return o(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function d(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function h(e){return e>=H?e=H:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function p(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=h(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function g(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,y(e)}}function y(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(W("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?L.nextTick(v,e):v(e))}function v(e){W("emit readable"),e.emit("readable"),E(e)}function b(e,t){t.readingMore||(t.readingMore=!0,L.nextTick(m,e,t))}function m(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(W("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function w(e){return function(){var t=e._readableState;W("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&I(e,"data")&&(t.flowing=!0,E(e))}}function _(e){W("readable nexttick read 0"),e.read(0)}function C(e,t){t.resumeScheduled||(t.resumeScheduled=!0,L.nextTick(S,e,t))}function S(e,t){t.reading||(W("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),E(e),t.flowing&&!t.reading&&e.read(0)}function E(e){var t=e._readableState;for(W("flow",t.flowing);t.flowing&&null!==e.read(););}function T(e,t){if(0===t.length)return null;var n;return t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=k(e,t.buffer,t.decoder),n}function k(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?P(e,t):R(e,t),r}function P(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}function R(e,t){var n=N.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0===(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}function A(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,L.nextTick(x,t,e))}function x(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var L=n(9);e.exports=u;var M,D=n(11);u.ReadableState=a;var I=(n(0).EventEmitter,function(e,t){return e.listeners(t).length}),j=n(13),N=n(7).Buffer,B=t.Uint8Array||function(){},U=n(8);U.inherits=n(4);var F=n(33),W=void 0;W=F&&F.debuglog?F.debuglog("stream"):function(){};var z,q=n(34),G=n(14);U.inherits(u,j);var Y=["error","close","destroy","pause","resume"];Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),u.prototype.destroy=G.destroy,u.prototype._undestroy=G.undestroy,u.prototype._destroy=function(e,t){this.push(null),t(e)},u.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=N.from(e,t),t=""),n=!0),c(this,e,t,!1,n)},u.prototype.unshift=function(e){return c(this,e,null,!0,!1)},u.prototype.isPaused=function(){return!1===this._readableState.flowing},u.prototype.setEncoding=function(e){return z||(z=n(16).StringDecoder),this._readableState.decoder=new z(e),this._readableState.encoding=e,this};var H=8388608;u.prototype.read=function(e){W("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return W("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?A(this):y(this),null;if(0===(e=p(e,t))&&t.ended)return 0===t.length&&A(this),null;var r=t.needReadable;W("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,W("length less than watermark",r)),t.ended||t.reading?(r=!1,W("reading or ended",r)):r&&(W("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=p(n,t)));var i;return i=e>0?T(e,t):null,null===i?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&A(this)),null!==i&&this.emit("data",i),i},u.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},u.prototype.pipe=function(e,t){function n(e,t){W("onunpipe"),e===d&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,o())}function i(){W("onend"),e.end()}function o(){W("cleanup"),e.removeListener("close",c),e.removeListener("finish",l),e.removeListener("drain",y),e.removeListener("error",u),e.removeListener("unpipe",n),d.removeListener("end",i),d.removeListener("end",f),d.removeListener("data",a),v=!0,!h.awaitDrain||e._writableState&&!e._writableState.needDrain||y()}function a(t){W("ondata"),b=!1,!1!==e.write(t)||b||((1===h.pipesCount&&h.pipes===e||h.pipesCount>1&&-1!==O(h.pipes,e))&&!v&&(W("false write response, pause",d._readableState.awaitDrain),d._readableState.awaitDrain++,b=!0),d.pause())}function u(t){W("onerror",t),f(),e.removeListener("error",u),0===I(e,"error")&&e.emit("error",t)}function c(){e.removeListener("finish",l),f()}function l(){W("onfinish"),e.removeListener("close",c),f()}function f(){W("unpipe"),d.unpipe(e)}var d=this,h=this._readableState;switch(h.pipesCount){case 0:h.pipes=e;break;case 1:h.pipes=[h.pipes,e];break;default:h.pipes.push(e)}h.pipesCount+=1,W("pipe count=%d opts=%j",h.pipesCount,t);var p=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr,g=p?i:f;h.endEmitted?L.nextTick(g):d.once("end",g),e.on("unpipe",n);var y=w(d);e.on("drain",y);var v=!1,b=!1;return d.on("data",a),s(e,"error",u),e.once("close",c),e.once("finish",l),e.emit("pipe",d),h.flowing||(W("pipe resume"),d.resume()),e},u.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=O(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},u.prototype.on=function(e,t){var n=j.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&y(this):L.nextTick(_,this))}return n},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){var e=this._readableState;return e.flowing||(W("resume"),e.flowing=!0,C(this,e)),this},u.prototype.pause=function(){return W("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(W("pause"),this._readableState.flowing=!1,this.emit("pause")),this},u.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;e.on("end",function(){if(W("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){if(W("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)){t.push(i)||(r=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<Y.length;o++)e.on(Y[o],this.emit.bind(this,Y[o]));return this._read=function(t){W("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(u.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),u._fromList=T}).call(t,n(1),n(3))},function(e,t,n){e.exports=n(0).EventEmitter},function(e,t,n){"use strict";function r(e,t){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||s.nextTick(o,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(s.nextTick(o,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)}function i(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function o(e,t){e.emit("error",t)}var s=n(9);e.exports={destroy:r,undestroy:i}},function(e,t,n){"use strict";(function(t,r,i){function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){P(t,e)}}function s(e){return D.from(e)}function a(e){return D.isBuffer(e)||e instanceof I}function u(){}function c(e,t){A=A||n(5),e=e||{};var r=t instanceof A;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,s=e.writableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===e.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){b(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function l(e){if(A=A||n(5),!(N.call(l,this)||this instanceof A))return new l(e);this._writableState=new c(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),M.call(this)}function f(e,t){var n=new Error("write after end");e.emit("error",n),R.nextTick(t,n)}function d(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),R.nextTick(r,o),i=!1),i}function h(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=D.from(t,n)),t}function p(e,t,n,r,i,o){if(!n){var s=h(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else g(e,t,!1,a,r,i,o);return u}function g(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function y(e,t,n,r,i){--t.pendingcb,n?(R.nextTick(i,r),R.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),T(e,t))}function v(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function b(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(v(n),t)y(e,n,r,t,i);else{var o=C(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?x(m,e,n,o,i):m(e,n,o,i)}}function m(e,t,n,r){n||w(e,t),t.pendingcb--,r(),T(e,t)}function w(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,u=!0;n;)i[a]=n,n.isBuf||(u=!1),n=n.next,a+=1;i.allBuffers=u,g(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t),t.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,l=n.encoding,f=n.callback;if(g(e,t,!1,t.objectMode?1:c.length,c,l,f),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function S(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),T(e,t)})}function E(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,R.nextTick(S,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function T(e,t){var n=C(t);return n&&(E(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}function k(e,t,n){t.ending=!0,T(e,t),n&&(t.finished?R.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function P(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}var R=n(9);e.exports=l;var A,x=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:R.nextTick;l.WritableState=c;var O=n(8);O.inherits=n(4);var L={deprecate:n(38)},M=n(13),D=n(7).Buffer,I=i.Uint8Array||function(){},j=n(14);O.inherits(l,M),c.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(c.prototype,"buffer",{get:L.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var N;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(l,Symbol.hasInstance,{value:function(e){return!!N.call(this,e)||this===l&&(e&&e._writableState instanceof c)}})):N=function(e){return e instanceof this},l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},l.prototype.write=function(e,t,n){var r=this._writableState,i=!1,o=!r.objectMode&&a(e);return o&&!D.isBuffer(e)&&(e=s(e)),"function"==typeof t&&(n=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=u),r.ended?f(this,n):(o||d(this,r,e,n))&&(r.pendingcb++,i=p(this,r,o,e,t,n)),i},l.prototype.cork=function(){this._writableState.corked++},l.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},l.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),l.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},l.prototype._writev=null,l.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||k(this,r,n)},Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),l.prototype.destroy=j.destroy,l.prototype._undestroy=j.undestroy,l.prototype._destroy=function(e,t){this.end(),t(e)}}).call(t,n(3),n(36).setImmediate,n(1))},function(e,t,n){"use strict";function r(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function i(e){var t=r(e);if("string"!=typeof t&&(b.isEncoding===m||!m(e)))throw new Error("Unknown encoding: "+e);return t||e}function o(e){this.encoding=i(e);var t;switch(this.encoding){case"utf16le":this.text=d,this.end=h,t=4;break;case"utf8":this.fillLast=c,t=4;break;case"base64":this.text=p,this.end=g,t=3;break;default:return this.write=y,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=b.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]),i>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0)}function u(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}function c(e){var t=this.lastTotal-this.lastNeed,n=u(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){var n=a(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)}function f(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t}function d(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function h(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function p(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function g(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function y(e){return e.toString(this.encoding)}function v(e){return e&&e.length?this.write(e):""}var b=n(7).Buffer,m=b.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=f,o.prototype.text=l,o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";function r(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function i(e){if(!(this instanceof i))return new i(e);a.call(this,e),this._transformState={afterTransform:r.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){s(e,t,n)}):s(this,null,null)}function s(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=i;var a=n(5),u=n(8);u.inherits=n(4),u.inherits(i,a),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var n=this;a.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={DC_PING:"PING",DC_PONG:"PONG",DC_SIGNAL:"SIGNAL",DC_OPEN:"OPEN",DC_REQUEST:"REQUEST",DC_REQUESTFAIL:"REQUEST_FAIL",DC_CLOSE:"CLOSE",DC_RESPONSE:"RESPONSE",DC_ERROR:"ERROR",DC_PIECE:"PIECE",DC_TIMEOUT:"TIMEOUT",DC_PIECE_ACK:"PIECE_ACK",DC_TRANSITION:"TRANSITION",DC_GRANT:"GRANT",DC_LACK:"LACK",DC_DISPLACE:"DISPLACE",DC_BITFIELD:"BITFIELD",DC_CHOKE:"CHOKE",DC_UNCHOKE:"UNCHOKE",DC_INTERESTED:"INTERESTED",DC_NOTINTERESTED:"NOT_INTERESTED",DC_HAVE:"HAVE",DC_LOST:"LOST",BM_LOST:"lost",SEGMENT:"segment",TRANSITION:"transition",DISPLACE:"displace",CONNECT:"connect",ADOPT:"adopt"},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.HybridLoader=t.RPClient=void 0;var i=n(42),o=r(i),s=n(45),a=r(s),u={wsSchedulerAddr:"ws://120.78.168.126:3389",transitionEnabled:!0,transitionCheckInterval:30,transitionTTL:2,transitionWaitTime:5,defaultUploadBW:524288,maxTransitionTries:1,maxGetParentsTries:3,defaultSubstreams:3};t.RPClient=o.default,t.HybridLoader=a.default,t.config=u},function(e,t,n){"use strict";var r=function(e){return e&&2===e.CLOSING},i=function(){return"undefined"!=typeof WebSocket&&r(WebSocket)},o=function(){return{constructor:i()?WebSocket:null,maxReconnectionDelay:1e4,minReconnectionDelay:1500,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,debug:!1}},s=function(e,t,n){Object.defineProperty(t,n,{get:function(){return e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})},a=function(e){return e.minReconnectionDelay+Math.random()*e.minReconnectionDelay},u=function(e,t){var n=t*e.reconnectionDelayGrowFactor;return n>e.maxReconnectionDelay?e.maxReconnectionDelay:n},c=["onopen","onclose","onmessage","onerror"],l=function(e,t,n){Object.keys(n).forEach(function(t){n[t].forEach(function(n){var r=n[0],i=n[1];e.addEventListener(t,r,i)})}),t&&c.forEach(function(n){e[n]=t[n]})},f=function(e,t,n){var i=this;void 0===n&&(n={});var c,d,h=0,p=0,g=!0,y=null,v={};if(!(this instanceof f))throw new TypeError("Failed to construct 'ReconnectingWebSocket': Please use the 'new' operator");var b=o();if(Object.keys(b).filter(function(e){return n.hasOwnProperty(e)}).forEach(function(e){return b[e]=n[e]}),!r(b.constructor))throw new TypeError("Invalid WebSocket constructor. Set `options.constructor`");var m=b.debug?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}:function(){},w=function(e,t){return setTimeout(function(){var n=new Error(t);n.code=e,Array.isArray(v.error)&&v.error.forEach(function(e){return(0,e[0])(n)}),c.onerror&&c.onerror(n)},0)},_=function(){if(m("handleClose",{shouldRetry:g}),p++,m("retries count:",p),p>b.maxRetries)return void w("EHOSTDOWN","Too many failed connection attempts");h=h?u(b,h):a(b),m("handleClose - reconnectDelay:",h),g&&setTimeout(C,h)},C=function(){if(g){m("connect");var n=c,r="function"==typeof e?e():e;c=new b.constructor(r,t),d=setTimeout(function(){m("timeout"),c.close(),w("ETIMEDOUT","Connection timeout")},b.connectionTimeout),m("bypass properties");for(var o in c)["addEventListener","removeEventListener","close","send"].indexOf(o)<0&&s(c,i,o);c.addEventListener("open",function(){clearTimeout(d),m("open"),h=a(b),m("reconnectDelay:",h),p=0}),c.addEventListener("close",_),l(c,n,v),c.onclose=c.onclose||y,y=null}};m("init"),C(),this.close=function(e,t,n){void 0===e&&(e=1e3),void 0===t&&(t="");var r=void 0===n?{}:n,i=r.keepClosed,o=void 0!==i&&i,s=r.fastClose,a=void 0===s||s,u=r.delay,l=void 0===u?0:u;if(m("close - params:",{reason:t,keepClosed:o,fastClose:a,delay:l,retriesCount:p,maxRetries:b.maxRetries}),g=!o&&p<=b.maxRetries,l&&(h=l),c.close(e,t),a){var f={code:e,reason:t,wasClean:!0};_(),c.removeEventListener("close",_),Array.isArray(v.close)&&v.close.forEach(function(e){var t=e[0],n=e[1];t(f),c.removeEventListener("close",t,n)}),c.onclose&&(y=c.onclose,c.onclose(f),c.onclose=null)}},this.send=function(e){c.send(e)},this.addEventListener=function(e,t,n){Array.isArray(v[e])?v[e].some(function(e){return e[0]===t})||v[e].push([t,n]):v[e]=[[t,n]],c.addEventListener(e,t,n)},this.removeEventListener=function(e,t,n){Array.isArray(v[e])&&(v[e]=v[e].filter(function(e){return e[0]!==t})),c.removeEventListener(e,t,n)}};e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=r(u),l=n(20),f=r(l),d=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.peerId=e,r.config=n,r.connected=!1,r._ws=r._init(e),r}return s(t,e),a(t,[{key:"_init",value:function(e){var t=this,n={maxRetries:this.config.wsMaxRetries,minReconnectionDelay:1e3*this.config.wsReconnectInterval},r="?id="+e,i=new f.default(this.config.wsSignalerAddr+r,void 0,n);return i.onopen=function(){t.connected=!0,t.onopen&&t.onopen()},i.push=i.send,i.send=function(t){var n=JSON.stringify(Object.assign({peer_id:e},t));if(1!==i.readyState)return setTimeout(function(){i.send(t)},1e3);i.push(n)},i.onmessage=function(e){t.onmessage&&t.onmessage(e)},i.onclose=function(){t.onclose&&t.onclose(),t.connected=!1},i}},{key:"sendSignal",value:function(e,t){var n={action:"signal",peer_id:this.peerId,to_peer_id:e,data:t};this.send(n)}},{key:"send",value:function(e){this._ws.send(e)}},{key:"close",value:function(){this._ws.close(),this._ws=null}}]),t}(c.default);t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.FragLoader=t.Tracker=void 0;var i=n(46),o=r(i),s=n(48),a=r(s),u={announce:"http://127.0.0.1:8080",neighbours:4,urgentOffset:3};t.Tracker=o.default,t.FragLoader=a.default,t.config=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),c=r(u),l=n(0),f=r(l),d=n(41),h=r(d),p=n(10),g=r(p),y=n(19),v=n(22),b=n(49),m=r(b),w=n(50),_=r(w),C=n(52),S=r(C),E=console.log,T=(new _.default).getResult(),k=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.config=Object.assign({},h.default,n),r.hlsjs=e,r.p2pEnabled=!1!==r.config.disableP2P,e.config.currLoaded=e.config.currPlay=0;var s=function t(n,i){var o=i.details.live;r.config.live=o;var s=e.url.split("?")[0];r._init(s),e.off(e.constructor.Events.LEVEL_LOADED,t)};return e.on(e.constructor.Events.LEVEL_LOADED,s),r}return s(t,e),a(t,null,[{key:"Events",get:function(){return c.default}},{key:"uaParserResult",get:function(){return T}}]),a(t,[{key:"_init",value:function(e){var t=this,n={browser:T.browser.name,device:"mobile"===T.device.type?"mobile":"PC",os:T.os.name};if(this.hlsjs.config.p2pEnabled=this.p2pEnabled,this.bufMgr=new m.default(this.config),this.hlsjs.config.bufMgr=this.bufMgr,"fastmesh"===this.config.engine)this.signaler=new y.RPClient(e,this.config,n),this.hlsjs.config.p2pLoader=this.signaler.scheduler,this.hlsjs.config.p2pLoader.bufMgr=this.bufMgr,this.hlsjs.config.fLoader=y.HybridLoader;else if("bt"===this.config.engine){var r=new u.Fetcher(this.config.key,S.default.sync(e),this.config.announce);this.signaler=new v.Tracker(r,this.config,n),this.signaler.scheduler.bufferManager=this.bufMgr,this.hlsjs.config.fLoader=v.FragLoader,this.hlsjs.config.scheduler=this.signaler.scheduler,this.hlsjs.config.fetcher=r}this.hlsjs.on(this.hlsjs.constructor.Events.FRAG_LOADING,function(e,n){E("FRAG_LOADING: "+n.frag.sn),t.signaler.currentLoadingSN=n.frag.sn}),this.signalTried=!1,this.hlsjs.on(this.hlsjs.constructor.Events.FRAG_LOADED,function(e,n){var r=n.frag.sn;if(t.hlsjs.config.currLoaded=r,t.signaler.currentLoadedSN=r,t.hlsjs.config.currLoadedDuration=n.frag.duration,!t.signalTried&&!t.signaler.connected&&t.config.p2pEnabled){var i=8*n.frag.loaded/n.frag.duration;t.signaler.scheduler.bitrate=Math.round(i),t.signaler.resumeP2P(),t.signalTried=!0}}),this.hlsjs.on(this.hlsjs.constructor.Events.FRAG_CHANGED,function(e,n){E("FRAG_CHANGED: "+n.frag.sn);var r=n.frag.sn;t.hlsjs.config.currPlay=r,t.signaler.currentPlaySN=r}),this.hlsjs.on(this.hlsjs.constructor.Events.DESTROYING,function(){t.signaler.destroy(),t.signaler=null})}},{key:"disableP2P",value:function(){E("disableP2P"),this.p2pEnabled&&(this.p2pEnabled=!1,this.config.p2pEnabled=this.hlsjs.config.p2pEnabled=this.p2pEnabled,this.signaler&&this.signaler.stopP2P())}},{key:"enableP2P",value:function(){E("enableP2P"),this.p2pEnabled||(this.p2pEnabled=!0,this.config.p2pEnabled=this.hlsjs.config.p2pEnabled=this.p2pEnabled,this.signaler&&this.signaler.resumeP2P())}}]),t}(f.default);k.WEBRTC_SUPPORT=g.default.WEBRTC_SUPPORT,k.version="0.0.1",t.default=k,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n,r){var i=[];if(r){for(var o=void 0,s=0;s<n-1;s++)o=e.slice(s*t,(s+1)*t),i.push(o);o=e.slice(e.byteLength-r,e.byteLength),i.push(o)}else for(var a=void 0,u=0;u<n;u++)a=e.slice(u*t,(u+1)*t),i.push(a);return i}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(10),l=r(c),f=n(0),d=r(f),h=n(18),p=r(h),g=n(6).Buffer,y=console.log,v=function(e){function t(e,n,r,s){i(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.config=s,a.remotePeerId=n,a.channelId=r?e+"-"+n:n+"-"+e,a.connected=!1,a.msgQueue=[],a.miss=0,a.rcvdReqQueue=[],a.downloading=!1,a.uploading=!1,a.delays=[],a._datachannel=new l.default({initiator:r,objectMode:!0}),a.isInitiator=r,a._init(a._datachannel),a.streamingRate=0,a.recordSended=a._adjustStreamingRate(10),a}return s(t,e),u(t,[{key:"_init",value:function(e){var t=this;e.on("error",function(e){y("datachannel error",e),t.emit(p.default.DC_ERROR)}),e.on("signal",function(e){t.emit(p.default.DC_SIGNAL,e)});var n=function(){for(y("datachannel CONNECTED to "+t.remotePeerId),t.connected=!0,t.emit(p.default.DC_OPEN),t._sendPing();t.msgQueue.length>0;){var e=t.msgQueue.shift();t.emit(e.event,e)}};e.once("connect",n),e.on("data",function(e){if("string"==typeof e){y("datachannel receive string: "+e+"from "+t.remotePeerId);var n=JSON.parse(e);if(!t.connected)return void t.msgQueue.push(n);switch(n.event){case p.default.DC_PONG:t._handlePongMsg();break;case p.default.DC_PING:t.sendJson({event:p.default.DC_PONG});break;case p.default.DC_PIECE:t._prepareForBinary(n.attachments,n.url,n.sn,n.size),t.emit(n.event,n);break;case p.default.DC_REQUEST:t._handleRequestMsg(n);break;case p.default.DC_GRANT:t._handleGrant(n);break;case p.default.DC_PIECE_ACK:t._handlePieceAck();break;default:t.emit(n.event,n)}}else e instanceof g&&(t.bufArr.push(e),0===--t.remainAttachments&&(window.clearTimeout(t.requestTimeout),t.requestTimeout=null,t.sendJson({event:p.default.DC_PIECE_ACK,sn:t.bufSN,url:t.bufUrl}),t._handleBinaryData()))}),e.once("close",function(){t.emit(p.default.DC_CLOSE)})}},{key:"sendJson",value:function(e){this.send(JSON.stringify(e))}},{key:"send",value:function(e){this._datachannel&&this._datachannel.connected&&this._datachannel.send(e)}},{key:"sendBitField",value:function(e){this.sendJson({event:p.default.DC_BITFIELD,field:e})}},{key:"sendBuffer",value:function(e,t,n){this.uploading=!0,this.uploadTimeout=window.setTimeout(this._uploadtimeout.bind(this),1e3*this.config.dcUploadTimeout);var r=n.byteLength,i=this.config.packetSize,o=0,s=0;r%i==0?s=r/i:(s=Math.floor(r/i)+1,o=r%i);var u={event:p.default.DC_PIECE,attachments:s,url:t,sn:e,size:r};this.sendJson(u);for(var c=a(n,i,s,o),l=0;l<c.length;l++)this.send(c[l]);this.recordSended(r)}},{key:"requestDataByURL",value:function(e){var t={event:p.default.DC_REQUEST,url:e};this.downloading=!0,this.sendJson(t),this.requestTimeout=window.setTimeout(this._loadtimeout.bind(this),1e3*this.config.dcRequestTimeout)}},{key:"requestDataBySN",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={event:p.default.DC_REQUEST,sn:e,urgent:t};this.downloading=!0,this.sendJson(n),this.requestTimeout=window.setTimeout(this._loadtimeout.bind(this),1e3*this.config.dcRequestTimeout)}},{key:"close",value:function(){this.destroy()}},{key:"receiveSignal",value:function(e){this._datachannel.signal(e)}},{key:"destroy",value:function(){window.clearInterval(this.adjustSRInterval),window.clearInterval(this.pinger),this._datachannel.removeAllListeners(),this.removeAllListeners(),this._datachannel.destroy()}},{key:"_handleRequestMsg",value:function(e){this.rcvdReqQueue.length>0?e.urgent?this.rcvdReqQueue.push(e.sn):this.rcvdReqQueue.unshift(e.sn):this.emit(p.default.DC_REQUEST,e)}},{key:"_handlePieceAck",value:function(){if(this.uploading=!1,window.clearTimeout(this.uploadTimeout),this.uploadTimeout=null,this.rcvdReqQueue.length>0){var e=this.rcvdReqQueue.pop();this.emit(p.default.DC_REQUEST,{sn:e})}}},{key:"_prepareForBinary",value:function(e,t,n,r){this.bufArr=[],this.remainAttachments=e,this.bufUrl=t,this.bufSN=n,this.expectedSize=r}},{key:"_handleBinaryData",value:function(){var e=g.concat(this.bufArr);e.byteLength==this.expectedSize&&this.emit(p.default.DC_RESPONSE,{url:this.bufUrl,sn:this.bufSN,data:e}),this.bufUrl="",this.bufArr=[],this.expectedSize=-1,this.downloading=!1}},{key:"_handleGrant",value:function(e){e.TTL>0&&this.emit(p.default.DC_GRANT,e)}},{key:"_adjustStreamingRate",value:function(e){var t=this,n=0;return this.adjustSRInterval=window.setInterval(function(){t.streamingRate=Math.round(8*n/e),n=0},1e3*e),function(e){n+=e}}},{key:"_loadtimeout",value:function(){if(y("datachannel timeout while downloading"),this.emit(p.default.DC_TIMEOUT),this.requestTimeout=null,this.downloading=!1,++this.miss>=this.config.dcTolerance){var e={event:p.default.DC_CLOSE};this.sendJson(e),this.emit(p.default.DC_ERROR)}}},{key:"_uploadtimeout",value:function(){if(y("datachannel timeout while uploading"),this.uploading=!1,this.rcvdReqQueue.length>0){var e=this.rcvdReqQueue.pop();this.emit(p.default.DC_REQUEST,{sn:e})}}},{key:"_sendPing",value:function(){var e=this;this.ping=performance.now();for(var t=0;t<this.config.dcPingPackets;t++)this.sendJson({event:p.default.DC_PING});window.setTimeout(function(){if(e.delays.length>0){var t=0,n=!0,r=!1,i=void 0;try{for(var o,s=e.delays[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){t+=o.value}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}e.delay=t/e.delays.length,e.delays=[]}},100)}},{key:"_handlePongMsg",value:function(){var e=performance.now()-this.ping;this.delays.push(e)}}]),t}(d.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-r(e)}function o(e){var t,n,i,o,s,a=e.length;o=r(e),s=new f(3*a/4-o),n=o>0?a-4:a;var u=0;for(t=0;t<n;t+=4)i=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],s[u++]=i>>16&255,s[u++]=i>>8&255,s[u++]=255&i;return 2===o?(i=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,s[u++]=255&i):1===o&&(i=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,s[u++]=i>>8&255,s[u++]=255&i),s}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function a(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(s(r));return i.join("")}function u(e){for(var t,n=e.length,r=n%3,i="",o=[],s=0,u=n-r;s<u;s+=16383)o.push(a(e,s,s+16383>u?u:s+16383));return 1===r?(t=e[n-1],i+=c[t>>2],i+=c[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=c[t>>10],i+=c[t>>4&63],i+=c[t<<2&63],i+="="),o.push(i),o.join("")}t.byteLength=i,t.toByteArray=o,t.fromByteArray=u;for(var c=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,p=d.length;h<p;++h)c[h]=d[h],l[d.charCodeAt(h)]=h;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,o=h&(1<<-l)-1,h>>=-l,l+=a;l>0;o=256*o+e[t+f],f+=d,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=c}return(h?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+f>=1?d/u:d*Math.pow(2,1-f),t*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*u-1)*Math.pow(2,i),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&a,h+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+h]=255&s,h+=p,s/=256,c-=8);e[n+h-p]|=128*g}},function(e,t,n){(function(r){function i(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)}}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function u(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}t=e.exports=n(28),t.log=s,t.formatArgs=o,t.save=a,t.load=u,t.useColors=i,t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(u())}).call(t,n(3))},function(e,t,n){function r(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}function i(e){function n(){if(n.enabled){var e=n,r=+new Date,o=r-(i||r);e.diff=o,e.prev=i,e.curr=r,i=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=s[u];n=i.call(e,o),s.splice(u,1),u--}return n}),t.formatArgs.call(e,s);(n.log||t.log||void 0).apply(e,s)}}var i;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=r(e),n.destroy=o,"function"==typeof t.init&&t.init(n),t.instances.push(n),n}function o(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function s(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&(e=r[n].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}}function a(){t.enable("")}function u(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i.debug=i.default=i,t.coerce=c,t.disable=a,t.enable=s,t.enabled=u,t.humanize=n(29),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*c;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function r(e){return e>=c?Math.round(e/c)+"d":e>=u?Math.round(e/u)+"h":e>=a?Math.round(e/a)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function i(e){return o(e,c,"day")||o(e,u,"hour")||o(e,a,"minute")||o(e,s,"second")||e+" ms"}function o(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,a=60*s,u=60*a,c=24*u,l=365.25*c;e.exports=function(e,t){t=t||{};var o=typeof e;if("string"===o&&e.length>0)return n(e);if("number"===o&&!1===isNaN(e))return t.long?i(e):r(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},function(e,t,n){"use strict";(function(t,r){function i(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}function o(e,n){if(e>65536)throw new Error("requested too many random bytes");var i=new t.Uint8Array(e);e>0&&a.getRandomValues(i);var o=s.from(i.buffer);return"function"==typeof n?r.nextTick(function(){n(null,o)}):o}var s=n(7).Buffer,a=t.crypto||t.msCrypto;a&&a.getRandomValues?e.exports=o:e.exports=i}).call(t,n(1),n(3))},function(e,t,n){t=e.exports=n(12),t.Stream=t,t.Readable=t,t.Writable=n(15),t.Duplex=n(5),t.Transform=n(17),t.PassThrough=n(39)},function(e,t){},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){e.copy(t,n)}var o=n(7).Buffer,s=n(35);e.exports=function(){function e(){r(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var t=o.allocUnsafe(e>>>0),n=this.head,r=0;n;)i(n.data,t,r),r+=n.data.length,n=n.next;return t},e}(),s&&s.inspect&&s.inspect.custom&&(e.exports.prototype[s.inspect.custom]=function(){var e=s.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(e){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(37),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,n(1))},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return c[u]=r,a(u),u++}function i(e){delete c[e]}function o(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function s(e){if(l)setTimeout(s,0,e);else{var t=c[e];if(t){l=!0;try{o(t)}finally{i(e),l=!1}}}}if(!e.setImmediate){var a,u=1,c={},l=!1,f=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?function(){a=function(e){t.nextTick(function(){s(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&s(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),a=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){s(e.data)},a=function(t){e.port2.postMessage(t)}}():f&&"onreadystatechange"in f.createElement("script")?function(){var e=f.documentElement;a=function(t){var n=f.createElement("script");n.onreadystatechange=function(){s(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){a=function(e){setTimeout(s,0,e)}}(),d.setImmediate=r,d.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(1),n(3))},function(e,t,n){(function(t){function n(e,t){function n(){if(!i){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation"),i=!0}return e.apply(this,arguments)}if(r("noDeprecation"))return e;var i=!1;return n}function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=n}).call(t,n(1))},function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}e.exports=r;var i=n(17),o=n(8);o.inherits=n(4),o.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(console.warn,function(){function e(t,n,i){r(this,e);var o="?key="+window.encodeURIComponent(t)+"&info_hash="+n;this.announceURL=i+"/announce/"+o,this.heartbeatURL=i+"/heartbeat/"+o,this.getPeersURL=i+"/get_peers/"+o,this.statsURL=i+"/stats/"+o,this.conns=0,this.failConns=0,this.cdnDownloaded=0,this.p2pDownloaded=0}return i(e,[{key:"btAnnounce",value:function(){var e=this;return new Promise(function(t,n){fetch(e.announceURL).then(function(e){return e.json()}).then(function(n){e.peerId=n.peer_id,t(n)}).catch(function(e){n(e)})})}},{key:"btHeartbeat",value:function(e){var t=this;this.heartbeater=window.setInterval(function(){fetch(t.heartbeatURL+"&peer_id="+t.peerId).then(function(e){}).catch(function(e){window.clearInterval(t.heartbeater)})},1e3*e)}},{key:"btGetPeers",value:function(){var e=this;return new Promise(function(t,n){fetch(e.getPeersURL+"&peer_id="+e.peerId).then(function(e){return e.json()}).then(function(e){t(e)}).catch(function(e){n(e)})})}},{key:"increConns",value:function(){this.conns++}},{key:"decreConns",value:function(){this.conns--}},{key:"increFailConns",value:function(){this.failConns++}},{key:"btStatsStart",value:function(e){var t=this;this.statser=window.setInterval(function(){var e={source:Math.round(t.cdnDownloaded/1024),p2p:Math.round(t.p2pDownloaded/1024)};0!==t.conns&&(e.conns=t.conns),t.failConns>0&&(e.failConns=t.failConns),fetch(t.statsURL+"&peer_id="+t.peerId,{method:"POST",body:JSON.stringify(e)}).then(function(e){e.ok&&(t.cdnDownloaded=0,t.p2pDownloaded=0,t.conns=0,t.failConns=0)}).catch(function(e){window.clearInterval(t.statser)})},1e3*e)}},{key:"reportFlow",value:function(e){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?this.cdnDownloaded+=e.total:this.p2pDownloaded+=e.total}},{key:"destroy",value:function(){window.clearInterval(this.statser),window.clearInterval(this.heartbeater)}}]),e}());t.default=o,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=n(22),o={key:"free",engine:"bt",wsSignalerAddr:"ws://120.78.168.126:8081/ws",wsMaxRetries:3,wsReconnectInterval:5,p2pEnabled:!0,dcKeepAliveInterval:10,dcKeepAliveAckTimeout:2,dcRequestTimeout:3,dcUploadTimeout:3,dcPingPackets:10,dcTolerance:4,packetSize:16384,maxBufSize:52428800,loadTimeout:5,reportInterval:20},s=void 0;s=Object.assign(o,r.config,i.config),t.default=s,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),l=r(c),f=n(2),d=r(f),h=n(43),p=r(h),g=n(20),y=r(g),v=n(21),b=r(v),m=function(e){function t(e,n,r){o(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=n,i.browserInfo=r,i.connected=!1,i.channel=e,i.scheduler=new p.default(n),i.DCMap=new Map,i.failedDCMap=new Map,n.wsSchedulerAddr=n.wsSchedulerAddr+"?key="+window.encodeURIComponent(n.key)+"&room="+window.encodeURIComponent(e)+"&mode="+window.encodeURIComponent(n.mode),i.schedulerWs=null,i.signalerWs=null,i._setupScheduler(i.scheduler),i.candidateParents=[],i.getParentsTimes=0,i}return a(t,e),u(t,[{key:"send",value:function(e){this.connected&&this.schedulerWs.send(e)}},{key:"stopP2P",value:function(){this.scheduler.clearAllStreamers(),this.schedulerWs.close(1e3,"",{keepClosed:!0,fastClose:!0})}},{key:"resumeP2P",value:function(){this.connected||(this.schedulerWs=this._initSchedulerWs(this.browserInfo))}},{key:"_setupScheduler",value:function(e){var t=this;this.tranPending=!1,e.on(f.Events.TRANSITION,function(){if(!t.tranPending){var e={action:"transition"};t.send(e),t.tranPending=!0}}).on(f.Events.CONNECT,function(e){e.forEach(function(e){t._createDatachannel(e.peer_id,!0,e.substreams)})}).on(f.Events.ADOPT,function(e){t._adoptAncestor(e)})}},{key:"_initSignalerWs",value:function(){var e=this,t=new b.default(this.peerId,this.config);return t.onopen=function(){e.connected=!0;var t={action:"get_parents"};e.schedulerWs&&e.schedulerWs.send(t)},t.onmessage=function(t){var n=JSON.parse(t.data),r=n.action;switch(r){case"signal":e._handleSignal(n.from_peer_id,n.data);break;case"reject":e.stopP2P()}},t.onclose=function(){e.connected=!1},t}},{key:"_initSchedulerWs",value:function(e){var t=this,n={maxRetries:this.config.wsMaxRetries,minReconnectionDelay:1e3*this.config.wsReconnectInterval},r=new y.default(this.config.wsSchedulerAddr,void 0,n);return r.onopen=function(){var n={action:"enter",channel:t.channel,ul_bw:Math.round(t.config.defaultUploadBW)};e&&(n=Object.assign(n,e)),r.push(JSON.stringify(n))},r.push=r.send,r.send=function(e){var n=JSON.stringify(Object.assign({channel:t.channel,peer_id:t.peerId},e));r.push(n)},r.onmessage=function(e){var n=JSON.parse(e.data),r=n.action;switch(r){case"signal":t._handleSignal(n.from_peer_id,n.data);break;case"parents":t._handleParentsMsg(n.nodes);break;case"connect":t._createDatachannel(n.to_peer_id,!0,1);break;case"disconnect":t._handleDisconnectMsg(n);break;case"accept":t._handleAcceptMsg(n);break;case"transition":t._handleTransitionMsg(n);break;case"adopt":t._handleAdoptMsg(n);break;case"reject":t.stopP2P()}},r.onclose=function(){t.connected=!1,t.scheduler.clearAllStreamers(),t.DCMap.clear()},r}},{key:"_handleSignal",value:function(e,t){var n=this.DCMap.get(e);n&&n.connected||(n||(n=this._createDatachannel(e,!1,1)),n.receiveSignal(t))}},{key:"_handleParentsMsg",value:function(e){var t=this;0!==e.length&&(e=e.filter(function(e){for(var n=[].concat(i(t.DCMap.keys()),i(t.failedDCMap.keys())),r=0;r<n.length;r++){var o=n[r];if(e.peer_id===o)return!1}return!0}),e.sort(function(e,t){return e.residual_bw-t.residual_bw}),this.candidateParents=e,e.length>0&&this._handleParents())}},{key:"_handleParents",value:function(){for(var e=this.candidateParents.pop();this.failedDCMap.get(e.peer_id)||e.peer_id===this.peerId;){if(0===this.candidateParents.length)return;e=this.candidateParents.pop()}var t=this.scheduler.substreams.substreamRate;if(e.residual_bw>=t){var n=Math.floor(e.residual_bw/t),r=this.scheduler.substreams.totalStreams-this.scheduler.substreams.streamCount;n=n>r?r:n,this._createDatachannel(e.peer_id,!0,n)}}},{key:"_handleAdoptMsg",value:function(e){if(e.parent_id){this.scheduler.clearUpstreamers();var t=this.scheduler.substreams.substreamRate,n=Math.floor(e.residual_bw/t);n=n>this.scheduler.substreams.totalStreams?this.scheduler.substreams.totalStreams:n,n=n>=1?n:1,this._createDatachannel(e.parent_id,!0,n)}}},{key:"_handleDisconnectMsg",value:function(e){}},{key:"_handleAcceptMsg",value:function(e){this.scheduler.peerId=this.peerId=e.peer_id,e.substreams&&(this.scheduler.substreams.totalStreams=e.substreams),this.signalerWs=this._initSignalerWs()}},{key:"_handleTransitionMsg",value:function(e){this.tranPending=!1,e.success&&this.scheduler.moveUpstreamsersToDown()}},{key:"_adoptAncestor",value:function(e){this.scheduler.upstreamers.forEach(function(e){});var t=this.scheduler.upstreamers.find(function(t){return t.remotePeerId===e});if(t){this.scheduler.exchangeWithStreamser(t);var n={action:"dc_closed",dc_id:t.channelId,substreams:t.copys,stream_rate:this.scheduler.substreams.substreamRate};return this.schedulerWs.send(n),t.channelId=e+"-"+this.peerId,n.action="dc_opened",n.dc_id=t.channelId,void this.schedulerWs.send(n)}var r={action:"adopt",to_peer_id:e};this.schedulerWs.send(r)}},{key:"_createDatachannel",value:function(e,t,n){n||(n=1);var r=new d.default(this.peerId,e,t,this.config);return this.DCMap.set(e,r),r.copys=n,this._setupDC(r),r}},{key:"_setupDC",value:function(e){var t=this;e.on(f.Events.DC_SIGNAL,function(n){t.signalerWs.sendSignal(e.remotePeerId,n)}).once(f.Events.DC_ERROR,function(){var n={action:"dc_failed",dc_id:e.channelId};if(t.schedulerWs.send(n),t.scheduler.deleteDataChannel(e),t.DCMap.delete(e.remotePeerId),t.failedDCMap.set(e.remotePeerId,!0),t.candidateParents.length>0)t._handleParents();else if(e.isReceiver&&t.scheduler.substreams.needMoreStreams()&&t.getParentsTimes<=t.config.maxGetParentsTries){var r={action:"get_parents"};t.schedulerWs.send(r),t.getParentsTimes++}e.destroy()}).once(f.Events.DC_CLOSE,function(){var n={action:"dc_closed",dc_id:e.channelId,substreams:e.copys,stream_rate:t.scheduler.substreams.substreamRate};if(t.schedulerWs.send(n),t.scheduler.deleteDataChannel(e),t.DCMap.delete(e.remotePeerId),e.isReceiver&&t.scheduler.substreams.needMoreStreams()&&t.getParentsTimes<=t.config.maxGetParentsTries){var r={action:"get_parents"};t.schedulerWs.send(r),t.getParentsTimes++}e.destroy()}).once(f.Events.DC_OPEN,function(){if(t.scheduler.addDataChannel(e),e.connected=!0,t.scheduler.transitioning?(t.scheduler.clearUpstreamers(),t.scheduler.transitioning=!1):t.candidateParents.length>0&&t.scheduler.substreams.needMoreStreams()?t._handleParents():t.candidateParents=[],e.isReceiver){var n={action:"dc_opened",dc_id:e.channelId,substreams:e.copys,stream_rate:t.scheduler.substreams.substreamRate};t.schedulerWs.send(n)}})}},{key:"destroy",value:function(){this.schedulerWs.close(),this.signalerWs.close(),this.schedulerWs=null,this.signalerWs=null}},{key:"currentPlaySN",set:function(e){this.scheduler.currentPlaySN=e}},{key:"currentLoadedSN",set:function(e){}}]),t}(l.default);t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n,r){var i=[];if(r){for(var o=void 0,s=0;s<n-1;s++)o=e.slice(s*t,(s+1)*t),i.push(o);o=e.slice(e.byteLength-r,e.byteLength),i.push(o)}else for(var a=void 0,u=0;u<n;u++)a=e.slice(u*t,(u+1)*t),i.push(a);return i}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),l=r(c),f=n(2),d=n(44),h=r(d),p=console.log,g=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.p2pConfig=e,n.upstreamers=[],n.downstreamers=[],n.expectedSeg=null,n.bufMgr=null,n.target=0,n._currPlaySN=-1,n.leadingCounter=0,n.substreams=new h.default(e),n.totalUploadBW=e.defaultUploadBW,e.transitionEnabled&&(n.tranInspectorId=n._setupTransInspector()),n.grantAncestors=[],n.transitioning=!1,n.transitionTries=0,n.targetAncestorId="",n}return s(t,e),u(t,[{key:"load",value:function(e,t,n){if(this.substreams.requestFromP2P){this.currUpstreamer=this.substreams.currentStreamer,this.context=e;var r=e.frag;this.expectedSeg={sn:r.sn,relurl:r.relurl},p("p2pLoader load "+r.relurl+" at "+r.sn+" from "+this.currUpstreamer.remotePeerId),this.callbacks=n,this.stats={trequest:performance.now(),retry:0,tfirst:0,tload:0,loaded:0},this.retryDelay=t.retryDelay;var i=Math.min(this.p2pConfig.loadTimeout,t.p2pTimeout);this.requestTimeout=window.setTimeout(this._loadtimeout.bind(this),1e3*i),this._loadInternal()}else e.frag.loadByXhr=!0,this.sourceStreamer.load(e,t,n),this.substreams.adjustTarget()}},{key:"abort",value:function(){p("p2pLoader abort"),this.expectedSeg=null,this.currUpstreamer.clearQueue()}},{key:"destroy",value:function(){p("p2pLoader destroy"),clearInterval(this.tranInspectorId)}},{key:"_loadInternal",value:function(){this.substreams.requestData(this.context.frag.relurl)}},{key:"_addUpStreamer",value:function(e){this.upstreamers.push(e),this.substreams.addSubstreams(e,e.copys),this._setupChannel(e)}},{key:"_loadtimeout",value:function(){p("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null),this.requestTimeout=null,this.leadingCounter=0}},{key:"_addDownStreamer",value:function(e){this.downstreamers.push(e),this._setupChannel(e)}},{key:"addDataChannel",value:function(e){e.isReceiver?this._addUpStreamer(e):this._addDownStreamer(e)}},{key:"deleteDataChannel",value:function(e){p("delete datachannel "+e.channelId),e.isReceiver?(this.substreams.deleteSubstream(e.remotePeerId),this.upstreamers=this.upstreamers.filter(function(t){return t!==e})):this.downstreamers=this.downstreamers.filter(function(t){return t!==e})}},{key:"moveUpstreamsersToDown",value:function(){for(var e={event:f.Events.DC_DISPLACE};this.upstreamers.length>0;){var t=this.upstreamers.pop();t.isReceiver=!t.isReceiver,this.downstreamers.push(t),t.send(JSON.stringify(e))}this.substreams.clear()}},{key:"clearUpstreamers",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.upstreamers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,s={event:f.Events.DC_CLOSE};o.send(JSON.stringify(s)),o.destroy()}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this.upstreamers=[],this.substreams.clear()}},{key:"clearDownstreamers",value:function(){for(var e=0;e<this.downstreamers.length;++e){var t=this.downstreamers.pop(),n={event:f.Events.DC_CLOSE};t.send(JSON.stringify(n)),t.destroy()}}},{key:"exchangeWithStreamser",value:function(e){var t={event:f.Events.DC_DISPLACE};e.isReceiver?(this.upstreamers=this.upstreamers.filter(function(t){return t.remotePeerId!==e.remotePeerId}),this.downstreamers.push(e),this.substreams.deleteSubstream(e.remotePeerId),t.substreams=e.copys):(this.downstreamers=this.downstreamers.filter(function(t){return t.remotePeerId!==e.remotePeerId}),this.upstreamers.unshift(e),this.substreams.addSubstreams(e,1)),e.isReceiver=!e.isReceiver,e.send(JSON.stringify(t))}},{key:"clearAllStreamers",value:function(){this.clearUpstreamers(),this.clearDownstreamers()}},{key:"broadcastToUpstreamers",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.upstreamers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.send(JSON.stringify(e))}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"broadcastToDownstreamers",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.downstreamers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.send(JSON.stringify(e))}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_setupChannel",value:function(e){var t=this;e.on(f.Events.DC_REQUEST,function(n){var r=n.sn,i=n.url;if(p("receive request sn "+r+" url "+i+" from "+e.remotePeerId),t.bufMgr){var o=void 0;if(t.bufMgr.hasSegOfURL(i)&&(o=t.bufMgr.getSegByURL(i)),o){p("bufMgr found seg sn "+r+" url "+o.relurl);var s=o.data,u=o.size,c=t.p2pConfig.packetSize,l=0,d=0;u%c==0?d=u/c:(d=Math.floor(u/c)+1,l=u%c);var h={event:f.Events.DC_PIECE,attachments:d,url:o.relurl,sn:o.sn,size:s.byteLength};e.send(JSON.stringify(h));for(var g=a(s,c,d,l),y=0;y<g.length;y++)e.send(g[y]);p("datachannel send binary data total size "+s.byteLength),e.recordSended(h.size)}else{var v={event:f.Events.DC_LACK,url:i,current:t._currPlaySN};e.send(JSON.stringify(v))}}}).on(f.Events.DISPLACE,function(n){var r=e.channelId;e.isReceiver=!e.isReceiver,t.downstreamers=t.downstreamers.filter(function(e){return e.channelId!==r}),t.upstreamers.unshift(e),t.substreams.addSubstreams(e,n.substreams)}).on(f.Events.DC_GRANT,function(e){e.to_peer_id===t.peerId?t.grantAncestors.push(e):(e.TTL--,t.broadcastToDownstreamers(e))}),e.on(f.Events.DC_RESPONSE,function(n){if(p("receive response sn "+n.sn+" url "+n.url+" size "+n.data.byteLength+" from "+e.remotePeerId),t.expectedSeg&&n.url===t.expectedSeg.relurl&&t.requestTimeout){if(window.clearTimeout(t.requestTimeout),t.requestTimeout=null,!t.stats.tload){var r=t.stats;r.tload=Math.max(r.tfirst,performance.now()),r.loaded=r.total=n.data.byteLength;var i=t.callbacks.onProgress;i&&i(r,t.context,null)}t.callbacks.onSuccess(n,t.stats,t.context)}else t.bufMgr&&!t.bufMgr.hasSegOfURL(n.url)&&t.bufMgr.addBuffer(n.sn,n.url,n.data)}).on(f.Events.DC_REQUESTFAIL,function(e){}).on(f.Events.DC_PIECE,function(){t.stats.tfirst||(t.stats.tfirst=Math.max(performance.now(),t.stats.trequest))}).on(f.Events.DC_TRANSITION,function(n){if(n.TTL>0&&(n.TTL--,t.upstreamers.length>0&&t.broadcastToUpstreamers(n),n.ul_bw>t.totalUploadBW)){var r=[],i=!0,o=!1,s=void 0;try{for(var a,u=t.upstreamers[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;r.push({peer_id:c.remotePeerId,substreams:c.copys})}}catch(e){o=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw s}}var l={event:f.Events.DC_GRANT,delay:0,TTL:n.source_TTL-n.TTL,parents:r,from_peer_id:t.peerId,to_peer_id:n.from_peer_id};e.send(JSON.stringify(l))}})}},{key:"_setupTransInspector",value:function(){var e=this;return window.setInterval(function(){if(e.residualBW>e.totalUploadBW/2&&e.upstreamers.length){var t={event:f.Events.DC_TRANSITION,ul_bw:e.totalUploadBW,TTL:e.p2pConfig.transitionTTL,source_TTL:e.p2pConfig.transitionTTL,from_peer_id:e.peerId};e.broadcastToUpstreamers(t),window.setTimeout(function(){if(0!==e.grantAncestors.length){e.grantAncestors.sort(function(e,t){return t.delay-e.delay}),e.transitioning=!0;var t=e.grantAncestors.pop();e.targetAncestorId=t.from_peer_id,t.parents.length>0?e.emit(f.Events.CONNECT,t.parents):e.emit(f.Events.ADOPT,t.from_peer_id),e.grantAncestors=[]}},1e3*e.p2pConfig.transitionWaitTime),e.transitionTries++,e.transitionTries===e.p2pConfig.maxTransitionTries&&window.clearInterval(e.tranInspectorId)}},1e3*this.p2pConfig.transitionCheckInterval)}},{key:"hasUpstreamer",get:function(){return this.upstreamers.length>0}},{key:"hasDownstreamer",get:function(){return this.downstreamers.length>0}},{key:"residualBW",get:function(){return this.totalUploadBW-this.uploadSR}},{key:"uploadSR",get:function(){var e=0,t=!0,n=!1,r=void 0;try{for(var i,o=this.downstreamers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){e+=i.value.streamingRate}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e}},{key:"currentPlaySN",set:function(e){this._currPlaySN=e}},{key:"bitrate",set:function(e){this.substreams.bitrate=e}}]),t}(l.default);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.bitrate=0,n.totalStreams=e.defaultSubstreams,n.target=0,n.streams=[],n}return o(t,e),s(t,[{key:"requestData",value:function(e){var t=this.streams[this.target];t.clearQueue(),t.requestData(e),this.adjustTarget()}},{key:"adjustTarget",value:function(){this.target=this.target>=this.totalStreams-1?0:this.target+1}},{key:"clear",value:function(){this.streams.length>0&&(this.streams=[])}},{key:"addSubstreams",value:function(e,t){for(var n=0;n<t&&!(this.streams.length>=this.totalStreams);++n)this.streams.push(e)}},{key:"deleteSubstream",value:function(e){this.streams=this.streams.filter(function(t){return t.remotePeerId!==e})}},{key:"needMoreStreams",value:function(){return this.streams.length<this.totalStreams}},{key:"substreamRate",get:function(){return Math.round(this.bitrate/this.totalStreams)}},{key:"streamCount",get:function(){return this.streams.length}},{key:"requestFromP2P",get:function(){return this.target<this.streams.length}},{key:"currentStreamer",get:function(){return this.streams[this.target]}},{key:"p2pStreamRate",get:function(){return this.substreamRate*this.streamCount}}]),t}(u.default);t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=console.log,l=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.currLoaded=e.currLoaded,n.currLoadedDuration=e.currLoadedDuration,n.currPlay=e.currPlay,n.bufMgr=e.bufMgr,n.xhrLoader=new e.loader(e),n.p2pLoader=e.p2pLoader,n.p2pLoader.sourceStreamer=n.xhrLoader,n.p2pEnabled=e.p2pEnabled,n.loader=n.xhrLoader,n}return o(t,e),s(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,t,n){var r=this,i=e.frag;this.loadByP2P=i.sn-this.currPlay>1&&i.sn-this.currLoaded==1&&this.currLoaded-this.currPlay>=1&&this.p2pLoader.hasUpstreamer,c("loading "+i.sn+" loaded "+this.currLoaded+" play "+this.currPlay+" loaded by "+(this.loadByP2P?"P2P":"HTTP")),this.p2pEnabled&&this.loadByP2P?(t.p2pTimeout=this.currLoadedDuration,this.loader=this.p2pLoader):(c("xhrLoader load "+i.relurl+" at "+i.sn),this.loader=this.xhrLoader,e.frag.loadByXhr=!0);var o=n.onSuccess;n.onSuccess=function(e,t,n){r.bufMgr&&!r.bufMgr.hasSegOfURL(i.relurl)&&r.bufMgr.copyAndAddBuffer(e.data,i.relurl,i.sn),o(e,t,n)};var s=n.onTimeout;n.onTimeout=function(e,i){i.frag.loadByXhr&&r.p2pLoader.hasUpstreamer&&r.p2pEnabled?(c("last loaded by xhr"),i.frag.loadByXhr=!1,r.p2pLoader.load(i,t,n)):s(e,i,null)},this.loader.load(e,t,n)}}]),t}(u.default);t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),l=r(c),f=n(47),d=r(f),h=n(21),p=r(h),g=n(2),y=function(e){function t(e,n,r){o(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.config=n,i.browserInfo=r,i.connected=!1,i.scheduler=new d.default(n),i.DCMap=new Map,i.failedDCSet=new Set,i.signalerWs=null,i.heartbeatInterval=30,i.fetcher=e,i.peers=[],i._setupScheduler(i.scheduler),i}return a(t,e),u(t,[{key:"resumeP2P",value:function(){var e=this;this.fetcher.btAnnounce().then(function(t){e.peerId=t.peer_id,e.fetcher.btHeartbeat(t.heartbeat_interval),e.fetcher.btStatsStart(t.report_interval),e.signalerWs=e._initSignalerWs(),e._handlePeers(t.peers)}).catch(function(e){})}},{key:"destroy",value:function(){window.clearInterval(this.heartbeater),this.heartbeater=null}},{key:"_handlePeers",value:function(e){var t=this,n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var u=s.value;this.peers.push({id:u.id})}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}this.peers=this.peers.filter(function(e){for(var n=[].concat(i(t.DCMap.keys()),i(t.failedDCSet.keys())),r=0;r<n.length;r++){var o=n[r];if(e.id===o)return!1}return!0})}},{key:"_tryConnectToPeer",value:function(){if(0!==this.peers.length){var e=this.peers.pop().id,t=new g.DataChannel(this.peerId,e,!0,this.config);this.DCMap.set(e,t),this._setupDC(t)}}},{key:"_setupDC",value:function(e){var t=this;e.on(g.Events.DC_SIGNAL,function(n){t.signalerWs.sendSignal(e.remotePeerId,n),t.signalTimer||(t.signalTimer=window.setTimeout(function(){t.DCMap.delete(e.remotePeerId),t.failedDCSet.add(e.remotePeerId),t.signalTimer=null,t._tryConnectToPeer()},2e3))}).once(g.Events.DC_ERROR,function(){t.scheduler.deletePeer(e),t.DCMap.delete(e.remotePeerId),t.failedDCSet.add(e.remotePeerId),t._tryConnectToPeer(),e.destroy(),t._requestMorePeers(),e.isInitiator&&(e.connected?t.fetcher.decreConns():t.fetcher.increFailConns())}).once(g.Events.DC_CLOSE,function(){t.scheduler.deletePeer(e),t.DCMap.delete(e.remotePeerId),t.failedDCSet.add(e.remotePeerId),t._tryConnectToPeer(),e.destroy(),t._requestMorePeers(),t.fetcher.decreConns()}).once(g.Events.DC_OPEN,function(){t.scheduler.handshakePeer(e),t.DCMap.size<t.config.neighbours&&t._tryConnectToPeer(),t.fetcher.increConns()})}},{key:"_initSignalerWs",value:function(){var e=this,t=new p.default(this.peerId,this.config);return t.onopen=function(){e.connected=!0,e._tryConnectToPeer()},t.onmessage=function(t){var n=JSON.parse(t.data),r=n.action;switch(r){case"signal":window.clearTimeout(e.signalTimer),e.signalTimer=null,e._handleSignal(n.from_peer_id,n.data);break;case"reject":e.stopP2P()}},t.onclose=function(){e.connected=!1,e.destroy()},t}},{key:"_handleSignal",value:function(e,t){var n=this.DCMap.get(e);if(!n||!n.connected){if(!n){if(this.failedDCSet.has(e))return;n=new g.DataChannel(this.peerId,e,!1,this.config),this.DCMap.set(e,n),this._setupDC(n)}n.receiveSignal(t)}}},{key:"_setupScheduler",value:function(e){}},{key:"_heartbeat",value:function(){var e=this;this.heartbeater=window.setInterval(function(){e.fetcher.btHeartbeat()},1e3*this.heartbeatInterval)}},{key:"_requestMorePeers",value:function(){var e=this;this.scheduler.peerMap.size<=Math.floor(this.config.neighbours/2)&&this.fetcher.btGetPeers().then(function(t){e._handlePeers(t.peers),e._tryConnectToPeer()})}},{key:"currentPlaySN",set:function(e){this.scheduler.updatePlaySN(e)}},{key:"currentLoadingSN",set:function(e){this.scheduler.updateLoadingSN(e)}},{key:"currentLoadedSN",set:function(e){this.scheduler.updateLoadedSN(e)}}]),t}(l.default);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=function(e){return e&&e.__esModule?e:{default:e}}(u),l=n(2),f=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.config=e,n.bufMgr=null,n.peerMap=new Map,n.bitset=new Set,n.bitCounts=new Map,n}return s(t,e),a(t,[{key:"updateLoadedSN",value:function(e){if(this.bitset.add(e),this.bitCounts.has(e)&&this.bitCounts.delete(e),this.peerMap.size>0){var t={event:l.Events.DC_HAVE,sn:e};this._broadcastToPeers(t)}}},{key:"updateLoadingSN",value:function(e){this.loadingSN=e}},{key:"updatePlaySN",value:function(e){if(!this.config.live&&this.hasPeers){for(var t=[],n=e+1;n<=e+this.config.urgentOffset+1;n++)if(!this.bitset.has(n)&&n!==this.loadingSN&&this.bitCounts.has(n)){var i=!0,o=!1,s=void 0;try{for(var a,u=this.peerMap.values()[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;if(!1===c.downloading&&c.bitset.has(n)){c.requestDataBySN(n,!0),t.push(n);break}}}catch(e){o=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw s}}}var l=this._getIdlePeer();if(0!==l.length&&0!==this.bitCounts.size&&!this.bufMgr.overflowed){var f=[].concat(r(this.bitCounts.entries())).sort(function(e,t){return e[1]<t[1]});if(0!==f.length){for(var d=f.pop()[0];d===this.loadingSN||t.includes(d);){if(0===f.length)return;d=f.pop()[0]}var h=!0,p=!1,g=void 0;try{for(var y,v=l[Symbol.iterator]();!(h=(y=v.next()).done);h=!0){var b=y.value;if(b.bitset.has(d)){b.requestDataBySN(d,!1);break}}}catch(e){p=!0,g=e}finally{try{!h&&v.return&&v.return()}finally{if(p)throw g}}}}}}},{key:"deletePeer",value:function(e){var t=this;this.peerMap.has(e.remotePeerId)&&(e.bitset.forEach(function(e){t._decreBitCounts(e)}),this.peerMap.delete(e.remotePeerId))}},{key:"handshakePeer",value:function(e){this._setupDC(e),e.sendBitField(Array.from(this.bitset))}},{key:"addPeer",value:function(e){this.peerMap.set(e.remotePeerId,e)}},{key:"peersHasSN",value:function(e){return this.bitCounts.has(e)}},{key:"load",value:function(e,t,n){this.context=e;var r=e.frag;this.callbacks=n,this.stats={trequest:performance.now(),retry:0,tfirst:0,tload:0,loaded:0},this.criticalSeg={sn:r.sn,relurl:r.relurl};var i=void 0,o=!0,s=!1,a=void 0;try{for(var u,c=this.peerMap.values()[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;l.bitset.has(r.sn)&&(i=l)}}catch(e){s=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}i&&i.requestDataBySN(r.sn,!0),this.criticaltimeouter=window.setTimeout(this._criticaltimeout.bind(this),1e3*this.config.loadTimeout)}},{key:"_setupDC",value:function(e){var t=this;e.on(l.Events.DC_BITFIELD,function(n){if(n.field){var r=new Set(n.field);e.bitset=r,n.field.forEach(function(e){t.bitset.has(e)||t._increBitCounts(e)}),t.addPeer(e)}}).on(l.Events.DC_HAVE,function(n){if(n.sn&&e.bitset){var r=n.sn;e.bitset.add(r),t.bitset.has(r)||t._increBitCounts(r)}}).on(l.Events.DC_LOST,function(n){if(n.sn&&e.bitset){var r=n.sn;e.bitset.delete(r),t._decreBitCounts(r)}}).on(l.Events.DC_PIECE,function(e){t.criticalSeg&&t.criticalSeg.sn===e.sn&&(t.stats.tfirst=Math.max(performance.now(),t.stats.trequest))}).on(l.Events.DC_RESPONSE,function(e){if(t.criticalSeg&&t.criticalSeg.sn===e.sn&&t.criticaltimeouter){window.clearTimeout(t.criticaltimeouter),t.criticaltimeouter=null;var n=t.stats;n.tload=Math.max(n.tfirst,performance.now()),n.loaded=n.total=e.data.byteLength,t.criticalSeg=null,t.callbacks.onSuccess(e,n,t.context)}else t.bufMgr.addBuffer(e.sn,e.url,e.data);t.updateLoadedSN(e.sn)}).on(l.Events.DC_REQUEST,function(n){var r=t.bufMgr.getURLbySN(n.sn);if(r&&t.bufMgr.hasSegOfURL(r)){var i=t.bufMgr.getSegByURL(r);e.sendBuffer(n.sn,i.relurl,i.data)}}).on(l.Events.DC_TIMEOUT,function(){})}},{key:"_broadcastToPeers",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.peerMap.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.sendJson(e)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"_getIdlePeer",value:function(){return[].concat(r(this.peerMap.values())).filter(function(e){return!1===e.downloading})}},{key:"_decreBitCounts",value:function(e){if(this.bitCounts.has(e)){var t=this.bitCounts.get(e);1===t?this.bitCounts.delete(e):this.bitCounts.set(e,t-1)}}},{key:"_increBitCounts",value:function(e){if(this.bitCounts.has(e)){var t=this.bitCounts.get(e);this.bitCounts.set(e,t+1)}else this.bitCounts.set(e,1)}},{key:"_criticaltimeout",value:function(){this.criticalSeg=null,this.callbacks.onTimeout(this.stats,this.context,null),this.criticaltimeouter=null}},{key:"hasPeers",get:function(){return this.peerMap.size>0}},{key:"bufferManager",set:function(e){var t=this;this.bufMgr=e,e.on(l.Events.BM_LOST,function(e){t._broadcastToPeers({event:l.Events.DC_LOST,sn:e}),t.bitset.delete(e)})}}]),t}(c.default);t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=console.log,l=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.currLoaded=e.currLoaded,n.currLoadedDuration=e.currLoadedDuration,n.currPlay=e.currPlay,n.bufMgr=e.bufMgr,n.xhrLoader=new e.loader(e),n.p2pEnabled=e.p2pEnabled,n.scheduler=e.scheduler,n.fetcher=e.fetcher,n}return o(t,e),s(t,[{key:"destroy",value:function(){this.abort()}},{key:"abort",value:function(){this.xhrLoader.abort()}},{key:"load",value:function(e,t,n){var r=this,i=e.frag;if(this.bufMgr.hasSegOfURL(i.relurl)){var o=this.bufMgr.getSegByURL(i.relurl),s={url:e.url,data:o.data},a=void 0,u=void 0,l=void 0,f=void 0,d=void 0;a=performance.now(),u=l=a+50,f=d=i.loaded=o.size;var h={trequest:a,tfirst:u,tload:l,loaded:f,total:d,retry:0};window.setTimeout(function(){r.fetcher.reportFlow(h,!0),n.onSuccess(s,h,e)},50)}else if(this.scheduler.peersHasSN(i.sn)){this.scheduler.load(e,t,n),n.onTimeout=function(e,o){c("xhrLoader load "+i.relurl+" at "+i.sn),o.frag.loadByXhr=!0,r.xhrLoader.load(o,t,n)};var p=n.onSuccess;n.onSuccess=function(e,t,n){r.bufMgr.hasSegOfURL(i.relurl)||r.bufMgr.copyAndAddBuffer(e.data,i.relurl,i.sn),r.fetcher.reportFlow(t,!0),i.loaded=t.loaded,p(e,t,n)}}else{c("xhrLoader load "+i.relurl+" at "+i.sn),e.frag.loadByXhr=!0,this.xhrLoader.load(e,t,n);var g=n.onSuccess;n.onSuccess=function(e,t,n){r.bufMgr.hasSegOfURL(i.relurl)||r.bufMgr.copyAndAddBuffer(e.data,i.relurl,i.sn),r.fetcher.reportFlow(t,!1),g(e,t,n)}}}}]),t}(u.default);t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),c=function(e){return e&&e.__esModule?e:{default:e}}(u),l=n(2),f=console.log,d=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.config=e,n._segPool=new Map,n._currBufSize=0,n.sn2Url=new Map,n.overflowed=!1,n}return s(t,e),a(t,[{key:"hasSegOfURL",value:function(e){return this._segPool.has(e)}},{key:"copyAndAddBuffer",value:function(e,t,n){var r=l.Buffer.from(e),i=r.byteLength,o=new l.Buffer(i);r.copy(o);var s={sn:n,relurl:t,data:o,size:i};this.addSeg(s),this.sn2Url.set(n,t)}},{key:"addBuffer",value:function(e,t,n){f("addBuffer sn "+e+" relurl "+t);var r={sn:e,relurl:t,data:n,size:n.byteLength};this.addSeg(r),this.sn2Url.set(e,t)}},{key:"addSeg",value:function(e){for(f("add seg "+e.sn+" url "+e.relurl+" size "+e.data.byteLength),this._segPool.set(e.relurl,e),this._currBufSize+=parseInt(e.size);this._currBufSize>this.config.maxBufSize;){var t=[].concat(r(this._segPool.values())).shift();this._segPool.delete(t.relurl),this.sn2Url.delete(t.sn),this._currBufSize-=parseInt(t.size),this.overflowed||(this.overflowed=!0),this.emit(l.Events.BM_LOST,t.sn)}}},{key:"getSegByURL",value:function(e){return this._segPool.get(e)}},{key:"getURLbySN",value:function(e){return this.sn2Url.get(e)}},{key:"clear",value:function(){this._segPool.clear(),this.sn2Url.clear(),this._currBufSize=0}},{key:"currBufSize",get:function(){return this._currBufSize}}]),t}(c.default);t.default=d,e.exports=t.default},function(e,t,n){var r;!function(i,o){"use strict";var s="model",a="name",u="type",c="vendor",l="version",f="mobile",d="tablet",h={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},p={rgx:function(e,t){for(var n,r,i,o,s,a,u=0;u<t.length&&!s;){var c=t[u],l=t[u+1];for(n=r=0;n<c.length&&!s;)if(s=c[n++].exec(e))for(i=0;i<l.length;i++)a=s[++r],o=l[i],"object"==typeof o&&o.length>0?2==o.length?"function"==typeof o[1]?this[o[0]]=o[1].call(this,a):this[o[0]]=o[1]:3==o.length?"function"!=typeof o[1]||o[1].exec&&o[1].test?this[o[0]]=a?a.replace(o[1],o[2]):void 0:this[o[0]]=a?o[1].call(this,a,o[2]):void 0:4==o.length&&(this[o[0]]=a?o[3].call(this,a.replace(o[1],o[2])):void 0):this[o]=a||void 0;u+=2}},str:function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(h.has(t[n][r],e))return"?"===n?void 0:n}else if(h.has(t[n],e))return"?"===n?void 0:n;return e}},g={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[a,l],[/(opios)[\/\s]+([\w\.]+)/i],[[a,"Opera Mini"],l],[/\s(opr)\/([\w\.]+)/i],[[a,"Opera"],l],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[a,l],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[a,"IE"],l],[/(edge)\/((\d+)?[\w\.]+)/i],[a,l],[/(yabrowser)\/([\w\.]+)/i],[[a,"Yandex"],l],[/(puffin)\/([\w\.]+)/i],[[a,"Puffin"],l],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[a,"UCBrowser"],l],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],l],[/(micromessenger)\/([\w\.]+)/i],[[a,"WeChat"],l],[/(QQ)\/([\d\.]+)/i],[a,l],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[a,l],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[l,[a,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[l,[a,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[l,[a,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[a,/(.+)/,"$1 WebView"],l],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[a,/(.+(?:g|us))(.+)/,"$1 $2"],l],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[l,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[a,l],[/(dolfin)\/([\w\.]+)/i],[[a,"Dolphin"],l],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[a,"Chrome"],l],[/(coast)\/([\w\.]+)/i],[[a,"Opera Coast"],l],[/fxios\/([\w\.-]+)/i],[l,[a,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[l,[a,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[l,a],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[a,"GSA"],l],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[a,[l,p.str,g.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[a,l],[/(navigator|netscape)\/([\w\.-]+)/i],[[a,"Netscape"],l],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[a,l]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",h.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",h.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",h.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[s,c,[u,d]],[/applecoremedia\/[\w\.]+ \((ipad)/],[s,[c,"Apple"],[u,d]],[/(apple\s{0,1}tv)/i],[[s,"Apple TV"],[c,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[c,s,[u,d]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[s,[c,"Amazon"],[u,d]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[s,p.str,g.device.amazon.model],[c,"Amazon"],[u,f]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[s,c,[u,f]],[/\((ip[honed|\s\w*]+);/i],[s,[c,"Apple"],[u,f]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[c,s,[u,f]],[/\(bb10;\s(\w+)/i],[s,[c,"BlackBerry"],[u,f]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[s,[c,"Asus"],[u,d]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[c,"Sony"],[s,"Xperia Tablet"],[u,d]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[s,[c,"Sony"],[u,f]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[c,s,[u,"console"]],[/android.+;\s(shield)\sbuild/i],[s,[c,"Nvidia"],[u,"console"]],[/(playstation\s[34portablevi]+)/i],[s,[c,"Sony"],[u,"console"]],[/(sprint\s(\w+))/i],[[c,p.str,g.device.sprint.vendor],[s,p.str,g.device.sprint.model],[u,f]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[c,s,[u,d]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[c,[s,/_/g," "],[u,f]],[/(nexus\s9)/i],[s,[c,"HTC"],[u,d]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[s,[c,"Huawei"],[u,f]],[/(microsoft);\s(lumia[\s\w]+)/i],[c,s,[u,f]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[s,[c,"Microsoft"],[u,"console"]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[c,"Microsoft"],[u,f]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[s,[c,"Motorola"],[u,f]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[s,[c,"Motorola"],[u,d]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[c,h.trim],[s,h.trim],[u,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[c,"Samsung"],[u,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[s,[c,"Sharp"],[u,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[c,"Samsung"],s,[u,d]],[/smart-tv.+(samsung)/i],[c,[u,"smarttv"],s],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[c,"Samsung"],s,[u,f]],[/sie-(\w+)*/i],[s,[c,"Siemens"],[u,f]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[c,"Nokia"],s,[u,f]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[s,[c,"Acer"],[u,d]],[/android.+([vl]k\-?\d{3})\s+build/i],[s,[c,"LG"],[u,d]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[c,"LG"],s,[u,d]],[/(lg) netcast\.tv/i],[c,s,[u,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[s,[c,"LG"],[u,f]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[s,[c,"Lenovo"],[u,d]],[/linux;.+((jolla));/i],[c,s,[u,f]],[/((pebble))app\/[\d\.]+\s/i],[c,s,[u,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[c,s,[u,f]],[/crkey/i],[[s,"Chromecast"],[c,"Google"]],[/android.+;\s(glass)\s\d/i],[s,[c,"Google"],[u,"wearable"]],[/android.+;\s(pixel c)\s/i],[s,[c,"Google"],[u,d]],[/android.+;\s(pixel xl|pixel)\s/i],[s,[c,"Google"],[u,f]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[s,/_/g," "],[c,"Xiaomi"],[u,f]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[s,/_/g," "],[c,"Xiaomi"],[u,d]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[s,[c,"Meizu"],[u,d]],[/android.+a000(1)\s+build/i],[s,[c,"OnePlus"],[u,f]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[s,[c,"RCA"],[u,d]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[s,[c,"Dell"],[u,d]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[s,[c,"Verizon"],[u,d]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[c,"Barnes & Noble"],s,[u,d]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[s,[c,"NuVision"],[u,d]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[c,"ZTE"],s,[u,d]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[s,[c,"Swiss"],[u,f]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[s,[c,"Swiss"],[u,d]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[s,[c,"Zeki"],[u,d]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[c,"Dragon Touch"],s,[u,d]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[s,[c,"Insignia"],[u,d]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[s,[c,"NextBook"],[u,d]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[c,"Voice"],s,[u,f]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[c,"LvTel"],s,[u,f]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[s,[c,"Envizen"],[u,d]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[c,s,[u,d]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[s,[c,"MachSpeed"],[u,d]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[c,s,[u,d]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[s,[c,"Rotor"],[u,d]],[/android.+(KS(.+))\s+build/i],[s,[c,"Amazon"],[u,d]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[c,s,[u,d]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[u,h.lowerize],c,s],[/(android.+)[;\/].+build/i],[s,[c,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[l,[a,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[a,l],[/rv\:([\w\.]+).*(gecko)/i],[l,a]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[a,l],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[a,[l,p.str,g.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[a,"Windows"],[l,p.str,g.os.windows.version]],[/\((bb)(10);/i],[[a,"BlackBerry"],l],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[a,l],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[a,"Symbian"],l],[/\((series40);/i],[a],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[a,"Firefox OS"],l],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[a,l],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[a,"Chromium OS"],l],[/(sunos)\s?([\w\.]+\d)*/i],[[a,"Solaris"],l],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[a,l],[/(haiku)\s(\w+)/i],[a,l],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[l,/_/g,"."],[a,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[a,"Mac OS"],[l,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[a,l]]},v=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof v))return new v(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?h.extend(y,t):y;return this.getBrowser=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,n,r.browser),e.major=h.major(e.version),e},this.getCPU=function(){var e={architecture:void 0};return p.rgx.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return p.rgx.call(e,n,r.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,n,r.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return p.rgx.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};v.VERSION="0.7.17",v.BROWSER={NAME:a,MAJOR:"major",VERSION:l},v.CPU={ARCHITECTURE:"architecture"},v.DEVICE={MODEL:s,VENDOR:c,TYPE:u,CONSOLE:"console",MOBILE:f,SMARTTV:"smarttv",TABLET:d,WEARABLE:"wearable",EMBEDDED:"embedded"},v.ENGINE={NAME:a,VERSION:l},v.OS={NAME:a,VERSION:l},void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=v),t.UAParser=v):n(51)?void 0!==(r=function(){return v}.call(t,n,t,e))&&(e.exports=r):i&&(i.UAParser=v);var b=i&&(i.jQuery||i.Zepto);if(void 0!==b){var m=new v;b.ua=m.getResult(),b.ua.get=function(){return m.getUA()},b.ua.set=function(e){m.setUA(e);var t=m.getResult();for(var n in t)b.ua[n]=t[n]}}}("object"==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){function r(e){return u.digest(e)}function i(e,t){if(!f)return void setTimeout(t,0,r(e));"string"==typeof e&&(e=o(e)),f.digest({name:"sha-1"},e).then(function(e){t(s(new Uint8Array(e)))},function(n){t(r(e))})}function o(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n}function s(e){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")}var a=n(53),u=new a,c="undefined"!=typeof window?window:self,l=c.crypto||c.msCrypto||{},f=l.subtle||l.webkitSubtle;try{f.digest({name:"sha-1"},new Uint8Array).catch(function(){f=!1})}catch(e){f=!1}e.exports=i,e.exports.sync=r},function(e,t,n){!function(t,n){e.exports=n()}("undefined"!=typeof self&&self,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(5),o=n(1),s=o.toHex,a=o.ceilHeapSize,u=n(6),c=function(e){for(e+=9;e%64>0;e+=1);return e},l=function(e,t){var n=new Uint8Array(e.buffer),r=t%4,i=t-r;switch(r){case 0:n[i+3]=0;case 1:n[i+2]=0;case 2:n[i+1]=0;case 3:n[i+0]=0}for(var o=1+(t>>2);o<e.length;o++)e[o]=0},f=function(e,t,n){e[t>>2]|=128<<24-(t%4<<3),e[14+(2+(t>>2)&-16)]=n/(1<<29)|0,e[15+(2+(t>>2)&-16)]=n<<3},d=function(e,t){var n=new Int32Array(e,t+320,5),r=new Int32Array(5),i=new DataView(r.buffer);return i.setInt32(0,n[0],!1),i.setInt32(4,n[1],!1),i.setInt32(8,n[2],!1),i.setInt32(12,n[3],!1),i.setInt32(16,n[4],!1),r},h=function(){function e(t){if(r(this,e),(t=t||65536)%64>0)throw new Error("Chunk size must be a multiple of 128 bit");this._offset=0,this._maxChunkLen=t,this._padMaxChunkLen=c(t),this._heap=new ArrayBuffer(a(this._padMaxChunkLen+320+20)),this._h32=new Int32Array(this._heap),this._h8=new Int8Array(this._heap),this._core=new i({Int32Array:Int32Array},{},this._heap)}return e.prototype._initState=function(e,t){this._offset=0;var n=new Int32Array(e,t+320,5);n[0]=1732584193,n[1]=-271733879,n[2]=-1732584194,n[3]=271733878,n[4]=-1009589776},e.prototype._padChunk=function(e,t){var n=c(e),r=new Int32Array(this._heap,0,n>>2);return l(r,e),f(r,e,t),n},e.prototype._write=function(e,t,n,r){u(e,this._h8,this._h32,t,n,r||0)},e.prototype._coreCall=function(e,t,n,r,i){var o=n;this._write(e,t,n),i&&(o=this._padChunk(n,r)),this._core.hash(o,this._padMaxChunkLen)},e.prototype.rawDigest=function(e){var t=e.byteLength||e.length||e.size||0;this._initState(this._heap,this._padMaxChunkLen);var n=0,r=this._maxChunkLen;for(n=0;t>n+r;n+=r)this._coreCall(e,n,r,t,!1);return this._coreCall(e,n,t-n,t,!0),d(this._heap,this._padMaxChunkLen)},e.prototype.digest=function(e){return s(this.rawDigest(e).buffer)},e.prototype.digestFromString=function(e){return this.digest(e)},e.prototype.digestFromBuffer=function(e){return this.digest(e)},e.prototype.digestFromArrayBuffer=function(e){return this.digest(e)},e.prototype.resetState=function(){return this._initState(this._heap,this._padMaxChunkLen),this},e.prototype.append=function(e){var t=0,n=e.byteLength||e.length||e.size||0,r=this._offset%this._maxChunkLen,i=void 0;for(this._offset+=n;t<n;)i=Math.min(n-t,this._maxChunkLen-r),this._write(e,t,i,r),r+=i,t+=i,r===this._maxChunkLen&&(this._core.hash(this._maxChunkLen,this._padMaxChunkLen),r=0);return this},e.prototype.getState=function(){var e=this._offset%this._maxChunkLen,t=void 0;if(e)t=this._heap.slice(0);else{var n=new Int32Array(this._heap,this._padMaxChunkLen+320,5);t=n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}return{offset:this._offset,heap:t}},e.prototype.setState=function(e){if(this._offset=e.offset,20===e.heap.byteLength){new Int32Array(this._heap,this._padMaxChunkLen+320,5).set(new Int32Array(e.heap))}else this._h32.set(new Int32Array(e.heap));return this},e.prototype.rawEnd=function(){var e=this._offset,t=e%this._maxChunkLen,n=this._padChunk(t,e);this._core.hash(n,this._padMaxChunkLen);var r=d(this._heap,this._padMaxChunkLen);return this._initState(this._heap,this._padMaxChunkLen),r},e.prototype.end=function(){return s(this.rawEnd().buffer)},e}();e.exports=h,e.exports._core=i},function(e,t){for(var n=new Array(256),r=0;r<256;r++)n[r]=(r<16?"0":"")+r.toString(16);e.exports.toHex=function(e){for(var t=new Uint8Array(e),r=new Array(e.byteLength),i=0;i<r.length;i++)r[i]=n[t[i]];return r.join("")},e.exports.ceilHeapSize=function(e){var t=0;if(e<=65536)return 65536;if(e<16777216)for(t=1;t<e;t<<=1);else for(t=16777216;t<e;t+=16777216);return t},e.exports.isDedicatedWorkerScope=function(e){var t="WorkerGlobalScope"in e&&e instanceof e.WorkerGlobalScope,n="SharedWorkerGlobalScope"in e&&e instanceof e.SharedWorkerGlobalScope,r="ServiceWorkerGlobalScope"in e&&e instanceof e.ServiceWorkerGlobalScope;return t&&!n&&!r}},function(e,t,n){e.exports=function(){var e=n(0),t=function(e,t,n){try{return n(null,e.digest(t))}catch(e){return n(e)}},r=function(e,t,n,i,o){var s=new self.FileReader;s.onloadend=function(){if(s.error)return o(s.error);var a=s.result;t+=s.result.byteLength;try{e.append(a)}catch(e){return void o(e)}t<i.size?r(e,t,n,i,o):o(null,e.end())},s.readAsArrayBuffer(i.slice(t,t+n))},i=!0;return self.onmessage=function(n){if(i){var o=n.data.data,s=n.data.file,a=n.data.id;if(void 0!==a&&(s||o)){var u=n.data.blockSize||4194304,c=new e(u);c.resetState();var l=function(e,t){e?self.postMessage({id:a,error:e.name}):self.postMessage({id:a,hash:t})};o&&t(c,o,l),s&&r(c,0,u,s,l)}}},function(){i=!1}}},function(e,t,n){var r=n(4),i=n(0),o=n(7),s=n(2),a=n(1),u=a.isDedicatedWorkerScope,c="undefined"!=typeof self&&u(self);i.disableWorkerBehaviour=c?s():function(){},i.createWorker=function(){var e=r(2),t=e.terminate;return e.terminate=function(){URL.revokeObjectURL(e.objectURL),t.call(e)},e},i.createHash=o,e.exports=i},function(e,t,n){function r(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t.oe=function(e){throw e};var r=t(t.s=ENTRY_MODULE);return r.default||r}function i(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,r){var o={};o[r]=[];var s=t.toString(),a=s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return o;for(var l,f=a[1],d=new RegExp("(\\\\n|\\W)"+i(f)+c,"g");l=d.exec(s);)"dll-reference"!==l[3]&&o[r].push(l[3]);for(d=new RegExp("\\("+i(f)+'\\("(dll-reference\\s('+u+'))"\\)\\)'+c,"g");l=d.exec(s);)e[l[2]]||(o[r].push(l[1]),e[l[2]]=n(l[1]).m),o[l[2]]=o[l[2]]||[],o[l[2]].push(l[4]);return o}function s(e){return Object.keys(e).reduce(function(t,n){return t||e[n].length>0},!1)}function a(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};s(n);)for(var a=Object.keys(n),u=0;u<a.length;u++){var c=a[u],l=n[c],f=l.pop();if(i[c]=i[c]||{},!i[c][f]&&e[c][f]){i[c][f]=!0,r[c]=r[c]||[],r[c].push(f);for(var d=o(e,e[c][f],c),h=Object.keys(d),p=0;p<h.length;p++)n[h[p]]=n[h[p]]||[],n[h[p]]=n[h[p]].concat(d[h[p]])}}return r}var u="[\\.|\\-|\\+|\\w|/|@]+",c="\\((/\\*.*?\\*/)?s?.*?("+u+").*?\\)";e.exports=function(e,t){t=t||{};var i={main:n.m},o=t.all?{main:Object.keys(i)}:a(i,e),s="";Object.keys(o).filter(function(e){return"main"!==e}).forEach(function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map(function(t){return JSON.stringify(t)+": "+i[e][t].toString()}).join(",")+"});\n"}),s=s+"("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map(function(e){return JSON.stringify(e)+": "+i.main[e].toString()}).join(",")+"})(self);";var u=new window.Blob([s],{type:"text/javascript"});if(t.bare)return u;var c=window.URL||window.webkitURL||window.mozURL||window.msURL,l=c.createObjectURL(u),f=new window.Worker(l);return f.objectURL=l,f}},function(e,t){e.exports=function(e,t,n){"use asm";var r=new e.Int32Array(n);function i(e,t){e=e|0;t=t|0;var n=0,i=0,o=0,s=0,a=0,u=0,c=0,l=0,f=0,d=0,h=0,p=0,g=0,y=0;o=r[t+320>>2]|0;a=r[t+324>>2]|0;c=r[t+328>>2]|0;f=r[t+332>>2]|0;h=r[t+336>>2]|0;for(n=0;(n|0)<(e|0);n=n+64|0){s=o;u=a;l=c;d=f;p=h;for(i=0;(i|0)<64;i=i+4|0){y=r[n+i>>2]|0;g=((o<<5|o>>>27)+(a&c|~a&f)|0)+((y+h|0)+1518500249|0)|0;h=f;f=c;c=a<<30|a>>>2;a=o;o=g;r[e+i>>2]=y}for(i=e+64|0;(i|0)<(e+80|0);i=i+4|0){y=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a&c|~a&f)|0)+((y+h|0)+1518500249|0)|0;h=f;f=c;c=a<<30|a>>>2;a=o;o=g;r[i>>2]=y}for(i=e+80|0;(i|0)<(e+160|0);i=i+4|0){y=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a^c^f)|0)+((y+h|0)+1859775393|0)|0;h=f;f=c;c=a<<30|a>>>2;a=o;o=g;r[i>>2]=y}for(i=e+160|0;(i|0)<(e+240|0);i=i+4|0){y=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a&c|a&f|c&f)|0)+((y+h|0)-1894007588|0)|0;h=f;f=c;c=a<<30|a>>>2;a=o;o=g;r[i>>2]=y}for(i=e+240|0;(i|0)<(e+320|0);i=i+4|0){y=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a^c^f)|0)+((y+h|0)-899497514|0)|0;h=f;f=c;c=a<<30|a>>>2;a=o;o=g;r[i>>2]=y}o=o+s|0;a=a+u|0;c=c+l|0;f=f+d|0;h=h+p|0}r[t+320>>2]=o;r[t+324>>2]=a;r[t+328>>2]=c;r[t+332>>2]=f;r[t+336>>2]=h}return{hash:i}}},function(e,t){var n=this,r=void 0;"undefined"!=typeof self&&void 0!==self.FileReaderSync&&(r=new self.FileReaderSync);var i=function(e,t,n,r,i,o){var s=void 0,a=o%4,u=(i+a)%4,c=i-u;switch(a){case 0:t[o]=e.charCodeAt(r+3);case 1:t[o+1-(a<<1)|0]=e.charCodeAt(r+2);case 2:t[o+2-(a<<1)|0]=e.charCodeAt(r+1);case 3:t[o+3-(a<<1)|0]=e.charCodeAt(r)}if(!(i<u+(4-a))){for(s=4-a;s<c;s=s+4|0)n[o+s>>2]=e.charCodeAt(r+s)<<24|e.charCodeAt(r+s+1)<<16|e.charCodeAt(r+s+2)<<8|e.charCodeAt(r+s+3);switch(u){case 3:t[o+c+1|0]=e.charCodeAt(r+c+2);case 2:t[o+c+2|0]=e.charCodeAt(r+c+1);case 1:t[o+c+3|0]=e.charCodeAt(r+c)}}},o=function(e,t,n,r,i,o){var s=void 0,a=o%4,u=(i+a)%4,c=i-u;switch(a){case 0:t[o]=e[r+3];case 1:t[o+1-(a<<1)|0]=e[r+2];case 2:t[o+2-(a<<1)|0]=e[r+1];case 3:t[o+3-(a<<1)|0]=e[r]}if(!(i<u+(4-a))){for(s=4-a;s<c;s=s+4|0)n[o+s>>2|0]=e[r+s]<<24|e[r+s+1]<<16|e[r+s+2]<<8|e[r+s+3];switch(u){case 3:t[o+c+1|0]=e[r+c+2];case 2:t[o+c+2|0]=e[r+c+1];case 1:t[o+c+3|0]=e[r+c]}}},s=function(e,t,n,i,o,s){var a=void 0,u=s%4,c=(o+u)%4,l=o-c,f=new Uint8Array(r.readAsArrayBuffer(e.slice(i,i+o)));switch(u){case 0:t[s]=f[3];case 1:t[s+1-(u<<1)|0]=f[2];case 2:t[s+2-(u<<1)|0]=f[1];case 3:t[s+3-(u<<1)|0]=f[0]}if(!(o<c+(4-u))){for(a=4-u;a<l;a=a+4|0)n[s+a>>2|0]=f[a]<<24|f[a+1]<<16|f[a+2]<<8|f[a+3];switch(c){case 3:t[s+l+1|0]=f[l+2];case 2:t[s+l+2|0]=f[l+1];case 1:t[s+l+3|0]=f[l]}}};e.exports=function(e,t,r,a,u,c){if("string"==typeof e)return i(e,t,r,a,u,c);if(e instanceof Array)return o(e,t,r,a,u,c);if(n&&n.Buffer&&n.Buffer.isBuffer(e))return o(e,t,r,a,u,c);if(e instanceof ArrayBuffer)return o(new Uint8Array(e),t,r,a,u,c);if(e.buffer instanceof ArrayBuffer)return o(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),t,r,a,u,c);if(e instanceof Blob)return s(e,t,r,a,u,c);throw new Error("Unsupported data type.")}},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=n(1),s=o.toHex,a=function(){function e(){r(this,e),this._rusha=new i,this._rusha.resetState()}return e.prototype.update=function(e){return this._rusha.append(e),this},e.prototype.digest=function(e){var t=this._rusha.rawEnd().buffer;if(!e)return t;if("hex"===e)return s(t);throw new Error("unsupported digest encoding")},e}();e.exports=function(){return new a}}])})}])});